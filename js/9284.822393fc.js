"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[9284],{9284:(e,l,a)=>{a.r(l),a.d(l,{default:()=>_e});var t=a(9835),i=a(6970);const n={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},o={class:"q-pt-lg"},u=(0,t._)("div",{class:"q-py-md"},null,-1),d={class:"row q-col-gutter-y-xl"},s={class:"col-5"},r={class:"bg-grey-3 q-py-lg q-px-xl"},m=(0,t._)("div",{class:"row q-gutter-x-lg q-mb-md"},[(0,t._)("div",{class:"text-h6 q-mb-sm"},"Units Available")],-1),c={class:"col-8"},p={class:"row items-center justify-center q-col-gutter-x-md"},v={class:"col-6"},g={class:"col-6 column q-col-gutter-y-sm"},b={class:"row justify-center"},w={class:"row justify-center"},_={class:"col-3"},f={class:"col-11"},y=(0,t._)("div",{class:"row q-gutter-x-lg q-mb-md"},[(0,t._)("div",{class:"text-h6 q-mb-sm"},"Sale Rates")],-1),q={class:"column q-gutter-y-md"},D={class:"row q-gutter-x-lg items-center"},k={class:"text-weight-bold"},h={class:"col-md-5 column q-px-md"},R=(0,t._)("div",null,"Unit",-1),W=(0,t._)("div",null,"Number of Portions",-1),U=(0,t._)("div",null,"Unit Sale Price",-1),V={class:"col-md-3 column q-px-md"},x=(0,t._)("div",null,"Discount",-1),S={class:"col-md-3"},B={class:"row items-center"},C=(0,t._)("div",{class:"text-weight-bold col"}," Price Breakdown ",-1),H={class:"col-auto"},I={class:"row q-mx-sm q-mb-sm"},z=(0,t._)("div",{class:"col"},"Net Price",-1),P={class:"col"},O={class:"col"},Z={class:"col"},Q={class:"col-auto column justify-center items-center"},N={key:0,class:"q-pa-lg text-center text-h6 bg-grey-4 text-grey-8"},F={class:"row justify-end q-mb-lg"},j={class:"col"},L={class:"col"};function A(e,l,a,A,M,K){const T=(0,t.up)("q-select"),Y=(0,t.up)("q-input"),E=(0,t.up)("q-btn"),$=(0,t.up)("q-form"),G=(0,t.up)("q-field"),J=(0,t.up)("q-separator"),X=(0,t.up)("q-card-section"),ee=(0,t.up)("q-card"),le=(0,t.up)("q-toolbar-title"),ae=(0,t.up)("q-toolbar"),te=(0,t.up)("q-item-section"),ie=(0,t.up)("q-item"),ne=(0,t.up)("q-card-actions"),oe=(0,t.up)("q-dialog"),ue=(0,t.up)("q-spinner-ios"),de=(0,t.up)("q-inner-loading"),se=(0,t.up)("q-page"),re=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(se,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",n,[(0,t.Wm)($,{ref:"updateItemForm",onSubmit:e.submitItemUpdate},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{"map-options":"","emit-value":"",modelValue:e.formData.category_id,"onUpdate:modelValue":l[0]||(l[0]=l=>e.formData.category_id=l),options:e.categoryOptions,"option-label":"name","option-value":"id","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.categoryOptions.map((e=>e.id)))},null,8,["modelValue","options","rules"]),(0,t.Wm)(Y,{label:"Item",modelValue:e.formData.name,"onUpdate:modelValue":l[1]||(l[1]=l=>e.formData.name=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t._)("div",o,[e.permissionRequired("bar","change_brand")?((0,t.wg)(),(0,t.j4)(E,{key:0,rounded:"",label:"Update",type:"submit",color:"primary",class:"full-width"})):(0,t.kq)("",!0)])])),_:1},8,["onSubmit"]),u,(0,t._)("div",d,[(0,t._)("div",s,[(0,t._)("div",r,[m,(0,t._)("div",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.pageData.units_available_details,((e,l)=>((0,t.wg)(),(0,t.iD)("div",{class:"row items-center q-gutter-x-sm q-mb-md",key:l},[(0,t._)("div",c,[(0,t._)("div",p,[(0,t._)("div",v,[(0,t.Wm)(G,{dense:"",outlined:""},{control:(0,t.w5)((()=>[(0,t.Uk)((0,i.zw)(e.whole_number),1)])),_:2},1024)]),(0,t._)("div",g,[(0,t._)("div",b,[(0,t.Wm)(G,{dense:"",outlined:"",class:"col-10"},{control:(0,t.w5)((()=>[(0,t.Uk)((0,i.zw)(e.numerator),1)])),_:2},1024)]),(0,t._)("div",null,[(0,t.Wm)(J,{class:"bg-grey-8"})]),(0,t._)("div",w,[(0,t.Wm)(G,{dense:"",outlined:"",class:"col-10"},{control:(0,t.w5)((()=>[(0,t.Uk)((0,i.zw)(e.denomenator),1)])),_:2},1024)])])])]),(0,t._)("div",_,[(0,t.Wm)(G,{borderless:"","stack-label":""},{control:(0,t.w5)((()=>[(0,t.Uk)((0,i.zw)(e.unit),1)])),_:2},1024)])])))),128))])])]),(0,t._)("div",f,[y,(0,t._)("div",q,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.pageData.units_available_details,(l=>((0,t.wg)(),(0,t.iD)("div",{key:l.id},[(0,t.Wm)(ee,{flat:"",bordered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(X,null,{default:(0,t.w5)((()=>[(0,t._)("div",D,[(0,t._)("div",k,(0,i.zw)(l.unit),1),(0,t._)("div",null,[e.permissionRequired("bar","add_salerates")?((0,t.wg)(),(0,t.j4)(E,{key:0,"no-caps":"",rounded:"",label:"Add Rate",color:"primary",onClick:a=>e.showAddRateDialog(l.id)},null,8,["onClick"])):(0,t.kq)("",!0)])])])),_:2},1024),(0,t.Wm)(J),(0,t.Wm)(X,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.sale_rates,(l=>((0,t.wg)(),(0,t.iD)("div",{class:"row",key:l.id},[(0,t._)("div",h,[(0,t.Wm)($,{onSubmit:a=>e.submitRateUpdate(l)},{default:(0,t.w5)((()=>[(0,t._)("div",null,[R,(0,t.Wm)(T,{dense:"",outlined:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",modelValue:l.unit,"onUpdate:modelValue":e=>l.unit=e,options:e.filteredUnitsOptions,loading:e.loadingUnitsOptions,onFilter:e.filterUnitsOptions,"option-label":"name","option-value":"name",style:{width:"auto",maxWidth:"100%"},"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredUnitsOptions.map((e=>e.name)))},null,8,["modelValue","onUpdate:modelValue","options","loading","onFilter","rules"])]),(0,t._)("div",null,[W,(0,t.Wm)(Y,{dense:"",outlined:"",type:"number",modelValue:l.quantity,"onUpdate:modelValue":e=>l.quantity=e,modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])]),(0,t._)("div",null,[U,(0,t.Wm)(Y,{dense:"",outlined:"",type:"number",modelValue:l.amount,"onUpdate:modelValue":e=>l.amount=e,modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])]),(0,t._)("div",null,[e.permissionRequired("bar","change_salerates")?((0,t.wg)(),(0,t.j4)(E,{key:0,outline:"",rounded:"",label:"Update",icon:"edit",color:"primary",class:"full-width",type:"submit"})):(0,t.kq)("",!0)])])),_:2},1032,["onSubmit"])]),(0,t._)("div",V,[(0,t.Wm)($,{onSubmit:a=>e.submitSaleRateDiscount(l)},{default:(0,t.w5)((()=>[(0,t._)("div",null,[x,(0,t.Wm)(Y,{dense:"",outlined:"",suffix:"%",type:"number",step:".1",modelValue:l.discount,"onUpdate:modelValue":e=>l.discount=e,modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules(),hint:"Enter percentage"},null,8,["modelValue","onUpdate:modelValue","rules"])]),(0,t._)("div",null,[e.permissionRequired("bar","change_salerates")?((0,t.wg)(),(0,t.j4)(E,{key:0,outline:"",rounded:"",label:"Update",icon:"edit",color:"primary",class:"full-width",type:"submit"})):(0,t.kq)("",!0)])])),_:2},1032,["onSubmit"])]),(0,t._)("div",S,[(0,t._)("div",null,[(0,t._)("div",B,[C,(0,t._)("div",H,[(0,t.Wm)(E,{round:"",size:"sm",color:"primary",icon:0==l.price_breakdown.length?"add":"edit",onClick:a=>e.showPriceBreakDownDialog(l.id,l.price_breakdown)},null,8,["icon","onClick"])])]),(0,t.Wm)(J,{class:"q-my-sm"}),(0,t._)("div",I,[z,(0,t._)("div",P,(0,i.zw)(100-e.itemsProductSum2(l.price_breakdown,e.attributes=["value"]))+"% ",1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.price_breakdown,((e,l)=>((0,t.wg)(),(0,t.iD)("div",{class:"row q-mx-sm q-mb-sm",key:l},[(0,t._)("div",O,(0,i.zw)(e.label),1),(0,t._)("div",Z,(0,i.zw)(e.value)+"%",1)])))),128))])]),(0,t._)("div",Q,[(0,t._)("div",null,[e.permissionRequired("bar","delete_salerates")?((0,t.wg)(),(0,t.j4)(E,{key:0,round:"",color:"red",icon:"delete",size:"sm",onClick:a=>e.deleteRate(l.id)},null,8,["onClick"])):(0,t.kq)("",!0)])])])))),128)),0==l.sale_rates.length?((0,t.wg)(),(0,t.iD)("div",N," No Sales Rates ")):(0,t.kq)("",!0)])),_:2},1024)])),_:2},1024)])))),128))])])])]),(0,t.Wm)(oe,{modelValue:e.addRateDialog,"onUpdate:modelValue":l[5]||(l[5]=l=>e.addRateDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{style:{width:"700px",maxWidth:"700px"}},{default:(0,t.w5)((()=>[(0,t.Wm)($,{ref:"addRateForm",onSubmit:e.submitNewRatesData},{default:(0,t.w5)((()=>[(0,t.Wm)(ae,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(le,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Create Sales Rates")])),_:1}),(0,t.wy)((0,t.Wm)(E,{flat:"",round:"",size:"md",icon:"close"},null,512),[[re]])])),_:1}),(0,t.Wm)(J),(0,t.Wm)(X,null,{default:(0,t.w5)((()=>[(0,t.Wm)(ie,null,{default:(0,t.w5)((()=>[(0,t.Wm)(te,null,{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"Unit",outlined:"","use-input":"","hide-selected":"","fill-input":"","emit-value":"","map-options":"",modelValue:e.addRateData.unit,"onUpdate:modelValue":l[2]||(l[2]=l=>e.addRateData.unit=l),options:e.filteredUnitsOptions,loading:e.loadingUnitsOptions,onFilter:e.filterUnitsOptions,"option-label":"name","option-value":"name",style:{width:"auto",maxWidth:"100%"},"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredUnitsOptions.map((e=>e.name)))},null,8,["modelValue","options","loading","onFilter","rules"])])),_:1}),(0,t.Wm)(te,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Y,{label:"Quantity",outlined:"",type:"number",modelValue:e.addRateData.quantity,"onUpdate:modelValue":l[3]||(l[3]=l=>e.addRateData.quantity=l),modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"])])),_:1}),(0,t.Wm)(te,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Y,{label:"Price",outlined:"",type:"number",modelValue:e.addRateData.amount,"onUpdate:modelValue":l[4]||(l[4]=l=>e.addRateData.amount=l),modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Wm)(E,{rounded:"",color:"primary",label:"Submit",class:"full-width",onLoading:e.submittingData,type:"submit"},null,8,["onLoading"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(oe,{modelValue:e.priceBreakDownDialog,"onUpdate:modelValue":l[6]||(l[6]=l=>e.priceBreakDownDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{style:{width:"400px",maxWidth:"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)($,{ref:"priceBreakDownForm",onSubmit:e.submitPriceBreakDown},{default:(0,t.w5)((()=>[(0,t.Wm)(ae,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(le,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Portions")])),_:1}),(0,t.wy)((0,t.Wm)(E,{flat:"",round:"",size:"md",icon:"close"},null,512),[[re]])])),_:1}),(0,t.Wm)(J),(0,t.Wm)(X,null,{default:(0,t.w5)((()=>[(0,t._)("div",F,[(0,t.Wm)(E,{color:"primary",label:"Add",onClick:e.addPortion},null,8,["onClick"])]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.priceBreakDownData,((l,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"row q-col-gutter-x-sm",key:a},[(0,t._)("div",j,[(0,t.Wm)(Y,{outlined:"",label:"Item",modelValue:l.label,"onUpdate:modelValue":e=>l.label=e,"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])]),(0,t._)("div",L,[(0,t.Wm)(Y,{outlined:"",label:"Percentage",type:"number",step:".01",suffix:"%",modelValue:l.value,"onUpdate:modelValue":e=>l.value=e,modelModifiers:{number:!0},"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])])))),128)),(0,t._)("div",null,[(0,t.Wm)(E,{rounded:"",color:"primary",label:"Submit",class:"full-width",onLoading:e.submittingData,type:"submit",disabled:0==e.priceBreakDownData.length},null,8,["onLoading","disabled"])])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(de,{showing:e.loadingData},{default:(0,t.w5)((()=>[(0,t.Wm)(ue,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})}a(9665);var M=a(9302),K=a(499),T=a(4019),Y=a(8221);const E=(0,t.aZ)({name:"BarBrandDetails ",props:["id"],setup(e){const l=(0,M.Z)(),a=(0,K.iH)(!1),i=(0,K.iH)({}),n=(0,K.iH)({}),o=(0,K.iH)([]),u=(0,K.iH)(!1),d=(0,K.iH)([]),s=(0,K.iH)([]),r=(0,K.iH)(!1),m=(0,K.iH)(!1),c=(0,K.iH)(null),p=(0,K.iH)({}),v=(0,K.iH)(null),g=(0,K.iH)(!1),b=(0,K.iH)(null),w=(0,K.iH)({}),_=(0,K.iH)(null),f=(0,K.iH)(!1),y=(0,K.iH)([]),q=(0,K.iH)(null),D=(0,K.iH)(null);function k(){return i.value={},a.value=!0,(0,T.getBarBrands)(`/${e.id}`).then((e=>{i.value=e.data,n.value={category_id:i.value.category.id,name:i.value.name},i.value.units_available_details=i.value.units_available_details.map((e=>{let l={id:e.id,unit:e.unit},a=e.quantity.split("(");if(a.length>=1&&(l["whole_number"]=""==a[0]?null:parseInt(a[0])),2==a.length){let e=a[1].split("/");l["numerator"]=parseInt(e[0]),l["denomenator"]=parseInt(e[1].split(")")[0])}return{...l,sale_rates:e.sale_rates.map((e=>({...e,discount:e.extra_data?.discount?.rate,price_breakdown:e.extra_data?.price_breakdown||[]})))}}))})).finally((()=>{a.value=!1}))}function h(){return u.value=!0,(0,T.getBarCategories)().then((e=>{o.value=e.data})).finally((()=>{u.value=!1}))}function R(){return r.value=!0,(0,T.getUnits)().then((e=>{d.value=e.data,s.value=e.data})).finally((()=>{r.value=!1}))}return(0,t.bv)((()=>{h().then((()=>{R().then((()=>{k()}))}))})),{loadingData:a,pageData:i,loadingCategories:u,categoryOptions:o,formData:n,loadingUnitsOptions:r,unitsOptions:d,filteredUnitsOptions:s,submittingData:m,addStockData:p,addStockForm:c,updateItemForm:v,addRateDialog:g,addRateData:w,addRateForm:b,priceBreakDownData:y,priceBreakDownDialog:f,priceBreakDownForm:q,addPortion(){y.value.push({})},deletePortion(e){y.value.splice(e,1)},showPriceBreakDownDialog(e,l){D.value=e,y.value=(0,Y.objectCopy)(l),f.value=!0},showAddRateDialog(e){_.value=e,g.value=!0},filterUnitsOptions(e,l){l((()=>{s.value=d.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitItemUpdate(){v.value.validate()&&l.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{a.value=!0,(0,T.editBarBrands)(e.id,{...n.value}).then((e=>{(0,Y.displayNotification)(e.data,"positive"),v.value.resetValidation(),k()})).catch((e=>{(0,Y.displayNotification)(e.response.data,"negative")})).finally((()=>{a.value=!1}))}))},submitNewRatesData(){b.value.validate()&&l.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{m.value=!0,(0,T.createBrandSaleRates)(_.value,{items:[w.value]}).then((e=>{g.value=!1,_.value=null,(0,Y.displayNotification)(e.data,"positive"),b.value.resetValidation(),k()})).catch((e=>{(0,Y.displayNotification)(e.response.data,"negative")})).finally((()=>{m.value=!1}))}))},submitRateUpdate({id:e,unit:t,amount:i,quantity:n}){l.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{a.value=!0,(0,T.editBrandSaleRates)(e,{unit:t,amount:i,quantity:n}).then((e=>{(0,Y.displayNotification)(e.data,"positive"),k()})).catch((e=>{(0,Y.displayNotification)(e.response.data,"negative")})).finally((()=>{a.value=!1}))}))},deleteRate(e){l.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{a.value=!0,(0,T.deleteBrandSaleRates)(e).then((e=>{(0,Y.displayNotification)(e.data,"positive"),k()})).catch((e=>{(0,Y.displayNotification)(e.response.data,"negative")})).finally((()=>{a.value=!1}))}))},submitSaleRateDiscount({id:e,discount:t}){l.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{a.value=!0,(0,T.createBrandSaleRateDiscount)(e,{value:t}).then((e=>{(0,Y.displayNotification)(e.data,"positive")})).catch((e=>{(0,Y.displayNotification)(e,"negative"),k()})).finally((()=>{a.value=!1}))}))},submitPriceBreakDown(){l.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{a.value=!0,q.value.validate()&&(0,T.createBrandSaleRatePriceBreakDown)(D.value,y.value).then((e=>{(0,Y.displayNotification)(e.data,"positive"),D.value=null,y.value=[],q.value.resetValidation(),f.value=!1,k()})).catch((e=>{(0,Y.displayNotification)(e,"negative"),k()})).finally((()=>{a.value=!1}))}))}}}});var $=a(1639),G=a(9885),J=a(8326),X=a(4581),ee=a(6611),le=a(8879),ae=a(8149),te=a(926),ie=a(4458),ne=a(3190),oe=a(2074),ue=a(1663),de=a(1973),se=a(490),re=a(1233),me=a(1821),ce=a(854),pe=a(8359),ve=a(2146),ge=a(9984),be=a.n(ge);const we=(0,$.Z)(E,[["render",A]]),_e=we;be()(E,"components",{QPage:G.Z,QForm:J.Z,QSelect:X.Z,QInput:ee.Z,QBtn:le.Z,QField:ae.Z,QSeparator:te.Z,QCard:ie.Z,QCardSection:ne.Z,QDialog:oe.Z,QToolbar:ue.Z,QToolbarTitle:de.Z,QItem:se.Z,QItemSection:re.Z,QCardActions:me.Z,QInnerLoading:ce.Z,QSpinnerIos:pe.Z}),be()(E,"directives",{ClosePopup:ve.Z})}}]);