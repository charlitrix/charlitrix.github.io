"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[6382],{6382:(e,l,t)=>{t.r(l),t.d(l,{default:()=>ke});var a=t(9835),i=t(6970),u=t(1957);const s={class:"row justify-end q-gutter-x-lg"},o={class:"q-ma-lg q-column q-col-gutter-y-lg q-mb-xl"},n=(0,a._)("div",{class:"row justify-center text-h4"},"Requisition",-1),r={class:"text-italic"},d={class:"row"},p={class:"col-md-4"},m=(0,a._)("div",{class:"text-h5 q-mb-md"},"Supplier",-1),c={key:0},g=(0,a._)("th",{class:"text-left"},null,-1),q=(0,a._)("th",{class:"text-left"},"Name",-1),v=(0,a._)("th",{class:"text-left"},"Specifications",-1),w=(0,a._)("th",{class:"text-left"},"Quantity",-1),y=(0,a._)("th",{class:"text-left"},"Units",-1),D=(0,a._)("th",{class:"text-left"},"Rate",-1),_=(0,a._)("th",{class:"text-left"},"Total (Ugx)",-1),f=(0,a._)("th",{class:"text-left"},"Status",-1),h={key:0,style:{paddingRight:"0px !important"}},k={class:"row"},b={class:"text-capitalize"},I={class:"text-weight-bold"},x=["colspan"],R={class:"q-pt-xl"},S={class:"row q-gutter-x-xl justify-between"},W={class:"col-md-4 column q-gutter-y-lg"},C=(0,a._)("div",{class:"text-weight-bold"},"Requested By:",-1),V={class:"q-pb-xs text-center",style:{borderBottom:"2px dotted black"}},z={class:"col-md-4 column q-gutter-y-lg"},E=(0,a._)("div",{class:"text-weight-bold"},"Approved By:",-1),N={class:"q-pb-xs text-center",style:{borderBottom:"2px dotted black"}},U={key:0},P={key:1},H={class:"q-pt-lg"},Z=(0,a._)("div",{class:"text-weight-bold q-mb-md"},"Comments:",-1),Q={class:"row q-gutter-x-lg"},F={class:"col"},L={class:"col-auto self-end"},A={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg q-mt-sm"},j={class:"row q-gutter-x-lg"},T={class:"q-mx-lg q-mb-lg q-mt-sm"},G={class:"row q-my-lg q-gutter-x-lg items-center"},O={class:"q-column q-col-gutter-y-md q-mx-lg q-mb-lg"},B=(0,a._)("div",{class:"text-h5"},"Add Supplier",-1);function Y(e,l,t,Y,K,M){const $=(0,a.up)("q-btn"),J=(0,a.up)("q-btn-group"),X=(0,a.up)("q-item-section"),ee=(0,a.up)("q-item"),le=(0,a.up)("q-list"),te=(0,a.up)("q-toggle"),ae=(0,a.up)("q-markup-table"),ie=(0,a.up)("q-input"),ue=(0,a.up)("q-spinner-ios"),se=(0,a.up)("q-inner-loading"),oe=(0,a.up)("q-page"),ne=(0,a.up)("q-toolbar-title"),re=(0,a.up)("q-toolbar"),de=(0,a.up)("q-form"),pe=(0,a.up)("q-card"),me=(0,a.up)("q-dialog"),ce=(0,a.up)("q-select"),ge=(0,a.up)("q-slide-transition"),qe=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(oe,{class:"q-pa-xl"},{default:(0,a.w5)((()=>[(0,a._)("div",s,[e.permissionRequired("procurement","change_requisition")?((0,a.wg)(),(0,a.j4)($,{key:0,"no-caps":"",rounded:"",label:"Edit Supplier",color:"primary",onClick:e.showSupplierEditDialog,disable:"DECLINED"!=e.pageData.status},null,8,["onClick","disable"])):(0,a.kq)("",!0),e.permissionRequired("procurement","add_requisitionitem")?((0,a.wg)(),(0,a.j4)($,{key:1,"no-caps":"",rounded:"",label:"Add Items",color:"primary",onClick:l[0]||(l[0]=l=>e.newItemDialog=!e.newItemDialog),disable:"DECLINED"!=e.pageData.status},null,8,["disable"])):(0,a.kq)("",!0),e.permissionRequired("procurement","change_requisition")?((0,a.wg)(),(0,a.j4)(J,{key:2},{default:(0,a.w5)((()=>["PENDING"==e.pageData.status?((0,a.wg)(),(0,a.j4)($,{key:0,label:"Approve",color:"primary",onClick:e.approveRequisition},null,8,["onClick"])):(0,a.kq)("",!0),"PENDING"==e.pageData.status?((0,a.wg)(),(0,a.j4)($,{key:1,label:"Decline",color:"red",onClick:e.declineRequisition},null,8,["onClick"])):(0,a.kq)("",!0),(0,a.Wm)($,{label:"Clear",color:"grey-7",onClick:e.clearRequisition},null,8,["onClick"])])),_:1})):(0,a.kq)("",!0)]),(0,a._)("div",o,[n,(0,a._)("div",r,"No. "+(0,i.zw)(e.id),1),(0,a._)("div",null,[(0,a._)("div",d,[(0,a._)("div",p,[m,(0,a.Wm)(le,{dense:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ee,null,{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Code:")])),_:1}),e.requisitionSupplierData.id?((0,a.wg)(),(0,a.j4)(X,{key:0},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.requisitionSupplierData.id),1)])),_:1})):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(ee,null,{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Name:")])),_:1}),(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.requisitionSupplierData.name),1)])),_:1})])),_:1}),(0,a.Wm)(ee,null,{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Contact:")])),_:1}),(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.requisitionSupplierData.contact),1)])),_:1})])),_:1}),(0,a.Wm)(ee,null,{default:(0,a.w5)((()=>[(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Address:")])),_:1}),(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.requisitionSupplierData.address),1)])),_:1})])),_:1})])),_:1})])])]),(0,a._)("div",null,[(0,a.Wm)(ae,{bordered:"",flat:"",square:"",separator:"cell"},{default:(0,a.w5)((()=>[(0,a._)("thead",null,[(0,a._)("tr",null,["DECLINED"==e.pageData.status||"PENDING"==e.pageData.status?((0,a.wg)(),(0,a.iD)("th",c)):(0,a.kq)("",!0),g,q,v,w,y,D,_,f])]),(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.itemsList,((l,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:t},["DECLINED"==e.pageData.status||"PENDING"==e.pageData.status?((0,a.wg)(),(0,a.iD)("td",h,[(0,a._)("div",k,[e.permissionRequired("procurement","change_requisitionitem")?((0,a.wg)(),(0,a.j4)($,{key:0,flat:"",round:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:l=>e.showEditRequisitionItemDialog(t)},null,8,["onClick"])):(0,a.kq)("",!0),e.permissionRequired("procurement","delete_requisitionitem")?((0,a.wg)(),(0,a.j4)($,{key:1,flat:"",round:"",dense:"",size:"sm",icon:"delete",color:"red",onClick:t=>e.showDeleteRequistionItemDialog(l.id)},null,8,["onClick"])):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),(0,a._)("td",null,(0,i.zw)(l.code),1),(0,a._)("td",null,(0,i.zw)(l.name),1),(0,a._)("td",null,(0,i.zw)(l.specifications),1),(0,a._)("td",null,(0,i.zw)(l.quantity),1),(0,a._)("td",null,(0,i.zw)(l.unit),1),(0,a._)("td",null,(0,i.zw)(e.formatPrice(l.unit_price)),1),(0,a._)("td",null,(0,i.zw)(e.formatPrice(l.unit_price*l.quantity)),1),(0,a._)("td",null,[e.permissionRequired("procurement","change_requisitionitem")?(0,a.wy)(((0,a.wg)(),(0,a.j4)(te,{key:0,"model-value":l.status,size:"md","true-value":"CLEARED","false-value":"PENDING","checked-icon":"check","unchecked-icon":"remove",color:"CLEARED"==l.status?"green":"red",onClick:t=>e.showUpdateItemDialog(l.id,"CLEARED"==l.status?"PENDING":"CLEARED")},null,8,["model-value","color","onClick"])),[[u.F8,"APPROVED"==e.pageData.status]]):(0,a.kq)("",!0),(0,a._)("span",b,(0,i.zw)(l.status),1)])])))),128))]),(0,a._)("tfoot",null,[(0,a._)("tr",I,[(0,a._)("td",{colspan:"PENDING"==e.pageData.status?7:6,class:"text-right"}," Total ",8,x),(0,a._)("td",null,(0,i.zw)(e.formatPrice(e.total)),1)])])])),_:1}),(0,a._)("div",R,[(0,a._)("div",S,[(0,a._)("div",W,[C,(0,a._)("div",V,(0,i.zw)(e.pageData.requester),1)]),(0,a._)("div",z,[E,(0,a._)("div",N,[e.pageData.approver?((0,a.wg)(),(0,a.iD)("span",U,(0,i.zw)(e.pageData.approver),1)):((0,a.wg)(),(0,a.iD)("span",P,"-"))])])])]),(0,a._)("div",H,[Z,(0,a._)("div",Q,[(0,a._)("div",F,[(0,a.Wm)(ie,{outlined:"",type:"textarea",rows:"5"})]),(0,a._)("div",L,[(0,a.Wm)($,{rounded:"",label:"Submit",color:"primary"})])])])])]),(0,a.Wm)(se,{showing:e.loadingData},{default:(0,a.w5)((()=>[(0,a.Wm)(ue,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1}),(0,a.Wm)(me,{modelValue:e.newItemDialog,"onUpdate:modelValue":l[7]||(l[7]=l=>e.newItemDialog=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(pe,{style:{width:"650px",maxWidth:"650px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(de,{ref:"newItemForm",onSubmit:e.submitRequisitionItem},{default:(0,a.w5)((()=>[(0,a.Wm)(re,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(ne,{textContent:(0,i.zw)(e.requisitionItemData.id?"Update Item":"New Item")},null,8,["textContent"]),(0,a.wy)((0,a.Wm)($,{flat:"",round:"",size:"md",icon:"close",onClick:e.clearForm},null,8,["onClick"]),[[qe]])])),_:1}),(0,a._)("div",A,[(0,a.Wm)(ie,{label:"Code",modelValue:e.requisitionItemData.code,"onUpdate:modelValue":l[1]||(l[1]=l=>e.requisitionItemData.code=l)},null,8,["modelValue"]),(0,a.Wm)(ie,{label:"Name",modelValue:e.requisitionItemData.name,"onUpdate:modelValue":l[2]||(l[2]=l=>e.requisitionItemData.name=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,a.Wm)(ie,{label:"Specifications",modelValue:e.requisitionItemData.specifications,"onUpdate:modelValue":l[3]||(l[3]=l=>e.requisitionItemData.specifications=l),type:"textarea",rows:"3","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,a._)("div",j,[(0,a.Wm)(ie,{label:"Quantity",type:"number",modelValue:e.requisitionItemData.quantity,"onUpdate:modelValue":l[4]||(l[4]=l=>e.requisitionItemData.quantity=l),"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,a.Wm)(ie,{label:"Price",type:"number",modelValue:e.requisitionItemData.unit_price,"onUpdate:modelValue":l[5]||(l[5]=l=>e.requisitionItemData.unit_price=l),"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,a.Wm)(ie,{label:"Unit",modelValue:e.requisitionItemData.unit,"onUpdate:modelValue":l[6]||(l[6]=l=>e.requisitionItemData.unit=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"])]),(0,a._)("div",null,[(0,a.Wm)($,{rounded:"","no-caps":"",type:"submit",class:"full-width",label:e.requisitionItemData.id?"Update":"Add",color:"primary",loading:e.loadingData},null,8,["label","loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(me,{modelValue:e.addSupplierDialog,"onUpdate:modelValue":l[13]||(l[13]=l=>e.addSupplierDialog=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(pe,{style:{width:"650px",maxWidth:"650px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(re,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(ne,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Suppliers")])),_:1}),(0,a.wy)((0,a.Wm)($,{flat:"",round:"",size:"md",icon:"close"},null,512),[[qe]])])),_:1}),(0,a._)("div",T,[(0,a._)("div",G,[(0,a._)("div",null,[(0,a.Wm)(ce,{clearable:"",label:"Suppliers","option-label":"name",options:e.suppliersDataList,style:{minWidth:"250px"},modelValue:e.selectedSupplier,"onUpdate:modelValue":l[8]||(l[8]=l=>e.selectedSupplier=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.suppliersDataList),loading:e.loadingSuppliersData,ref:"supplierSelected"},{option:(0,a.w5)((e=>[(0,a.Wm)(ee,(0,i.vs)((0,a.F4)(e.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(X,{side:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.opt.id),1)])),_:2},1024),(0,a.Wm)(X,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.opt.name),1)])),_:2},1024)])),_:2},1040)])),_:1},8,["options","modelValue","rules","loading"])]),(0,a._)("div",null,[e.permissionRequired("procurement","add_supplier")?((0,a.wg)(),(0,a.j4)($,{key:0,round:"",color:e.showSupplierForm?"red":"primary",icon:"add",class:(0,i.C_)([e.showSupplierForm?"rotate-45":""]),onClick:l[9]||(l[9]=l=>e.showSupplierForm=!e.showSupplierForm)},null,8,["color","class"])):(0,a.kq)("",!0)])]),(0,a.Wm)(ge,null,{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("div",null,[(0,a._)("div",O,[B,(0,a.Wm)(ie,{modelValue:e.supplierData.name,"onUpdate:modelValue":l[10]||(l[10]=l=>e.supplierData.name=l),label:"Name","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierName"},null,8,["modelValue","rules"]),(0,a.Wm)(ie,{modelValue:e.supplierData.contact,"onUpdate:modelValue":l[11]||(l[11]=l=>e.supplierData.contact=l),label:"Contact","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierContact",mask:"phone","unmasked-value":""},null,8,["modelValue","rules"]),(0,a.Wm)(ie,{modelValue:e.supplierData.address,"onUpdate:modelValue":l[12]||(l[12]=l=>e.supplierData.address=l),label:"Address","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierAddress"},null,8,["modelValue","rules"])])],512),[[u.F8,e.showSupplierForm]])])),_:1}),(0,a._)("div",null,[(0,a.Wm)($,{rounded:"","no-caps":"",type:"submit",class:"full-width",label:"Update",color:"primary",onClick:e.setSupplier,loading:e.loadingData},null,8,["onClick","loading"])])])])),_:1})])),_:1},8,["modelValue"])],64)}var K=t(4019),M=t(8221),$=t(9302),J=t(499);const X=(0,a.aZ)({name:"RequisitionDetails",props:["id"],setup(e){const l=(0,$.Z)(),t=(0,J.iH)({}),i=(0,J.iH)(!1),u=(0,J.iH)(!1),s=(0,J.iH)(null),o=(0,J.iH)({}),n=(0,J.iH)({}),r=(0,J.iH)([]),d=(0,a.Fl)((()=>r.value.reduce(((e,l)=>e+l.quantity*l.unit_price),0))),p=(0,J.iH)(!1),m=(0,J.iH)({name:"",contact:"",address:""}),c=(0,J.iH)(null),g=(0,J.iH)(null),q=(0,J.iH)(!1),v=(0,J.iH)(!1),w=(0,J.iH)([]),y=(0,J.iH)(null),D=(0,J.iH)(null),_=(0,J.iH)(null),f=(0,J.iH)(null),h=(0,J.iH)(null),k=(0,J.iH)({});function b(){o.value={}}function I(){return i.value=!0,(0,K.getRequisition)(`/${e.id}`).then((e=>{t.value=e.data,n.value=t.value.supplier&&""!==t.value.supplier?t.value.supplier:{},r.value=t.value.requisition_items})).finally((()=>{i.value=!1}))}function x(){return v.value=!0,(0,K.getSuppliers)().then((e=>{w.value=e.data})).finally((()=>{v.value=!1}))}function R(){let l={...o.value};if(l.id){let e=l.id;return delete l.id,(0,K.editRequisitionItem)(e,l)}return(0,K.createRequisitionItem)(e.id,l)}function S(){l.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{i.value=!0,(0,K.editRequisition)(e.id,k.value).then((e=>{k.value={},l.notify({type:"positive",message:e.data}),I()})).catch((e=>{l.notify({type:"negative",message:e.response.data.length<1e3?e.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}))}return(0,a.bv)((()=>{I().then((()=>{x()}))})),{pageData:t,loadingData:i,newItemDialog:u,newItemForm:s,requisitionItemData:o,requisitionSupplierData:n,itemsList:r,total:d,showSupplierForm:p,supplierData:m,selectedSupplier:c,clearForm:b,addSupplierDialog:q,addSupplierForm:g,loadingSuppliersData:v,suppliersDataList:w,supplierName:y,supplierContact:D,supplierAddress:_,supplierSelected:f,requisitionForm:h,setSupplier(){p.value&&y.value.validate()&&D.value.validate()&&_.value.validate()?(i.value=!0,(0,K.updateRequisitionSupplier)(e.id,{...m.value}).then((e=>{l.notify({type:"positive",message:e.data}),m.value={name:"",contact:"",address:""},y.value.resetValidation(),D.value.resetValidation(),_.value.resetValidation(),q.value=!1,I()})).catch((e=>{l.notify({type:"negative",message:e.response.data.length<1e3?e.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))):f.value.validate()&&(i.value=!0,(0,K.updateRequisitionSupplier)(e.id,{...c.value}).then((e=>{l.notify({type:"positive",message:e.data}),f.value.resetValidation(),q.value=!1,I()})).catch((e=>{l.notify({type:"negative",message:e.response.data.length<1e3?e.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1})))},submitRequisitionItem(){s.value.validate()&&l.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{i.value=!0,R().then((e=>{o.value={},s.value.resetValidation(),u.value=!1,l.notify({type:"positive",message:e.data}),I()})).catch((e=>{l.notify({type:"negative",message:e.response.data.length<1e3?e.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}))},showEditRequisitionItemDialog(e){o.value={...r.value[e]},u.value=!0},showDeleteRequistionItemDialog(e){l.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{i.value=!0,(0,K.deleteRequisitionItem)(e).then((e=>{l.notify({type:"positive",message:e.data}),I()})).catch((e=>{l.notify({type:"negative",message:e.response.data.length<1e3?e.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}))},showSupplierEditDialog(){t.value.supplier&&t.value.supplier.id&&(c.value=t.value.supplier),q.value=!0},approveRequisition(){k.value={status:"APPROVED"},S()},clearRequisition(){k.value={status:"PENDING"},S()},declineRequisition(){l.dialog({title:"Reason",prompt:{type:"textarea",rows:"3",isValid:(0,M.minimumRequiredRules)(20)[0]},cancel:!0}).onOk((e=>{k.value={status:"DECLINED",declined_reason:e},S()}))},showUpdateItemDialog(e,t){l.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{(0,K.updateRequisitionItemStatus)(e,{status:t}).then((e=>{(0,M.displayNotification)(e.data,"green"),I()})).catch((e=>{(0,M.displayNotification)(e.response.data,"red")}))}))}}}});var ee=t(1639),le=t(9885),te=t(8879),ae=t(7236),ie=t(3246),ue=t(490),se=t(1233),oe=t(6933),ne=t(3175),re=t(6611),de=t(854),pe=t(8359),me=t(2074),ce=t(4458),ge=t(8326),qe=t(1663),ve=t(1973),we=t(4581),ye=t(9003),De=t(2146),_e=t(9984),fe=t.n(_e);const he=(0,ee.Z)(X,[["render",Y]]),ke=he;fe()(X,"components",{QPage:le.Z,QBtn:te.Z,QBtnGroup:ae.Z,QList:ie.Z,QItem:ue.Z,QItemSection:se.Z,QMarkupTable:oe.Z,QToggle:ne.Z,QInput:re.Z,QInnerLoading:de.Z,QSpinnerIos:pe.Z,QDialog:me.Z,QCard:ce.Z,QForm:ge.Z,QToolbar:qe.Z,QToolbarTitle:ve.Z,QSelect:we.Z,QSlideTransition:ye.Z}),fe()(X,"directives",{ClosePopup:De.Z})}}]);