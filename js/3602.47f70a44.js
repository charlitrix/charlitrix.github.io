"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[3602],{3602:(e,a,l)=>{l.r(a),l.d(a,{default:()=>U});var t=l(9835);const n={key:0,class:"text-h6 text-grey"},u={class:"column q-col-gutter-y-md q-mt-md q-mx-lg"},s={class:"q-px-md q-pt-xl"};function i(e,a,l,i,o,r){const d=(0,t.up)("q-select"),m=(0,t.up)("q-input"),p=(0,t.up)("q-btn"),c=(0,t.up)("q-form"),v=(0,t.up)("q-spinner-ios"),g=(0,t.up)("q-inner-loading"),y=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(y,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref:"editUserForm",onSubmit:e.submitData},{default:(0,t.w5)((()=>[e.Id?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",n,"New User")),(0,t._)("div",u,[(0,t.Wm)(d,{"map-options":"","emit-value":"",label:"Departments","option-value":"id","option-label":"name",modelValue:e.departmentId,"onUpdate:modelValue":a[0]||(a[0]=a=>e.departmentId=a),loading:e.loadingDepartments,options:e.departmentsOptions,"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.departmentsOptions.map((e=>e.id)))},null,8,["modelValue","loading","options","rules"]),(0,t.Wm)(d,{"emit-value":"","map-options":"",label:"Account Type",options:e.accountData,"option-value":"id","option-label":"name",modelValue:e.accountType,"onUpdate:modelValue":a[1]||(a[1]=a=>e.accountType=a),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.accountData.map((e=>e.id)))},null,8,["options","modelValue","rules"]),(0,t.Wm)(m,{debounce:500,label:"User Name",modelValue:e.userData.username,"onUpdate:modelValue":a[2]||(a[2]=a=>e.userData.username=a),rules:[a=>a&&null!==a&&""!=a?e.userNameExists(a):"Enter a valid user name"]},null,8,["modelValue","rules"]),(0,t.Wm)(m,{label:"First Name",modelValue:e.userData.first_name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.userData.first_name=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t.Wm)(m,{label:"Last Name",modelValue:e.userData.last_name,"onUpdate:modelValue":a[4]||(a[4]=a=>e.userData.last_name=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t.Wm)(m,{label:"Email",modelValue:e.userData.email,"onUpdate:modelValue":a[5]||(a[5]=a=>e.userData.email=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t._)("div",s,[(0,t.Wm)(p,{rounded:"",color:"primary",label:"Edit",class:"full-width",loading:e.submitting,type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"]),(0,t.Wm)(g,{dark:"",showing:e.loadingData},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{size:"50px",color:"white"})])),_:1},8,["showing"])])),_:1})}l(9665);var o=l(9302),r=l(499),d=l(4019),m=l(8221),p=l(8339);const c=(0,t.aZ)({name:"UsersEdit",props:{Id:{required:!0}},setup(e){const a=(0,o.Z)(),l=(0,p.tv)(),n=(0,r.iH)(!1),u=(0,r.iH)(!1),s=(0,r.iH)(null),i=(0,r.iH)({}),c=(0,r.iH)({}),v=(0,r.iH)(null),g=(0,r.iH)([]),y=(0,r.iH)(!1),b=(0,r.iH)([]),f=(0,r.iH)(""),h=(0,r.iH)(!1);function D(){return y.value=!0,(0,d.getDepartments)().then((e=>{b.value=e.data})).finally((()=>{y.value=!1}))}function q(){n.value=!0,(0,d.getAccountTypes)().then((e=>{g.value=e.data})).finally((()=>{n.value=!1}))}function V(){return u.value=!0,c.value={},i.value={},v.value=null,f.value=null,(0,d.getUsers)(`/${e.Id}`).then((e=>{c.value.username=e.data.username,c.value.first_name=e.data.first_name,c.value.last_name=e.data.last_name,c.value.email=e.data.email,v.value=e.data.account_type.id,f.value=e.data.department.id,i.value={...c.value}})).finally((()=>{u.value=!1}))}function _(e){return e.toLocaleLowerCase()==i.value.username.toLocaleLowerCase()||new Promise(((a,l)=>{(0,d.getUsers)(`?username=${e}`).then((e=>{a("User name is already being used. Try another.")})).catch((e=>{e.response&&404==e.response.status?a(!0):a("user name is already being used. Try another.")}))}))}return(0,t.bv)((()=>{V().then((()=>{q(),D()}))})),{loadingAccountTypes:n,editUserForm:s,userData:c,accountData:g,accountType:v,submitting:h,loadingDepartments:y,departmentsOptions:b,departmentId:f,userNameExists:_,loadingData:u,submitData(){a.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{s.value.validate()&&(h.value=!0,(0,d.editUser)(e.Id,{...c.value,account_type_id:v.value,department_id:f.value}).then((e=>{(0,m.displayNotification)(e.data,"positive"),l.push({name:"UsersIndex"}),c.value={},v.value=null,s.value.resetValidation()})).catch((e=>{(0,m.displayNotification)(e.response.data,"negative")})).finally((()=>{h.value=!1})))}))}}}});var v=l(1639),g=l(9885),y=l(8326),b=l(4581),f=l(6611),h=l(8879),D=l(854),q=l(8359),V=l(9984),_=l.n(V);const I=(0,v.Z)(c,[["render",i]]),U=I;_()(c,"components",{QPage:g.Z,QForm:y.Z,QSelect:b.Z,QInput:f.Z,QBtn:h.Z,QInnerLoading:D.Z,QSpinnerIos:q.Z})}}]);