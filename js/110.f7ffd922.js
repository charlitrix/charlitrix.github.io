"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[110],{110:(e,a,l)=>{l.r(a),l.d(a,{default:()=>Y});var t=l(9835),o=l(6970);const d={class:"row justify-end q-mb-md"},n={key:0},u={key:1},i={class:"flex flex-center"},s={class:"flex flex-center"},r={class:"column q-col-gutter-y-md q-mx-md q-mb-sm"};function m(e,a,l,m,c,p){const g=(0,t.up)("q-btn"),f=(0,t.up)("q-th"),w=(0,t.up)("q-tr"),b=(0,t.up)("q-td"),y=(0,t.up)("q-markup-table"),v=(0,t.up)("q-table"),q=(0,t.up)("q-page"),_=(0,t.up)("q-toolbar-title"),k=(0,t.up)("q-toolbar"),h=(0,t.up)("q-separator"),D=(0,t.up)("q-select"),T=(0,t.up)("q-option-group"),I=(0,t.up)("q-field"),W=(0,t.up)("q-card-section"),Z=(0,t.up)("q-form"),Q=(0,t.up)("q-card"),C=(0,t.up)("q-dialog"),H=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(q,{class:"q-pa-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",d,[e.permissionRequired("accounts","add_draftbudgetplanitems")?((0,t.wg)(),(0,t.j4)(g,{key:0,label:"Create",color:"primary",to:{name:"BudgetDraftCreate"}})):(0,t.kq)("",!0)]),(0,t._)("div",null,[(0,t.Wm)(v,{bordered:"",square:"",separator:"vertical",flat:"",rows:e.tableRows,columns:e.tableColumns,loading:e.loadingData,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",pagination:{rowsPerPage:0}},{header:(0,t.w5)((e=>[(0,t.Wm)(w,{props:e},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(f,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(a.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Actions")])),_:1})])),_:2},1032,["props"])])),body:(0,t.w5)((a=>[(0,t.Wm)(w,{props:a,class:"text-weight-medium"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a.cols,(l=>((0,t.wg)(),(0,t.j4)(b,{key:l.name,props:a},{default:(0,t.w5)((()=>["amount"==l.name?((0,t.wg)(),(0,t.iD)("span",n,(0,o.zw)(e.formatPrice(e.itemsSum(a.row.items))),1)):((0,t.wg)(),(0,t.iD)("span",u,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t._)("div",i,[e.permissionRequired("accounts","add_budgetplanitems")?((0,t.wg)(),(0,t.j4)(g,{key:0,rounded:"","no-caps":"",label:"Add Category",size:"sm","icon-right":"add",color:"blue-8",onClick:l=>e.showAddToBudgetDialog(a.rowIndex,!0),loading:e.submitting},null,8,["onClick","loading"])):(0,t.kq)("",!0),e.permissionRequired("accounts","change_draftbudgetplanitems")?((0,t.wg)(),(0,t.j4)(g,{key:1,rounded:"",flat:"",icon:"edit",color:"primary",to:{name:"BudgetDraftDetails",params:{id:a.row.id}},loading:e.submitting},null,8,["to","loading"])):(0,t.kq)("",!0)])])),_:2},1024)])),_:2},1032,["props"]),(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[(0,t.Wm)(b),(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t.Wm)(y,{square:"",bordered:"",flat:"",class:"text-grey-10"},{default:(0,t.w5)((()=>[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a.row.items,((a,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,o.zw)(a.code),1),(0,t._)("td",null,(0,o.zw)(a.name),1),(0,t._)("td",null,(0,o.zw)(e.formatPrice(a.amount)),1)])))),128))])])),_:2},1024)])),_:2},1024),(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t._)("div",s,[e.permissionRequired("accounts","add_budgetplanitems")?((0,t.wg)(),(0,t.j4)(g,{key:0,rounded:"","no-caps":"",label:"Add Items",size:"sm","icon-right":"add",color:"blue-6",onClick:l=>e.showAddToBudgetDialog(a.rowIndex,!1),loading:e.submitting},null,8,["onClick","loading"])):(0,t.kq)("",!0)])])),_:2},1024),(0,t.Wm)(b)])),_:2},1024)])),_:1},8,["rows","columns","loading"])])])),_:1}),e.permissionRequired("accounts","add_budgetplanitems")?((0,t.wg)(),(0,t.j4)(C,{key:0,persistent:"",modelValue:e.draftItemsDialog,"onUpdate:modelValue":a[3]||(a[3]=a=>e.draftItemsDialog=a)},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{style:{width:"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{ref:"draftItemsForm",onSubmit:e.submitDraftItems},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.selectedDraftCategory.name),1)])),_:1}),(0,t.wy)((0,t.Wm)(g,{flat:"",round:"",size:"md",icon:"close"},null,512),[[H]])])),_:1}),(0,t.Wm)(h),(0,t.Wm)(W,null,{default:(0,t.w5)((()=>[(0,t._)("div",r,[e.showAccountType?((0,t.wg)(),(0,t.j4)(D,{key:0,"emit-value":"","map-options":"",label:"Type",modelValue:e.draftItemsAccountType,"onUpdate:modelValue":a[0]||(a[0]=a=>e.draftItemsAccountType=a),loading:e.loadingAccountTypes,options:e.accountTypes,"option-label":e=>e.name,"option-value":e=>e.id,"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.accountTypes.map((e=>e.id)))},null,8,["modelValue","loading","options","option-label","option-value","rules"])):(0,t.kq)("",!0),(0,t.Wm)(I,{outlined:"",modelValue:e.draftItemsSelected,"onUpdate:modelValue":a[2]||(a[2]=a=>e.draftItemsSelected=a),"lazy-rules":"ondemand",rules:e.nonEmptyRequiredRules("Select items")},{control:(0,t.w5)((()=>[(0,t.Wm)(T,{modelValue:e.draftItemsSelected,"onUpdate:modelValue":a[1]||(a[1]=a=>e.draftItemsSelected=a),options:e.draftItemsOptions,type:"checkbox"},null,8,["modelValue","options"])])),_:1},8,["modelValue","rules"])]),(0,t._)("div",null,[(0,t.Wm)(g,{rounded:"",color:"primary",class:"full-width",label:"Submit",loading:e.submitting,type:"submit"},null,8,["loading"])])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,t.kq)("",!0)],64)}var c=l(499),p=l(9302),g=l(1353),f=l(1809),w=l(4019),b=l(8221);const y=[{name:"code",label:"#",field:"code",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"amount",label:"Amount",field:"",align:"left",sortable:!0}],v=(0,t.aZ)({name:"BudgetDraft",setup(){const e=(0,p.Z)(),a=(0,g.F)(),{fiscalYear:l}=(0,f.Jk)(a),o=(0,c.iH)(!1),d=(0,c.iH)(null),n=(0,c.iH)(""),u=(0,c.iH)([]),i=(0,c.iH)(!1),s=(0,c.iH)({}),r=(0,c.iH)([]),m=(0,c.iH)(null),v=(0,c.iH)([]),q=(0,c.iH)(!1),_=(0,c.iH)([]),k=(0,c.iH)(!0);function h(){return k.value=!0,(0,w.getBudgetDraft)().then((e=>{_.value=e.data})).finally((()=>{k.value=!1}))}function D(){i.value=!0,(0,w.getFiscalYearAccountTypes)(l.value.id).then((e=>{u.value=e.data})).finally((()=>{i.value=!1}))}function T(){return n.value?(delete s.value.id,(0,w.createBudget)(l.value.id,{account_type:m.value,category:{...s.value,items:r.value}})):(0,w.createBudgetItems)(s.value.id,{items:r.value})}return(0,t.bv)((()=>{h().then((()=>{D()}))})),{fiscalYear:l,submitting:o,draftItemsForm:d,showAccountType:n,accountTypes:u,loadingAccountTypes:i,selectedDraftCategory:s,draftItemsSelected:r,draftItemsAccountType:m,draftItemsOptions:v,draftItemsDialog:q,tableColumns:y,tableRows:_,loadingData:k,submitDraftItems(){d.value.validate()&&e.dialog({title:"Confirm",message:"Please",cancel:!0}).onOk((()=>{o.value=!0,T().then((e=>{(0,b.displayNotification)(e.data,"positive"),d.value.resetValidation(),q.value=!1})).catch((e=>{(0,b.displayNotification)(e.response.data,"negative")})).finally((()=>{o.value=!1}))}))},showAddToBudgetDialog(e,a){n.value=a;let l={..._.value[e]};v.value=l.items.map((e=>({label:`${e.code} - ${e.name}`,value:{code:e.code,name:e.name,amount:e.amount}}))),s.value={id:l.id,code:l.code,name:l.name},r.value=[],q.value=!0}}}});var q=l(1639),_=l(9885),k=l(8879),h=l(7355),D=l(3532),T=l(1682),I=l(7220),W=l(6933),Z=l(2074),Q=l(4458),C=l(8326),H=l(1663),A=l(1973),x=l(926),S=l(3190),V=l(4581),z=l(8149),R=l(2286),B=l(2146),j=l(9984),P=l.n(j);const U=(0,q.Z)(v,[["render",m]]),Y=U;P()(v,"components",{QPage:_.Z,QBtn:k.Z,QTable:h.Z,QTr:D.Z,QTh:T.Z,QTd:I.Z,QMarkupTable:W.Z,QDialog:Z.Z,QCard:Q.Z,QForm:C.Z,QToolbar:H.Z,QToolbarTitle:A.Z,QSeparator:x.Z,QCardSection:S.Z,QSelect:V.Z,QField:z.Z,QOptionGroup:R.Z}),P()(v,"directives",{ClosePopup:B.Z})}}]);