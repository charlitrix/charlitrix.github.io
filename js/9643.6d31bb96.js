"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[9643],{9643:(e,t,l)=>{l.r(t),l.d(t,{default:()=>K});var a=l(9835),o=l(6970);const n={class:"row justify-end"},i={class:"row q-col-gutter-md"},d={class:"column justify-center"},u=(0,a._)("div",null,null,-1),s={class:"row q-gutter-x-md"},r={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},m={class:"row no-wrap items-center q-col-gutter-x-sm"},c={class:"row items-center justify-center q-col-gutter-x-md"},p={class:"col-6"},g={class:"col-6 column q-col-gutter-y-sm"},w={class:"row justify-center"},f={class:"row justify-center"},b={class:"q-pa-lg"},v={class:"row items-center justify-center q-col-gutter-x-md"},_={class:"col-6"},y={class:"col-6 column q-col-gutter-y-sm"},k={class:"row justify-center"},W={class:"row justify-center"};function h(e,t,l,h,D,U){const q=(0,a.up)("q-btn"),V=(0,a.up)("q-td"),x=(0,a.up)("q-table"),I=(0,a.up)("q-page"),S=(0,a.up)("q-toolbar-title"),R=(0,a.up)("q-toolbar"),Z=(0,a.up)("q-separator"),C=(0,a.up)("q-item-label"),Q=(0,a.up)("q-item"),H=(0,a.up)("q-select"),j=(0,a.up)("q-item-section"),z=(0,a.up)("q-input"),F=(0,a.up)("q-list"),L=(0,a.up)("q-form"),O=(0,a.up)("q-card"),$=(0,a.up)("q-dialog"),T=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(I,{class:"q-ma-xl"},{default:(0,a.w5)((()=>[(0,a._)("div",n,[e.permissionRequired("restaurant","add_deadstock")?((0,a.wg)(),(0,a.j4)(q,{key:0,rounded:"","no-caps":"",color:"primary",label:"Record Dead Stock",onClick:t[0]||(t[0]=t=>e.createDialog=!e.createDialog)})):(0,a.kq)("",!0)]),(0,a.Wm)(x,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Dead Stock","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No stock available","loading-label":"Loading items..."},{"body-cell-units_available":(0,a.w5)((e=>[(0,a.Wm)(V,{props:e},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",d,[(0,a._)("div",null,(0,o.zw)(e.value),1)]),u])])),_:2},1032,["props"])])),"body-cell-actions":(0,a.w5)((t=>[(0,a.Wm)(V,{props:t},{default:(0,a.w5)((()=>[(0,a._)("div",s,[e.permissionRequired("restaurant","change_deadstock")?((0,a.wg)(),(0,a.j4)(q,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"edit",onClick:l=>e.showEditDeadStockDialog(t.row.id),loading:e.submittedUsageData},null,8,["onClick","loading"])):(0,a.kq)("",!0),e.permissionRequired("restaurant","delete_deadstock")?((0,a.wg)(),(0,a.j4)(q,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittedUsageData,onClick:l=>e.showDeleteStockDeadDialog(t.row.id)},null,8,["loading","onClick"])):(0,a.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,a.Wm)($,{modelValue:e.createDialog,"onUpdate:modelValue":t[2]||(t[2]=t=>e.createDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"70vw",maxWidth:"70vw"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{ref:"createDialogForm",onSubmit:e.submitDeadStockData},{default:(0,a.w5)((()=>[(0,a.Wm)(R,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Record Dead Stock")])),_:1}),(0,a.wy)((0,a.Wm)(q,{flat:"",round:"",size:"md",icon:"close"},null,512),[[T]])])),_:1}),(0,a.Wm)(Z),(0,a._)("div",r,[(0,a.Wm)(H,{"use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingStock,options:e.stockFilterOptions,"input-debounce":"0",onFilter:e.filterStockOptions,"option-label":"name",modelValue:e.stockItem,"onUpdate:modelValue":t[1]||(t[1]=t=>e.stockItem=t),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.stockFilterOptions)},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-grey"},{default:(0,a.w5)((()=>[(0,a.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,a._)("div",null,[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Available")])),_:1})])),_:1}),(0,a.Wm)(Z,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Dead")])),_:1})])),_:1}),(0,a.Wm)(Z,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Reason")])),_:1})])),_:1})])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.stockItemDetails,(t=>((0,a.wg)(),(0,a.j4)(Q,{key:t.id},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.quantity)+" "+(0,o.zw)(t.unit),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a._)("div",null,[(0,a._)("div",c,[(0,a._)("div",p,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:t.whole_number,"onUpdate:modelValue":e=>t.whole_number=e,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",g,[(0,a._)("div",w,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:t.numerator,"onUpdate:modelValue":e=>t.numerator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(Z,{class:"bg-grey-8"})]),(0,a._)("div",f,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:t.denomenator,"onUpdate:modelValue":e=>t.denomenator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])]),(0,a._)("div",null,(0,o.zw)(t.unit),1)])])),_:2},1024),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{outlined:"",modelValue:t.description,"onUpdate:modelValue":e=>t.description=e,type:"textarea","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0==e.stockItemDetails.length?((0,a.wg)(),(0,a.j4)(Q,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"q-py-xl text-center bg-grey-4 text-grey-8 text-h5"},{default:(0,a.w5)((()=>[(0,a.Uk)("Select Item to view units")])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})]),(0,a._)("div",null,[(0,a.Wm)(q,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Create",class:"full-width",type:"submit",disabled:0==e.stockItemDetails.length},null,8,["loading","disabled"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)($,{modelValue:e.editDialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.editDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{ref:"editDialogForm",onSubmit:e.submitEditDeadStockData},{default:(0,a.w5)((()=>[(0,a.Wm)(R,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Edit "+(0,o.zw)(e.editUsageItem.item.name),1)])),_:1}),(0,a.wy)((0,a.Wm)(q,{flat:"",round:"",size:"md",icon:"close"},null,512),[[T]])])),_:1}),(0,a.Wm)(Z),(0,a._)("div",b,[(0,a.Wm)(Q,{header:""},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Reason")])),_:1})])),_:1}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Quantity")])),_:1})])),_:1})])),_:1}),(0,a.Wm)(Z),(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{outlined:"",modelValue:e.editUsageItem.unit.description,"onUpdate:modelValue":t[3]||(t[3]=t=>e.editUsageItem.unit.description=t),type:"textarea","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"])])),_:1}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a._)("div",_,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.whole_number,"onUpdate:modelValue":t[4]||(t[4]=t=>e.editUsageItem.unit.whole_number=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,a._)("div",y,[(0,a._)("div",k,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.numerator,"onUpdate:modelValue":t[5]||(t[5]=t=>e.editUsageItem.unit.numerator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(Z,{class:"bg-grey-8"})]),(0,a._)("div",W,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.denomenator,"onUpdate:modelValue":t[6]||(t[6]=t=>e.editUsageItem.unit.denomenator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])])])])])),_:1}),(0,a.Wm)(j,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.editUsageItem.unit.units),1)])),_:1})])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(q,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Update",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}l(9665);var D=l(9302),U=l(499),q=l(4019);const V=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.item.name,sortable:!0,align:"left"},{name:"units",label:"Units",field:e=>`${e.quantity} ${e.unit}`,sortable:!0,align:"left"},{name:"reason",label:"Reason",field:"description",align:"left"},{name:"date",label:"Date",align:"left",field:"date_time"},{name:"actions",label:"Actions",align:"left"}],x=(0,a.aZ)({name:"RestaurantDeadStock",setup(){const e=(0,D.Z)(),t=(0,U.iH)([]),l=(0,U.iH)(!1),o=(0,U.iH)(!1),n=(0,U.iH)(null),i=(0,U.iH)(!1),d=(0,U.iH)(null),u=(0,a.Fl)((()=>d.value?d.value.units_available_details:[])),s=(0,U.iH)(!1),r=(0,U.iH)([]),m=(0,U.iH)([]),c=(0,U.iH)(!1),p=(0,U.iH)([]),g=(0,U.iH)([]),w=(0,U.iH)({item:{},unit:{}}),f=(0,U.iH)(!1),b=(0,U.iH)(null);function v(){return l.value=!0,(0,q.getRestaurantDeadStock)().then((e=>{t.value=e.data})).catch((e=>{})).finally((()=>{l.value=!1}))}function _(){return s.value=!0,(0,q.getRestaurantItemUnitsOnly)("?available=True").then((e=>{r.value=e.data,m.value=e.data})).finally((()=>{s.value=!1}))}return(0,a.bv)((()=>{v().then((()=>{_()}))})),{loadingData:l,tableRows:t,tableColumns:V,denomenatorList:[null,2,4],stockItem:d,stockItemDetails:u,loadingStock:s,stockFilterOptions:m,loadingUnits:c,unitsFilterOptions:g,createDialog:o,createDialogForm:n,submittedUsageData:i,editUsageItem:w,editDialog:f,editDialogForm:b,filterStockOptions(e,t){t((()=>{m.value=r.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,t){t((()=>{g.value=p.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitDeadStockData(){if(n.value.validate()){let t=[];u.value.forEach((e=>{let l=0;e.whole_number&&e.whole_number>0&&(l=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?l=`${e.denomenator*l+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(l=`${e.denomenator*l}/${e.denomenator}`),t.push({id:e.id,quantity:l,description:e.description})})),(0,q.createRestaurantDeadStock)(d.value.id,{usage:t}).then((t=>{e.notify({type:"positive",message:t.data}),d.value=null,v(),o.value=!1,n.value.resetValidation()})).catch((t=>{e.notify({type:"negative",message:t.response.data.length<1e3?t.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}},showEditDeadStockDialog(e){let l=t.value.find((t=>t.id==e));w.value.item=l.item;let a={id:e,units:l.unit,description:l.description},o=l.quantity.split("(");if(o.length>=1&&(a["whole_number"]=""==o[0]?null:parseInt(o[0])),2==o.length){let e=o[1].split("/");a["numerator"]=parseInt(e[0]),a["denomenator"]=parseInt(e[1].split(")")[0])}w.value.unit=a,f.value=!0},submitEditDeadStockData(){if(b.value.validate()){i.value=!0;let t=w.value.unit,l=0;t.whole_number&&t.whole_number>0&&(l=t.whole_number),t.denomenator&&t.denomenator>0&&t.numerator&&t.numerator>0?l=`${t.denomenator*l+t.numerator}/${t.denomenator}`:t.denomenator&&t.denomenator>0&&(null==t.numerator||0==t.numerator)&&(l=`${t.denomenator*l}/${t.denomenator}`),(0,q.updateRestaurantDeadStock)(w.value.item.id,{id:t.id,quantity:l,description:t.description}).then((t=>{e.notify({type:"positive",message:t.data}),w.value={item:{},unit:{}},v(),f.value=!1,b.value.resetValidation()})).catch((t=>{e.notify({type:"negative",message:t.response.data.length<1e3?t.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}},showDeleteStockDeadDialog(t){e.dialog({title:"Confirm",message:"Confirm deleting of this transaction?",cancel:!0}).onOk((()=>{i.value=!0,(0,q.deleteRestaurantDeadStock)(t).then((t=>{e.notify({type:"positive",message:t.data}),v()})).catch((t=>{e.notify({type:"negative",message:t.response.data.length<1e3?t.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}))}}}});var I=l(1639),S=l(9885),R=l(8879),Z=l(7355),C=l(7220),Q=l(2074),H=l(4458),j=l(8326),z=l(1663),F=l(1973),L=l(926),O=l(4581),$=l(490),T=l(3115),E=l(3246),M=l(1233),P=l(6611),N=l(2146),A=l(9984),Y=l.n(A);const B=(0,I.Z)(x,[["render",h]]),K=B;Y()(x,"components",{QPage:S.Z,QBtn:R.Z,QTable:Z.Z,QTd:C.Z,QDialog:Q.Z,QCard:H.Z,QForm:j.Z,QToolbar:z.Z,QToolbarTitle:F.Z,QSeparator:L.Z,QSelect:O.Z,QItem:$.Z,QItemLabel:T.Z,QList:E.Z,QItemSection:M.Z,QInput:P.Z}),Y()(x,"directives",{ClosePopup:N.Z})}}]);