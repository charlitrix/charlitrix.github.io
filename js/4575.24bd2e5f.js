"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[4575],{4575:(e,l,a)=>{a.r(l),a.d(l,{default:()=>G});var t=a(9835),n=a(6970);const o={class:"row justify-end"},u={class:"column justify-center q-col-gutter-y-sm"},i={class:"column justify-center q-col-gutter-y-sm"},r={class:"row q-gutter-x-md"},d={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},s={class:"row items-center justify-end"},m={class:"row q-col-gutter-x-lg"},c={class:"col-md-6"},p={class:"col-md-6"},w={class:"row justify-end"},f={class:"row items-center justify-center q-col-gutter-x-md"},h={class:"col-6"},_={class:"col-6 column q-col-gutter-y-sm"},b={class:"row justify-center"},g={class:"row justify-center"};function v(e,l,a,v,y,k){const W=(0,t.up)("q-btn"),D=(0,t.up)("q-td"),q=(0,t.up)("q-table"),V=(0,t.up)("q-page"),U=(0,t.up)("q-toolbar-title"),P=(0,t.up)("q-toolbar"),C=(0,t.up)("q-separator"),Z=(0,t.up)("q-item-label"),Q=(0,t.up)("q-item"),x=(0,t.up)("q-select"),H=(0,t.up)("q-date"),z=(0,t.up)("q-popup-proxy"),F=(0,t.up)("q-field"),I=(0,t.up)("q-input"),O=(0,t.up)("q-item-section"),R=(0,t.up)("q-list"),j=(0,t.up)("q-form"),S=(0,t.up)("q-card"),L=(0,t.up)("q-dialog"),K=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(V,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",o,[e.permissionRequired("kitchen","add_purchase")?((0,t.wg)(),(0,t.j4)(W,{key:0,"no-caps":"",rounded:"",color:"primary",label:"Add Purchase",onClick:l[0]||(l[0]=l=>e.createDialog=!e.createDialog)})):(0,t.kq)("",!0)]),(0,t.Wm)(q,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Purchase","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No purchase available","loading-label":"Loading items..."},{"body-cell-id":(0,t.w5)((e=>[(0,t.Wm)(D,{props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.rowIndex+1),1)])),_:2},1032,["props"])])),"body-cell-units_details":(0,t.w5)((l=>[(0,t.Wm)(D,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",u,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.row.units_details,(l=>((0,t.wg)(),(0,t.iD)("div",{key:l.id},(0,n.zw)(l.quantity)+" "+(0,n.zw)(l.unit)+" @ "+(0,n.zw)(e.formatPrice(l.unit_price)),1)))),128))])])),_:2},1032,["props"])])),"body-cell-available":(0,t.w5)((e=>[(0,t.Wm)(D,{props:e},{default:(0,t.w5)((()=>[(0,t._)("div",i,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.units_details,(e=>((0,t.wg)(),(0,t.iD)("div",{key:e.id},(0,n.zw)(e.available)+" "+(0,n.zw)(e.unit),1)))),128))])])),_:2},1032,["props"])])),"body-cell-actions":(0,t.w5)((l=>[(0,t.Wm)(D,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",r,[e.permissionRequired("kitchen","view_purchase")?((0,t.wg)(),(0,t.j4)(W,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"keyboard_arrow_right",to:{name:"KitchenPurchaseDetails",params:{id:l.row.id}}},null,8,["to"])):(0,t.kq)("",!0),e.permissionRequired("kitchen","delete_purchase")?((0,t.wg)(),(0,t.j4)(W,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittedPurchaseData.value,onClick:a=>e.showDeletePurchaseDialog(l.row.id)},null,8,["loading","onClick"])):(0,t.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,t.Wm)(L,{modelValue:e.createDialog,"onUpdate:modelValue":l[7]||(l[7]=l=>e.createDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(S,{style:{width:"650px",maxWidth:"650px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{ref:"addPurchaseForm",onSubmit:e.submitPurchaseData},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.purchaseData.id?"Edit Purchase":"Add New Purchase"),1)])),_:1}),(0,t.wy)((0,t.Wm)(W,{flat:"",round:"",size:"md",icon:"close",onClick:e.clearPurchaseForm},null,8,["onClick"]),[[K]])])),_:1}),(0,t.Wm)(C),(0,t._)("div",d,[(0,t.Wm)(x,{"emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",label:"Item",readonly:!!e.purchaseData.id,loading:e.loadingStock,options:e.stockFilterOptions,"input-debounce":"0",onFilter:e.filterStockOptions,"option-label":"name","option-value":"id",modelValue:e.stockId,"onUpdate:modelValue":l[1]||(l[1]=l=>e.stockId=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.stockFilterOptions.map((e=>e.id)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["readonly","loading","options","onFilter","modelValue","rules"]),(0,t.Wm)(F,{outlined:"",modelValue:e.purchaseData.date,"onUpdate:modelValue":l[4]||(l[4]=l=>e.purchaseData.date=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{control:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.purchaseData.date),1)])),append:(0,t.w5)((()=>[(0,t.Wm)(W,{round:"",color:"primary",icon:"event"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{ref:"dateDialog"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:e.purchaseData.date,"onUpdate:modelValue":[l[2]||(l[2]=l=>e.purchaseData.date=l),l[3]||(l[3]=l=>e.$refs.dateDialog.hide())],mask:"DD/MM/YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",s,[(0,t.wy)((0,t.Wm)(W,{label:"Close",color:"primary",flat:""},null,512),[[K]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,t._)("div",m,[(0,t._)("div",c,[(0,t.Wm)(I,{readonly:"",modelValue:e.purchaseData.units,"onUpdate:modelValue":l[5]||(l[5]=l=>e.purchaseData.units=l),label:"Units",type:"number"},null,8,["modelValue"])]),(0,t._)("div",p,[(0,t.Wm)(I,{readonly:"",modelValue:e.purchaseData.amount,"onUpdate:modelValue":l[6]||(l[6]=l=>e.purchaseData.amount=l),label:"Amount",type:"number"},null,8,["modelValue"])])]),(0,t._)("div",null,[(0,t._)("div",w,[(0,t.Wm)(W,{unelevated:"",label:"Add",color:"primary",onClick:e.addUnit},null,8,["onClick"])]),(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit")])),_:1})])),_:1}),(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Quantity")])),_:1})])),_:1}),(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit Price")])),_:1})])),_:1})])),_:1}),(0,t.Wm)(C),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.purchaseData.units_details,((l,a)=>((0,t.wg)(),(0,t.j4)(Q,{key:a},{default:(0,t.w5)((()=>[(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{"map-options":"","emit-value":"","use-input":"","fill-input":"","hide-selected":"",outlined:"",modelValue:l.unit,"onUpdate:modelValue":e=>l.unit=e,loading:e.loadingUnits,options:e.unitsFilterOptions,"input-debounce":"0",onFilter:e.filterUnitsOptions,"option-label":"name","option-value":"name","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.unitsFilterOptions.map((e=>e.name)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","loading","options","onFilter","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t._)("div",f,[(0,t._)("div",h,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.whole_number,"onUpdate:modelValue":e=>l.whole_number=e,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",_,[(0,t._)("div",b,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.numerator,"onUpdate:modelValue":e=>l.numerator=e,modelModifiers:{number:!0},class:"col-10"},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",null,[(0,t.Wm)(C,{class:"bg-grey-8"})]),(0,t._)("div",g,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.denomenator,"onUpdate:modelValue":e=>l.denomenator=e,modelModifiers:{number:!0},class:"col-10"},null,8,["modelValue","onUpdate:modelValue"])])])])])),_:2},1024),(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{outlined:"",modelValue:l.unit_price,"onUpdate:modelValue":e=>l.unit_price=e,modelModifiers:{number:!0},type:"number","lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(O,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{unelevated:"",round:"",color:"red",icon:"delete",size:"sm",onClick:l=>e.deleteUnit(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,t._)("div",null,[(0,t.Wm)(W,{rounded:"",loading:e.submittedPurchaseData,color:"primary",label:e.purchaseData.id?"Update":"Create",class:"full-width",type:"submit"},null,8,["loading","label"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}a(9665);var y=a(9302),k=a(499),W=a(4019),D=a(8221);const q=[{name:"id",label:"#",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.stock_item.name,sortable:!0,align:"left"},{name:"amount",label:"Amount",field:e=>`${(0,D.formatPrice)(e.amount)}`,sortable:!0,align:"left"},{name:"units",label:"Units",field:"units",align:"left"},{name:"units_details",label:"Units Details",align:"left"},{name:"available",label:"Available",align:"left"},{name:"date",label:"Date",field:"date",sortable:!0,align:"left"},{name:"actions",label:"Actions",align:"left"}],V=(0,t.aZ)({name:"PurchaseIndex",setup(){const e=(0,y.Z)(),l=(0,k.iH)([]),a=(0,k.iH)(!1),n=(0,k.iH)(),o=(0,k.iH)(!1),u=(0,k.iH)(!1),i=(0,k.iH)(null),r=(0,k.iH)({units_details:[]}),d=(0,k.iH)(!1),s=(0,k.iH)([]),m=(0,k.iH)([]),c=(0,k.iH)(!1),p=(0,k.iH)([]),w=(0,k.iH)([]);function f(){return a.value=!0,(0,W.getKitchenPurchases)().then((e=>{l.value=e.data})).catch((e=>{})).finally((()=>{a.value=!1}))}function h(){c.value=!0,(0,W.getUnits)().then((e=>{p.value=e.data,w.value=e.data})).finally((()=>{c.value=!1}))}function _(){return d.value=!0,(0,W.getKitchenStock)().then((e=>{s.value=e.data,m.value=e.data})).finally((()=>{d.value=!1}))}function b(){i.value=null,r.value={units_details:[]}}return(0,t.bv)((()=>{f().then((()=>{_().then((()=>{h()}))}))})),(0,t.m0)((()=>{r.value.amount=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+l.unit_price*a}),0),r.value.units=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+a}),0)})),{addPurchaseForm:n,loadingData:a,tableRows:l,tableColumns:q,stockId:i,purchaseData:r,loadingStock:d,stockFilterOptions:m,loadingUnits:c,unitsFilterOptions:w,createDialog:o,submittedPurchaseData:u,clearPurchaseForm:b,addUnit(){r.value.units_details.push({unit:null,unit_price:null,quantity:null})},filterStockOptions(e,l){l((()=>{m.value=s.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,l){l((()=>{w.value=p.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitPurchaseData(){n.value.validate()&&e.dialog({title:"Confirm",message:"Please confirm.",cancel:!0}).onOk((()=>{u.value=!0;let l=[];r.value.units_details.forEach((e=>{let a=0;e.whole_number&&e.whole_number>0&&(a=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?a=`${e.denomenator*a+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(a=`${e.denomenator*a}/${e.denomenator}`),l.push({unit:e.unit,unit_price:e.unit_price,quantity:a})})),(0,W.createKitchenPurchase)(i.value,{...r.value,units_details:l}).then((l=>{e.notify({type:"positive",message:l.data}),b(),f(),o.value=!1,n.value.resetValidation()})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{u.value=!1}))}))},showDeletePurchaseDialog(l){e.dialog({title:"Confirm",message:"Confirm delete of the transaction.",cancel:!0}).onOk((()=>{(0,W.deleteKitchenPurchase)(l).then((l=>{e.notify({type:"positive",message:l.data}),f()})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{u.value=!1}))}))}}}});var U=a(1639),P=a(9885),C=a(8879),Z=a(7355),Q=a(7220),x=a(2074),H=a(4458),z=a(8326),F=a(1663),I=a(1973),O=a(926),R=a(4581),j=a(490),S=a(3115),L=a(8149),K=a(2765),Y=a(4351),A=a(6611),T=a(3246),M=a(1233),$=a(2146),N=a(9984),E=a.n(N);const B=(0,U.Z)(V,[["render",v]]),G=B;E()(V,"components",{QPage:P.Z,QBtn:C.Z,QTable:Z.Z,QTd:Q.Z,QDialog:x.Z,QCard:H.Z,QForm:z.Z,QToolbar:F.Z,QToolbarTitle:I.Z,QSeparator:O.Z,QSelect:R.Z,QItem:j.Z,QItemLabel:S.Z,QField:L.Z,QPopupProxy:K.Z,QDate:Y.Z,QInput:A.Z,QList:T.Z,QItemSection:M.Z}),E()(V,"directives",{ClosePopup:$.Z})}}]);