"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[643],{643:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Z});var t=a(9835);const i={class:"row justify-end"},n={class:"row no-wrap q-gutter-x-md"},o={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},s={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"};function d(e,l,a,d,u,r){const m=(0,t.up)("q-btn"),p=(0,t.up)("q-td"),c=(0,t.up)("q-table"),v=(0,t.up)("q-page"),g=(0,t.up)("q-toolbar-title"),b=(0,t.up)("q-toolbar"),x=(0,t.up)("q-separator"),f=(0,t.up)("q-select"),y=(0,t.up)("q-input"),w=(0,t.up)("q-form"),h=(0,t.up)("q-card"),q=(0,t.up)("q-dialog"),D=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",i,[e.permissionRequired("otherservices","add_expense")?((0,t.wg)(),(0,t.j4)(m,{key:0,"no-caps":"",rounded:"",color:"primary",label:"Add Expense",onClick:l[0]||(l[0]=l=>e.addExpenseDialog=!e.addExpenseDialog)})):(0,t.kq)("",!0)]),(0,t.Wm)(c,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Expenses","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No expenses available","loading-label":"Loading expenses..."},{"body-cell-actions":(0,t.w5)((l=>[(0,t.Wm)(p,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",n,[e.permissionRequired("otherservices","add_expense")?((0,t.wg)(),(0,t.j4)(m,{key:0,round:"",size:"sm",color:"primary",icon:"add",onClick:a=>e.addExpense(l.rowIndex)},null,8,["onClick"])):(0,t.kq)("",!0),e.permissionRequired("otherservices","change_expense")?((0,t.wg)(),(0,t.j4)(m,{key:1,round:"",size:"sm",color:"primary",icon:"edit",onClick:a=>e.selectEditItem(l.rowIndex)},null,8,["onClick"])):(0,t.kq)("",!0),e.permissionRequired("otherservices","delete_expense")?((0,t.wg)(),(0,t.j4)(m,{key:2,round:"",size:"sm",color:"red",icon:"delete",onClick:a=>e.showDeleteDialog(l.row.id)},null,8,["onClick"])):(0,t.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,t.Wm)(q,{modelValue:e.addExpenseDialog,"onUpdate:modelValue":l[4]||(l[4]=l=>e.addExpenseDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{style:{width:"350px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{ref:"addExpenseDialogForm",onSubmit:e.submitExpenseData},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Expense")])),_:1}),(0,t.wy)((0,t.Wm)(m,{flat:"",round:"",size:"md",icon:"close"},null,512),[[D]])])),_:1}),(0,t.Wm)(x),(0,t._)("div",o,[(0,t.Wm)(f,{"emit-value":"","map-options":"",modelValue:e.serviceId,"onUpdate:modelValue":l[1]||(l[1]=l=>e.serviceId=l),loading:e.loadingServices,options:e.servicesOptions,label:"Service","option-label":"name","option-value":"id","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.servicesOptions.map((e=>e.id)))},null,8,["modelValue","loading","options","rules"]),(0,t.Wm)(y,{modelValue:e.expenseData.name,"onUpdate:modelValue":l[2]||(l[2]=l=>e.expenseData.name=l),modelModifiers:{trim:!0},label:"Name","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t.Wm)(y,{modelValue:e.expenseData.amount,"onUpdate:modelValue":l[3]||(l[3]=l=>e.expenseData.amount=l),modelModifiers:{number:!0},type:"number",label:"Amount","lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,t._)("div",null,[(0,t.Wm)(m,{rounded:"","no-caps":"",loading:e.submittedExpenseData,color:"primary",label:"Add",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(q,{modelValue:e.updateDialog,"onUpdate:modelValue":l[7]||(l[7]=l=>e.updateDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{style:{width:"350px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{ref:"updateDialogForm",onSubmit:e.updateExpenseData},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Update Expense Item")])),_:1}),(0,t.wy)((0,t.Wm)(m,{flat:"",round:"",size:"md",icon:"close"},null,512),[[D]])])),_:1}),(0,t.Wm)(x),(0,t._)("div",s,[(0,t.Wm)(f,{"emit-value":"","map-options":"",modelValue:e.editExpenseItem.service_id,"onUpdate:modelValue":l[5]||(l[5]=l=>e.editExpenseItem.service_id=l),loading:e.loadingServices,options:e.servicesOptions,label:"Service","option-label":"name","option-value":"id","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.servicesOptions.map((e=>e.id)))},null,8,["modelValue","loading","options","rules"]),(0,t.Wm)(y,{modelValue:e.editExpenseItem.name,"onUpdate:modelValue":l[6]||(l[6]=l=>e.editExpenseItem.name=l),modelModifiers:{trim:!0},label:"Name","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t._)("div",null,[(0,t.Wm)(m,{rounded:"","no-caps":"",loading:e.submittedExpenseData,color:"primary",label:"Update",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}var u=a(9302),r=a(499),m=a(4019),p=a(8221);const c=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"service",label:"Service",field:e=>e.service.name,sortable:!0,align:"left"},{name:"expense",label:"Expense",field:"name",sortable:!0,align:"left"},{name:"amount",label:"Amount",field:e=>(0,p.formatPrice)(e.amount),sortable:!0,align:"left"},{name:"date",label:"Date",field:"created",sortable:!0,align:"left"},{name:"actions",label:"Actions",align:"left"}],v=(0,t.aZ)({name:"ExpensesIndex",setup(){const e=(0,u.Z)(),l=(0,r.iH)([]),a=(0,r.iH)(!1),i=(0,r.iH)(!1),n=(0,r.iH)(null),o=(0,r.iH)(!1),s=(0,r.iH)({}),d=(0,r.iH)([]),v=(0,r.iH)(!1),g=(0,r.iH)(null),b=(0,r.iH)(!1),x=(0,r.iH)(null),f=(0,r.iH)({});function y(){return a.value=!0,(0,m.getOtherServicesExpenses)().then((e=>{l.value=e.data})).catch((e=>{})).finally((()=>{a.value=!1}))}function w(){v.value=!0,(0,m.getOtherServices)().then((e=>{d.value=e.data})).finally((()=>{v.value=!1}))}return(0,t.bv)((()=>{y().then((()=>{w()}))})),{loadingData:a,tableRows:l,tableColumns:c,expenseData:s,addExpenseDialog:i,addExpenseDialogForm:n,submittedExpenseData:o,servicesOptions:d,loadingServices:v,serviceId:g,editExpenseItem:f,updateDialog:b,updateDialogForm:x,selectEditItem(e){let a=l.value[e];f.value={service_id:a.service.id,id:a.id,name:a.name},b.value=!0},updateExpenseData(){o.value=!0;let l=f.value.id;delete f.value.id,(0,m.editOtherServicesExpense)(l,{...f.value}).then((l=>{e.notify({type:"positive",message:l.data}),f.value={},y(),b.value=!1})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{o.value=!1}))},submitExpenseData(){n.value.validate()&&(o.value=!0,(0,m.createOtherServicesExpense)(g.value,{...s.value}).then((l=>{e.notify({type:"positive",message:l.data}),s.value={},g.value=null,y(),i.value=!1,n.value.resetValidation()})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{o.value=!1})))},addExpense(e){s.value={...l.value[e],amount:null},i.value=!0},showDeleteDialog(l){e.dialog({title:"Confirm",message:"Please confirm delete?",cancel:!0}).onOk((()=>{o.value=!0,(0,m.deleteOtherServicesExpense)(l).then((e=>{(0,p.displayNotification)(e.data,"positive"),y()})).catch((e=>{(0,p.displayNotification)(e.response.data,"negative")})).finally((()=>{o.value=!1}))}))}}}});var g=a(1639),b=a(9885),x=a(8879),f=a(7355),y=a(7220),w=a(2074),h=a(4458),q=a(8326),D=a(1663),E=a(1973),_=a(926),W=a(4581),k=a(6611),V=a(2146),I=a(9984),S=a.n(I);const R=(0,g.Z)(v,[["render",d]]),Z=R;S()(v,"components",{QPage:b.Z,QBtn:x.Z,QTable:f.Z,QTd:y.Z,QDialog:w.Z,QCard:h.Z,QForm:q.Z,QToolbar:D.Z,QToolbarTitle:E.Z,QSeparator:_.Z,QSelect:W.Z,QInput:k.Z}),S()(v,"directives",{ClosePopup:V.Z})}}]);