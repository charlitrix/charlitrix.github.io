"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[1926],{4737:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Ue});var o=a(9835),t=a(6970),r=a(1957);const s=(0,o._)("div",{class:"text-h5"},"Room Booking",-1),u={class:"column shadow-21 q-mb-xl q-ma-sm"},m={style:{border:"1px solid grey"},class:"q-pa-lg"},d=(0,o._)("div",{class:"row items-center q-col-gutter-x-md q-mb-md"},[(0,o._)("div",{class:"text-h5"},"Customer Details")],-1),i={class:"q-mb-md column q-col-gutter-y-md"},n={class:"row q-col-gutter-x-xl"},c={class:"col-6"},p={class:"col-6"},_={class:"row q-col-gutter-x-xl"},v={class:"col-6"},b={class:"col-6"},f={class:"row q-col-gutter-x-xl"},y={class:"col-6"},w={class:"col-6"},D={class:"row q-col-gutter-x-xl"},g={class:"col-6"},q={class:"col-6"},V=(0,o._)("div",{class:"row items-center q-col-gutter-x-md q-mb-sm"},[(0,o._)("div",{class:"text-h5"},"Rooms")],-1),W={class:"full-width"},x=(0,o._)("thead",{class:"bg-blue-7 text-white"},[(0,o._)("tr",null,[(0,o._)("th",{class:"text-left"},"Item"),(0,o._)("th",{class:"text-left"},"Qty"),(0,o._)("th",{class:"text-left"},"Amount"),(0,o._)("th",{class:"text-left"})])],-1),k={class:"column text-weight-bold"},h={class:"row items-center"},R=(0,o._)("div",{class:"col-2"},"From:",-1),U={class:"col"},F={class:"row justify-end"},Y={class:"row items-center"},Z=(0,o._)("div",{class:"col-2"},"To:",-1),z={class:"col"},C={class:"row justify-end"},Q={class:"text-center full-width ellipsis",style:{maxWidth:"45px"}},P={key:0},S=(0,o._)("td",{colspan:"100%",class:"q-pa-lg bg-grey-4 text-grey-9"},[(0,o._)("div",null,"No rooms added...")],-1),T=[S],M={class:"bg-blue-1"},I={key:0,class:"text-h6"},H=(0,o._)("td",{colspan:"2"},"Total",-1),N={colspan:"2"},$={class:"q-mx-lg"},j=(0,o._)("div",{class:"q-my-md"},null,-1),A=(0,o._)("div",{class:"q-my-xl"},null,-1),B=(0,o._)("div",{class:"q-my-xl"},null,-1),E={class:"q-ma-sm"},O={class:"column q-col-gutter-y-lg q-mt-md q-mx-lg q-mb-xl"},K={class:"row justify-end"},L={class:"row justify-end"};function G(e,l,a,S,G,J){const X=(0,o.up)("q-separator"),ee=(0,o.up)("q-input"),le=(0,o.up)("q-btn"),ae=(0,o.up)("q-date"),oe=(0,o.up)("q-popup-proxy"),te=(0,o.up)("q-popup-edit"),re=(0,o.up)("q-field"),se=(0,o.up)("q-markup-table"),ue=(0,o.up)("q-form"),me=(0,o.up)("q-td"),de=(0,o.up)("q-table"),ie=(0,o.up)("q-splitter"),ne=(0,o.up)("q-toolbar-title"),ce=(0,o.up)("q-toolbar"),pe=(0,o.up)("q-select"),_e=(0,o.up)("q-card"),ve=(0,o.up)("q-dialog"),be=(0,o.up)("q-page"),fe=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(be,{class:"q-ma-lg"},{default:(0,o.w5)((()=>[s,(0,o.Wm)(X,{class:"q-my-md bg-dark"}),(0,o.Wm)(ie,{modelValue:e.layoutSplitter,"onUpdate:modelValue":l[9]||(l[9]=l=>e.layoutSplitter=l)},{before:(0,o.w5)((()=>[(0,o._)("div",u,[(0,o._)("div",m,[(0,o.Wm)(ue,{ref:"saleForm",onSubmit:e.saveBooking},{default:(0,o.w5)((()=>[d,(0,o._)("div",i,[(0,o._)("div",n,[(0,o._)("div",c,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"Name",modelValue:e.saleData.customer.name,"onUpdate:modelValue":l[0]||(l[0]=l=>e.saleData.customer.name=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"])]),(0,o._)("div",p,[(0,o.Wm)(ee,{dense:"",outlined:"",mask:"### ### ######","unmasked-value":"",label:"Contact",modelValue:e.saleData.customer.contact,"onUpdate:modelValue":l[1]||(l[1]=l=>e.saleData.customer.contact=l),"lazy-rules":"ondemand",rules:e.contactRequiredRules()},null,8,["modelValue","rules"])])]),(0,o._)("div",_,[(0,o._)("div",v,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"Address",modelValue:e.saleData.customer.address,"onUpdate:modelValue":l[2]||(l[2]=l=>e.saleData.customer.address=l)},null,8,["modelValue"])]),(0,o._)("div",b,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"ID No",modelValue:e.saleData.customer.identification_number,"onUpdate:modelValue":l[3]||(l[3]=l=>e.saleData.customer.identification_number=l)},null,8,["modelValue"])])]),(0,o._)("div",f,[(0,o._)("div",y,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"Nationality",modelValue:e.saleData.customer.nationality,"onUpdate:modelValue":l[4]||(l[4]=l=>e.saleData.customer.nationality=l)},null,8,["modelValue"])]),(0,o._)("div",w,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"District",modelValue:e.saleData.customer.district,"onUpdate:modelValue":l[5]||(l[5]=l=>e.saleData.customer.district=l)},null,8,["modelValue"])])]),(0,o._)("div",D,[(0,o._)("div",g,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"Occupation",modelValue:e.saleData.customer.occupation,"onUpdate:modelValue":l[6]||(l[6]=l=>e.saleData.customer.occupation=l)},null,8,["modelValue"])]),(0,o._)("div",q,[(0,o.Wm)(ee,{dense:"",outlined:"",label:"Organisation",modelValue:e.saleData.customer.organisation,"onUpdate:modelValue":l[7]||(l[7]=l=>e.saleData.customer.organisation=l)},null,8,["modelValue"])])])]),V,(0,o._)("div",null,[(0,o.Wm)(re,{ref:"saleRoomsTable",outlined:e.$refs.saleRoomsTable&&e.$refs.saleRoomsTable.hasError,borderless:e.$refs.saleRoomsTable&&!e.$refs.saleRoomsTable.hasError,"no-error-icon":"",modelValue:e.saleData.rooms,"onUpdate:modelValue":l[8]||(l[8]=l=>e.saleData.rooms=l),"lazy-rules":"ondemand",rules:e.nonEmptyRequiredRules()},{control:(0,o.w5)((()=>[(0,o._)("div",W,[(0,o.Wm)(se,{square:"",flat:"",bordered:"","wrap-cells":""},{default:(0,o.w5)((()=>[x,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.saleData.rooms,((l,a)=>((0,o.wg)(),(0,o.iD)("tr",{key:a},[(0,o._)("td",null,[(0,o._)("div",{style:(0,t.j5)({fontSize:".8rem"})},(0,t.zw)(l.name)+"@"+(0,t.zw)(e.formatPrice(l.sale_rate.amount)),5),(0,o.Wm)(X,{class:"q-mt-sm"}),(0,o._)("div",k,[(0,o._)("div",h,[R,(0,o._)("div",U,[(0,o.Uk)((0,t.zw)(l.arrival)+" ",1),(0,o._)("span",null,[(0,o.Wm)(le,{round:"",size:"sm",flat:"",icon:"event",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{modelValue:l.arrival,"onUpdate:modelValue":e=>l.arrival=e,mask:"DD/MM/YYYY"},{default:(0,o.w5)((()=>[(0,o._)("div",F,[(0,o.wy)((0,o.Wm)(le,{label:"Close",flat:"",color:"primary"},null,512),[[fe]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])])]),(0,o._)("div",Y,[Z,(0,o._)("div",z,[(0,o.Uk)((0,t.zw)(l.departure)+" ",1),(0,o._)("span",null,[(0,o.Wm)(le,{round:"",size:"sm",flat:"",icon:"event",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{modelValue:l.departure,"onUpdate:modelValue":e=>l.departure=e,mask:"DD/MM/YYYY"},{default:(0,o.w5)((()=>[(0,o._)("div",C,[(0,o.wy)((0,o.Wm)(le,{label:"Close",flat:"",color:"primary"},null,512),[[fe]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])])])])]),(0,o._)("td",null,[(0,o.Wm)(re,{outlined:"",dense:""},{control:(0,o.w5)((()=>[(0,o._)("div",Q,(0,t.zw)(l.quantity),1),(0,o.Wm)(te,{modelValue:l.quantity,"onUpdate:modelValue":e=>l.quantity=e,"auto-save":""},{default:(0,o.w5)((e=>[(0,o.Wm)(ee,{type:"number",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dense:"",autofocus:"",onKeyup:(0,r.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),prepend:(0,o.w5)((()=>[(0,o.Wm)(le,{outline:"",round:"",dense:"",size:"sm",color:"primary",icon:"remove",onClick:e=>1!=l.quantity?l.quantity=l.quantity-1:l.quantity=l.quantity},null,8,["onClick"])])),append:(0,o.w5)((()=>[(0,o.Wm)(le,{outline:"",round:"",dense:"",size:"sm",color:"primary",icon:"add",onClick:e=>l.quantity=l.quantity+1},null,8,["onClick"])])),_:2},1024)]),(0,o._)("td",null,(0,t.zw)(e.formatPrice(l.total_price)),1),(0,o._)("td",null,[(0,o.Wm)(le,{round:"",size:"sm",color:"red",icon:"delete",onClick:l=>e.removeRoom(a)},null,8,["onClick"])])])))),128)),0==e.saleData.rooms.length?((0,o.wg)(),(0,o.iD)("tr",P,T)):(0,o.kq)("",!0)]),(0,o._)("tfoot",M,[e.saleData.rooms.length>0?((0,o.wg)(),(0,o.iD)("tr",I,[H,(0,o._)("td",N,(0,t.zw)(e.formatPrice(e.itemsSum(e.saleData.rooms,"total_price"))),1)])):(0,o.kq)("",!0)])])),_:1})])])),_:1},8,["outlined","borderless","modelValue","rules"])]),(0,o._)("div",$,[j,(0,o.Wm)(le,{"no-caps":"",rounded:"",type:"submit",label:"Save Booking",color:"primary",class:"full-width",loading:e.submitting},null,8,["loading"])])])),_:1},8,["onSubmit"]),A,B])])])),after:(0,o.w5)((()=>[(0,o._)("div",E,[(0,o.Wm)(de,{flat:"",bordered:"","hide-pagination":"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Rooms","row-key":"id","no-data-label":"No rooms available","loading-label":"Loading rooms..."},{"body-cell-actions":(0,o.w5)((l=>[(0,o.Wm)(me,{props:l},{default:(0,o.w5)((()=>[(0,o.Wm)(le,{round:"",size:"sm",icon:"add",class:"q-ml-md",color:"primary",onClick:a=>e.selectRoom(l.rowIndex),disable:l.row.available_units<1},null,8,["onClick","disable"])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])])),_:1},8,["modelValue"]),(0,o.Wm)(ve,{modelValue:e.roomFormDialog,"onUpdate:modelValue":l[18]||(l[18]=l=>e.roomFormDialog=l)},{default:(0,o.w5)((()=>[(0,o.Wm)(_e,{style:{width:"600px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(ue,{ref:"roomForm",onSubmit:e.addRoom},{default:(0,o.w5)((()=>[(0,o.Wm)(ce,{class:"bg-primary text-white"},{default:(0,o.w5)((()=>[(0,o.Wm)(ne,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Room Details")])),_:1}),(0,o.wy)((0,o.Wm)(le,{flat:"",round:"",size:"md",icon:"close"},null,512),[[fe]])])),_:1}),(0,o.Wm)(X),(0,o._)("div",O,[(0,o.Wm)(pe,{label:"Price",outlined:"",modelValue:e.roomFormData.sale_rate,"onUpdate:modelValue":l[10]||(l[10]=l=>e.roomFormData.sale_rate=l),options:e.roomFormData.sale_rates,"option-label":l=>`${e.formatPrice(l.amount)} @ ${l.unit}`,"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.roomFormData.sale_rates)},null,8,["modelValue","options","option-label","rules"]),(0,o.Wm)(re,{outlined:"",label:"Arrival",modelValue:e.roomFormData.arrival,"onUpdate:modelValue":l[13]||(l[13]=l=>e.roomFormData.arrival=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{control:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.roomFormData.arrival),1)])),append:(0,o.w5)((()=>[(0,o.Wm)(le,{round:"",flat:"",icon:"event",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(oe,{ref:"arrivalDateDialog"},{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{mask:"DD/MM/YYYY",modelValue:e.roomFormData.arrival,"onUpdate:modelValue":[l[11]||(l[11]=l=>e.roomFormData.arrival=l),l[12]||(l[12]=l=>e.$refs.arrivalDateDialog.hide())]},{default:(0,o.w5)((()=>[(0,o._)("div",K,[(0,o.wy)((0,o.Wm)(le,{label:"Close",flat:"",color:"primary"},null,512),[[fe]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,o.Wm)(re,{outlined:"",label:"Departure",modelValue:e.roomFormData.departure,"onUpdate:modelValue":l[16]||(l[16]=l=>e.roomFormData.departure=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{control:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.roomFormData.departure),1)])),append:(0,o.w5)((()=>[(0,o.Wm)(le,{round:"",flat:"",icon:"event",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(oe,{ref:"departureDateDialog"},{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{mask:"DD/MM/YYYY",modelValue:e.roomFormData.departure,"onUpdate:modelValue":[l[14]||(l[14]=l=>e.roomFormData.departure=l),l[15]||(l[15]=l=>e.$refs.departureDateDialog.hide())]},{default:(0,o.w5)((()=>[(0,o._)("div",L,[(0,o.wy)((0,o.Wm)(le,{label:"Close",flat:"",color:"primary"},null,512),[[fe]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,o.Wm)(ee,{outlined:"",modelValue:e.roomFormData.quantity,"onUpdate:modelValue":l[17]||(l[17]=l=>e.roomFormData.quantity=l),modelModifiers:{number:!0},type:"number",label:"Number of rooms",min:"1","lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,o._)("div",null,[(0,o.Wm)(le,{rounded:"",type:"submit",label:"Add",class:"full-width",color:"primary"})])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])])),_:1})}a(9665);var J=a(9302),X=a(4170),ee=a(499),le=a(8339),ae=a(4019),oe=a(8221);const te=[{name:"name",label:"Name",field:"name",sortable:!0,align:"left"},{name:"available_units",label:"Available",field:"available_units",sortable:!0,align:"left"},{name:"capacity",label:"Persons",field:"adults_capacity",align:"left"},{name:"actions",label:"",align:"left"}],re=(0,o.aZ)({name:"RoomBooking",setup(){const e=(0,J.Z)(),l=(0,le.tv)(),a=(0,ee.iH)(55),t=(0,ee.iH)([]),r=(0,ee.iH)(!1),s=(0,ee.iH)(!1),u=(0,ee.iH)(null),m=(0,ee.iH)({customer:{},rooms:[]}),d=(0,ee.iH)(null),i=(0,ee.iH)({}),n=(0,ee.iH)(null);function c(){r.value=!0,(0,ae.getRooms)().then((e=>{t.value=e.data})).finally((()=>{r.value=!1}))}return(0,o.m0)((()=>{m.value.rooms.forEach((e=>{e.arrival&&e.departure?e.total_price=(X.ZP.getDateDiff(X.ZP.extractDate(e.departure,"DD/MM/YYYY"),X.ZP.extractDate(e.arrival,"DD/MM/YYYY"))+1)*e.sale_rate.amount*e.quantity:e.total_price=0}))})),(0,o.bv)((()=>{c()})),{layoutSplitter:a,tableRows:t,loadingData:r,tableColumns:te,saleForm:u,saleData:m,roomForm:d,roomFormDialog:n,roomFormData:i,submitting:s,selectRoom(e){i.value={...t.value[e],quantity:1},n.value=!0},addRoom(){u.value.resetValidation(),m.value.rooms.push({...i.value}),i.value={},n.value=!1},removeRoom(l){e.dialog({message:"Confirm delete?",cancel:!0}).onOk((()=>{m.value.rooms.splice(l,1)}))},saveBooking(){e.dialog({title:"Confirm",message:"Are you sure?",cancel:!0,ok:"Yes",cancel:"No"}).onOk((()=>{if(u.value.validate()){s.value=!0;let e=m.value.rooms.map((e=>({room_id:e.id,arrival:e.arrival,departure:e.departure,quantity:e.quantity,sale_rate_id:e.sale_rate.id})));(0,ae.createRoomSale)({...m.value,rooms:e}).then((e=>{(0,oe.displayNotification)(e.data.message,"positive"),l.push({name:"RoomsSalesDetails",params:{Id:parseInt(e.data.sale)}})})).catch((e=>{(0,oe.displayNotification)(e,"negative",{error:!0})})).finally((()=>{s.value=!1}))}}))}}}});var se=a(1639),ue=a(9885),me=a(926),de=a(7498),ie=a(8326),ne=a(6611),ce=a(8149),pe=a(6933),_e=a(8879),ve=a(2765),be=a(4351),fe=a(5863),ye=a(7355),we=a(7220),De=a(2074),ge=a(4458),qe=a(1663),Ve=a(1973),We=a(4581),xe=a(2146),ke=a(9984),he=a.n(ke);const Re=(0,se.Z)(re,[["render",G]]),Ue=Re;he()(re,"components",{QPage:ue.Z,QSeparator:me.Z,QSplitter:de.Z,QForm:ie.Z,QInput:ne.Z,QField:ce.Z,QMarkupTable:pe.Z,QBtn:_e.Z,QPopupProxy:ve.Z,QDate:be.Z,QPopupEdit:fe.Z,QTable:ye.Z,QTd:we.Z,QDialog:De.Z,QCard:ge.Z,QToolbar:qe.Z,QToolbarTitle:Ve.Z,QSelect:We.Z}),he()(re,"directives",{ClosePopup:xe.Z})}}]);