"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[3468],{3468:(e,t,l)=>{l.r(t),l.d(t,{default:()=>G});var a=l(9835),o=l(6970);const n={class:"row justify-end"},i={class:"row q-col-gutter-md"},u={class:"column justify-center"},s=(0,a._)("div",null,null,-1),d={class:"row q-gutter-x-md"},m={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},r={class:"row no-wrap items-center q-col-gutter-x-sm"},c={class:"row items-center justify-center q-col-gutter-x-md"},g={class:"col-6"},p={class:"col-6 column q-col-gutter-y-sm"},w={class:"row justify-center"},f={class:"row justify-center"},b={class:"q-pa-lg"},v={class:"row items-center justify-center q-col-gutter-x-md"},_={class:"col-6"},y={class:"col-6 column q-col-gutter-y-sm"},k={class:"row justify-center"},h={class:"row justify-center"};function U(e,t,l,U,W,q){const D=(0,a.up)("q-btn"),V=(0,a.up)("q-td"),x=(0,a.up)("q-table"),I=(0,a.up)("q-page"),S=(0,a.up)("q-toolbar-title"),Z=(0,a.up)("q-toolbar"),C=(0,a.up)("q-separator"),H=(0,a.up)("q-item-label"),Q=(0,a.up)("q-item"),j=(0,a.up)("q-select"),F=(0,a.up)("q-item-section"),L=(0,a.up)("q-input"),$=(0,a.up)("q-list"),z=(0,a.up)("q-form"),O=(0,a.up)("q-card"),R=(0,a.up)("q-dialog"),T=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(I,{class:"q-ma-xl"},{default:(0,a.w5)((()=>[(0,a._)("div",n,[e.permissionRequired("kitchen","add_stockusedtracking")?((0,a.wg)(),(0,a.j4)(D,{key:0,rounded:"","no-caps":"",color:"primary",label:"Record Used Items",onClick:t[0]||(t[0]=t=>e.createDialog=!e.createDialog)})):(0,a.kq)("",!0)]),(0,a.Wm)(x,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Stock Usage","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No usage available","loading-label":"Loading items..."},{"body-cell-units_available":(0,a.w5)((e=>[(0,a.Wm)(V,{props:e},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",u,[(0,a._)("div",null,(0,o.zw)(e.value),1)]),s])])),_:2},1032,["props"])])),"body-cell-actions":(0,a.w5)((t=>[(0,a.Wm)(V,{props:t},{default:(0,a.w5)((()=>[(0,a._)("div",d,[e.permissionRequired("kitchen","change_stockusedtracking")?((0,a.wg)(),(0,a.j4)(D,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"edit",onClick:l=>e.showEditStockUsageDialog(t.row.id),loading:e.submittedUsageData},null,8,["onClick","loading"])):(0,a.kq)("",!0),e.permissionRequired("kitchen","delete_stockusedtracking")?((0,a.wg)(),(0,a.j4)(D,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittedUsageData,onClick:l=>e.showDeleteStockUsageDialog(t.row.id)},null,8,["loading","onClick"])):(0,a.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,a.Wm)(R,{modelValue:e.createDialog,"onUpdate:modelValue":t[2]||(t[2]=t=>e.createDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{ref:"createDialogForm",onSubmit:e.submitUsageData},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Record Used Items")])),_:1}),(0,a.wy)((0,a.Wm)(D,{flat:"",round:"",size:"md",icon:"close"},null,512),[[T]])])),_:1}),(0,a.Wm)(C),(0,a._)("div",m,[(0,a.Wm)(j,{"use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingStock,options:e.stockFilterOptions,"input-debounce":"0",onFilter:e.filterStockOptions,"option-label":"name",modelValue:e.stockItem,"onUpdate:modelValue":t[1]||(t[1]=t=>e.stockItem=t),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.stockFilterOptions)},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"text-grey"},{default:(0,a.w5)((()=>[(0,a.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,a._)("div",null,[(0,a.Wm)($,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Available")])),_:1})])),_:1}),(0,a.Wm)(C,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Used")])),_:1})])),_:1})])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.stockItemDetails,(e=>((0,a.wg)(),(0,a.j4)(Q,{key:e.id},{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.quantity)+" "+(0,o.zw)(e.unit),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a._)("div",r,[(0,a._)("div",null,[(0,a._)("div",c,[(0,a._)("div",g,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.whole_number,"onUpdate:modelValue":t=>e.whole_number=t,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",p,[(0,a._)("div",w,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.numerator,"onUpdate:modelValue":t=>e.numerator=t,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(C,{class:"bg-grey-8"})]),(0,a._)("div",f,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.denomenator,"onUpdate:modelValue":t=>e.denomenator=t,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])]),(0,a._)("div",null,(0,o.zw)(e.unit),1)])])),_:2},1024)])),_:2},1024)))),128)),0==e.stockItemDetails.length?((0,a.wg)(),(0,a.j4)(Q,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"q-py-xl text-center bg-grey-4 text-grey-8 text-h5"},{default:(0,a.w5)((()=>[(0,a.Uk)("Select Item to view units")])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})]),(0,a._)("div",null,[(0,a.Wm)(D,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Create",class:"full-width",type:"submit",disabled:0==e.stockItemDetails.length},null,8,["loading","disabled"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(R,{modelValue:e.editDialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.editDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{ref:"editDialogForm",onSubmit:e.submitEditUsageData},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Edit "+(0,o.zw)(e.editUsageItem.stock_item.name),1)])),_:1}),(0,a.wy)((0,a.Wm)(D,{flat:"",round:"",size:"md",icon:"close"},null,512),[[T]])])),_:1}),(0,a.Wm)(C),(0,a._)("div",b,[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a._)("div",_,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.whole_number,"onUpdate:modelValue":t[3]||(t[3]=t=>e.editUsageItem.unit.whole_number=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,a._)("div",y,[(0,a._)("div",k,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.numerator,"onUpdate:modelValue":t[4]||(t[4]=t=>e.editUsageItem.unit.numerator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(C,{class:"bg-grey-8"})]),(0,a._)("div",h,[(0,a.Wm)(L,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.denomenator,"onUpdate:modelValue":t[5]||(t[5]=t=>e.editUsageItem.unit.denomenator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])])])])])),_:1}),(0,a.Wm)(F,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.editUsageItem.unit.units),1)])),_:1})])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(D,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Update",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}l(9665);var W=l(9302),q=l(499),D=l(4019),V=l(8221);const x=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.stock_item.name,sortable:!0,align:"left"},{name:"units",label:"Units",field:e=>`${e.quantity} ${e.unit}`,sortable:!0,align:"left"},{name:"remaining",label:"Remaining",field:e=>`${e.available} ${e.unit}`,align:"left"},{name:"date",label:"Date",align:"left",field:"date_time"},{name:"actions",label:"Actions",align:"left"}],I=(0,a.aZ)({name:"KitchenUsageIndex",setup(){const e=(0,W.Z)(),t=(0,q.iH)([]),l=(0,q.iH)(!1),o=(0,q.iH)(!1),n=(0,q.iH)(null),i=(0,q.iH)(!1),u=(0,q.iH)(null),s=(0,a.Fl)((()=>u.value?[...u.value.units_available_details]:[])),d=(0,q.iH)(!1),m=(0,q.iH)([]),r=(0,q.iH)([]),c=(0,q.iH)(!1),g=(0,q.iH)([]),p=(0,q.iH)([]),w=(0,q.iH)(!1),f=(0,q.iH)(!1),b=(0,q.iH)({stock_item:{},unit:{}});function v(){return l.value=!0,(0,D.getKitchenStockUsed)().then((e=>{t.value=e.data})).catch((e=>{})).finally((()=>{l.value=!1}))}function _(){return d.value=!0,(0,D.getKitchenStockWithUnitsDetails)("?available=True").then((e=>{m.value=e.data,r.value=e.data})).finally((()=>{d.value=!1}))}return(0,a.bv)((()=>{v().then((()=>{_()}))})),{loadingData:l,tableRows:t,tableColumns:x,denomenatorList:[null,2,4],stockItem:u,stockItemDetails:s,loadingStock:d,stockFilterOptions:r,loadingUnits:c,unitsFilterOptions:p,createDialog:o,createDialogForm:n,submittedUsageData:i,editUsageItem:b,editDialog:w,editDialogForm:f,filterStockOptions(e,t){t((()=>{r.value=m.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,t){t((()=>{p.value=g.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitUsageData(){if(n.value.validate()){i.value=!0;let t=[];s.value.forEach((e=>{let l=0;e.whole_number&&e.whole_number>0&&(l=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?l=`${e.denomenator*l+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(l=`${e.denomenator*l}/${e.denomenator}`),t.push({id:e.id,quantity:l})})),(0,D.createKitchenStockUsed)(u.value.id,{usage:t}).then((t=>{e.notify({type:"positive",message:t.data}),u.value=null,v(),o.value=!1,n.value.resetValidation()})).catch((e=>{(0,V.displayNotification)(e.response.data,"negative")})).finally((()=>{i.value=!1}))}},showEditStockUsageDialog(e){let l=t.value.find((t=>t.id==e));b.value.stock_item=l.stock_item;let a={id:e,units:l.unit},o=l.quantity.split("(");if(o.length>=1&&(a["whole_number"]=""==o[0]?null:parseInt(o[0])),2==o.length){let e=o[1].split("/");a["numerator"]=parseInt(e[0]),a["denomenator"]=parseInt(e[1].split(")")[0])}b.value.unit=a,w.value=!0},submitEditUsageData(){if(f.value.validate()){i.value=!0;let t=b.value.unit,l=0;t.whole_number&&t.whole_number>0&&(l=t.whole_number),t.denomenator&&t.denomenator>0&&t.numerator&&t.numerator>0?l=`${t.denomenator*l+t.numerator}/${t.denomenator}`:t.denomenator&&t.denomenator>0&&(null==t.numerator||0==t.numerator)&&(l=`${t.denomenator*l}/${t.denomenator}`),(0,D.editKitchenStockUsed)(b.value.stock_item.id,{usage:{id:t.id,quantity:l}}).then((t=>{e.notify({type:"positive",message:t.data}),b.value={stock_item:{},unit:{}},v(),w.value=!1,f.value.resetValidation()})).catch((t=>{e.notify({type:"negative",message:t.response.data.length<1e3?t.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}},showDeleteStockUsageDialog(t){e.dialog({title:"Confirm",message:"Confirm deleting of this transaction?",cancel:!0}).onOk((()=>{i.value=!0,(0,D.deleteKitchenStockUsed)(t).then((t=>{e.notify({type:"positive",message:t.data}),v()})).catch((t=>{e.notify({type:"negative",message:t.response.data.length<1e3?t.response.data:"Server error please contact system administrator"})})).finally((()=>{i.value=!1}))}))}}}});var S=l(1639),Z=l(9885),C=l(8879),H=l(7355),Q=l(7220),j=l(2074),F=l(4458),L=l(8326),$=l(1663),z=l(1973),O=l(926),R=l(4581),T=l(490),K=l(3115),E=l(3246),M=l(1233),N=l(6611),P=l(2146),A=l(9984),Y=l.n(A);const B=(0,S.Z)(I,[["render",U]]),G=B;Y()(I,"components",{QPage:Z.Z,QBtn:C.Z,QTable:H.Z,QTd:Q.Z,QDialog:j.Z,QCard:F.Z,QForm:L.Z,QToolbar:$.Z,QToolbarTitle:z.Z,QSeparator:O.Z,QSelect:R.Z,QItem:T.Z,QItemLabel:K.Z,QList:E.Z,QItemSection:M.Z,QInput:N.Z}),Y()(I,"directives",{ClosePopup:P.Z})}}]);