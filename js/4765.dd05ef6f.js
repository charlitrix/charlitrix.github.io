"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[4765],{4765:(e,a,l)=>{l.r(a),l.d(a,{default:()=>I});var t=l(9835),s=l(6970);const o={key:0,class:"text-h6 text-grey"},u={class:"column q-col-gutter-y-md q-mt-md q-mx-lg"},n={class:"q-px-md q-pt-xl"},r={class:"column q-col-gutter-y-md"};function i(e,a,l,i,d,m){const p=(0,t.up)("q-select"),c=(0,t.up)("q-input"),w=(0,t.up)("q-btn"),g=(0,t.up)("q-form"),b=(0,t.up)("q-page"),v=(0,t.up)("q-toolbar-title"),y=(0,t.up)("q-toolbar"),f=(0,t.up)("q-field"),h=(0,t.up)("q-card-section"),D=(0,t.up)("q-card"),U=(0,t.up)("q-dialog"),q=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(b,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{ref:"createUserForm",onSubmit:e.showCredentialsDialog},{default:(0,t.w5)((()=>[e.Id?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",o,"New User")),(0,t._)("div",u,[(0,t.Wm)(p,{"map-options":"","emit-value":"",label:"Departments","option-value":"id","option-label":"name",modelValue:e.departmentId,"onUpdate:modelValue":a[0]||(a[0]=a=>e.departmentId=a),loading:e.loadingDepartments,options:e.departmentsOptions,"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.departmentsOptions.map((e=>e.id)))},null,8,["modelValue","loading","options","rules"]),(0,t.Wm)(p,{"emit-value":"","map-options":"",label:"Account Type",options:e.accountData,"option-value":"id","option-label":"name",modelValue:e.accountType,"onUpdate:modelValue":a[1]||(a[1]=a=>e.accountType=a),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.accountData.map((e=>e.id)))},null,8,["options","modelValue","rules"]),(0,t.Wm)(c,{debounce:500,label:"User Name",modelValue:e.userData.username,"onUpdate:modelValue":a[2]||(a[2]=a=>e.userData.username=a),rules:[a=>a&&null!==a&&""!=a?e.userNameExists(a):"Enter a valid user name"]},null,8,["modelValue","rules"]),(0,t.Wm)(c,{label:"First Name",modelValue:e.userData.first_name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.userData.first_name=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t.Wm)(c,{label:"Last Name",modelValue:e.userData.last_name,"onUpdate:modelValue":a[4]||(a[4]=a=>e.userData.last_name=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t.Wm)(c,{label:"Email",modelValue:e.userData.email,"onUpdate:modelValue":a[5]||(a[5]=a=>e.userData.email=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,t._)("div",n,[(0,t.Wm)(w,{rounded:"",color:"primary",label:e.Id?"Edit":"Create",class:"full-width",loading:e.submitting,type:"submit"},null,8,["label","loading"])])])])),_:1},8,["onSubmit"])])),_:1}),(0,t.Wm)(U,{modelValue:e.newUserDialog,"onUpdate:modelValue":a[8]||(a[8]=a=>e.newUserDialog=a)},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{style:{maxWidth:"280px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{ref:"newUserForm",onSubmit:e.submitData},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Uk)("User Credentials")])),_:1}),(0,t.wy)((0,t.Wm)(w,{round:"",flat:"",icon:"close"},null,512),[[q]])])),_:1}),(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" New user should use the details to login and change their password. Click submit below to complete account creation "),(0,t._)("div",r,[(0,t.Wm)(f,{"stack-label":"",label:"User Name"},{control:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.userData.username),1)])),_:1}),(0,t.Wm)(c,{"stack-label":"",label:"Password",type:e.passwordToggle?"password":"text",loading:e.submitting,modelValue:e.userData.password,"onUpdate:modelValue":a[7]||(a[7]=a=>e.userData.password=a),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{append:(0,t.w5)((()=>[(0,t.Wm)(w,{flat:"",round:"",icon:e.passwordToggle?"visibility_off":"visibility",onClick:a[6]||(a[6]=a=>e.passwordToggle=!e.passwordToggle)},null,8,["icon"])])),after:(0,t.w5)((()=>[(0,t.Wm)(w,{flat:"",dense:"",round:"",icon:"refresh",onClick:e.createNewPassword},null,8,["onClick"])])),_:1},8,["type","loading","modelValue","rules"]),(0,t._)("div",null,[(0,t.Wm)(w,{"no-caps":"",unelevated:"",color:"grey",class:"full-width",label:"Copy Password",onClick:e.copyPassword},null,8,["onClick"])])])])),_:1}),(0,t.Wm)(h,{class:"row justify-center q-pt-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{"no-caps":"",rounded:"",color:"primary",label:"Submit",loading:e.submitting,type:"submit"},null,8,["loading"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}l(9665);var d=l(9302),m=l(5054),p=l(499),c=l(4019),w=l(8221),g=l(8339);const b=(0,t.aZ)({name:"UsersCreate",setup(){const e=(0,d.Z)(),a=(0,g.tv)(),l=(0,p.iH)(!1),s=(0,p.iH)(null),o=(0,p.iH)({}),u=(0,p.iH)(null),n=(0,p.iH)([]),r=(0,p.iH)(!1),i=(0,p.iH)([]),b=(0,p.iH)(""),v=(0,p.iH)(!1),y=(0,p.iH)(!1),f=(0,p.iH)(!1),h=((0,p.iH)(!1),(0,p.iH)(null));function D(){return r.value=!0,(0,c.getDepartments)().then((e=>{i.value=e.data})).finally((()=>{r.value=!1}))}function U(){l.value=!0,(0,c.getAccountTypes)().then((e=>{n.value=e.data})).finally((()=>{l.value=!1}))}function q(){v.value=!0,(0,c.generateNewPassword)().then((e=>{o.value.password=e.data})).finally((()=>{v.value=!1}))}function V(e){return new Promise(((a,l)=>{(0,c.getUsers)(`?username=${e}`).then((e=>{a("User name is already being used. Try another.")})).catch((e=>{e.response&&404==e.response.status?a(!0):a("user name is already being used. Try another.")}))}))}return(0,t.bv)((()=>{U(),D()})),{loadingAccountTypes:l,createUserForm:s,userData:o,accountData:n,accountType:u,submitting:v,newUserDialog:y,loadingDepartments:r,departmentsOptions:i,departmentId:b,userNameExists:V,passwordToggle:f,createNewPassword:q,newUserForm:h,copyPassword(){(0,m.Z)(o.value.password).then((()=>{e.notify({message:"Copied password to clipboard",position:"bottom"})}))},showCredentialsDialog(){s.value.validate().then((e=>{e&&(y.value=!0,q())}))},submitData(){h.value.validate()&&(v.value=!0,y.value=!1,(0,c.createUser)({...o.value,account_type_id:u.value,department_id:b.value}).then((e=>{(0,w.displayNotification)(e.data,"positive"),a.push({name:"UsersIndex"}),o.value={},u.value=null,s.value.resetValidation(),h.value.resetValidation()})).catch((e=>{(0,w.displayNotification)(e.response.data,"negative")})).finally((()=>{v.value=!1})))}}}});var v=l(1639),y=l(9885),f=l(8326),h=l(4581),D=l(6611),U=l(8879),q=l(2074),V=l(4458),W=l(1663),_=l(1973),C=l(3190),T=l(8149),k=l(2146),x=l(9984),Z=l.n(x);const H=(0,v.Z)(b,[["render",i]]),I=H;Z()(b,"components",{QPage:y.Z,QForm:f.Z,QSelect:h.Z,QInput:D.Z,QBtn:U.Z,QDialog:q.Z,QCard:V.Z,QToolbar:W.Z,QToolbarTitle:_.Z,QCardSection:C.Z,QField:T.Z}),Z()(b,"directives",{ClosePopup:k.Z})}}]);