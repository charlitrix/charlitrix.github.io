"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[8098],{8098:(e,l,a)=>{a.r(l),a.d(l,{default:()=>J});var t=a(9835),n=a(6970);const o={class:"row justify-end"},u={class:"column"},i={class:"column"},r={class:"row q-gutter-x-md no-wrap"},d={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},s={class:"row items-center justify-end"},m={class:"row q-col-gutter-x-lg"},c={class:"col-md-6"},p={class:"col-md-6"},w={class:"row justify-end"},f={class:"row no-wrap items-center q-col-gutter-x-sm"},b={class:"row items-center justify-center q-col-gutter-x-md"},_={class:"col-6"},g={class:"col-6 column q-col-gutter-y-sm"},v={class:"row justify-center"},h={class:"row justify-center"};function y(e,l,a,y,W,q){const D=(0,t.up)("q-btn"),U=(0,t.up)("q-td"),k=(0,t.up)("q-separator"),V=(0,t.up)("q-table"),P=(0,t.up)("q-page"),C=(0,t.up)("q-toolbar-title"),Z=(0,t.up)("q-toolbar"),x=(0,t.up)("q-item-label"),Q=(0,t.up)("q-item"),H=(0,t.up)("q-select"),z=(0,t.up)("q-date"),B=(0,t.up)("q-popup-proxy"),O=(0,t.up)("q-field"),I=(0,t.up)("q-input"),R=(0,t.up)("q-item-section"),j=(0,t.up)("q-list"),L=(0,t.up)("q-form"),F=(0,t.up)("q-card"),A=(0,t.up)("q-dialog"),S=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(P,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",o,[e.permissionRequired("bar","add_purchase")?((0,t.wg)(),(0,t.j4)(D,{key:0,"no-caps":"",rounded:"",color:"primary",label:"Add Purchase",onClick:l[0]||(l[0]=l=>e.createDialog=!e.createDialog)})):(0,t.kq)("",!0)]),(0,t.Wm)(V,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Purchase","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No purchase available","loading-label":"Loading items..."},{"body-cell-id":(0,t.w5)((e=>[(0,t.Wm)(U,{props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.rowIndex+1),1)])),_:2},1032,["props"])])),"body-cell-units_details":(0,t.w5)((l=>[(0,t.Wm)(U,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",u,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.row.units_details,((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"column",key:o},[(0,t._)("div",null,(0,n.zw)(a.quantity)+" "+(0,n.zw)(a.unit)+" @ "+(0,n.zw)(e.formatPrice(a.unit_price)),1),o!=l.row.units_details.length-1?((0,t.wg)(),(0,t.j4)(k,{key:0,class:"q-my-xs"})):(0,t.kq)("",!0)])))),128))])])),_:2},1032,["props"])])),"body-cell-available":(0,t.w5)((e=>[(0,t.Wm)(U,{props:e},{default:(0,t.w5)((()=>[(0,t._)("div",i,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.units_details,((l,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"column",key:a},[(0,t._)("div",null,(0,n.zw)(l.available)+" "+(0,n.zw)(l.unit),1),a!=e.row.units_details.length-1?((0,t.wg)(),(0,t.j4)(k,{key:0,class:"q-my-xs"})):(0,t.kq)("",!0)])))),128))])])),_:2},1032,["props"])])),"body-cell-actions":(0,t.w5)((l=>[(0,t.Wm)(U,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",r,[e.permissionRequired("bar","view_purchase")?((0,t.wg)(),(0,t.j4)(D,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"keyboard_arrow_right",loading:e.submittedPurchaseData,to:{name:"BarPurchaseDetails",params:{id:l.row.id}}},null,8,["loading","to"])):(0,t.kq)("",!0),e.permissionRequired("bar","delete_purchase")?((0,t.wg)(),(0,t.j4)(D,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittedPurchaseData,onClick:a=>e.showDeletePurchaseDialog(l.row.id)},null,8,["loading","onClick"])):(0,t.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,t.Wm)(A,{modelValue:e.createDialog,"onUpdate:modelValue":l[7]||(l[7]=l=>e.createDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{style:{width:"650px",maxWidth:"650px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{ref:"createDialogForm",onSubmit:e.submitPurchaseData},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Add New Purchase")])),_:1}),(0,t.wy)((0,t.Wm)(D,{flat:"",round:"",size:"md",icon:"close",onClick:e.clearPurchaseForm},null,8,["onClick"]),[[S]])])),_:1}),(0,t.Wm)(k),(0,t._)("div",d,[(0,t.Wm)(H,{"emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingBrands,options:e.filteredBrandOptions,"input-debounce":"0",onFilter:e.filterBrandOptions,"option-label":"name","option-value":"id",modelValue:e.brandId,"onUpdate:modelValue":l[1]||(l[1]=l=>e.brandId=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredBrandOptions.map((e=>e.id)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,t.Wm)(O,{outlined:"",modelValue:e.purchaseData.date,"onUpdate:modelValue":l[4]||(l[4]=l=>e.purchaseData.date=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{control:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.purchaseData.date),1)])),append:(0,t.w5)((()=>[(0,t.Wm)(D,{round:"",color:"primary",icon:"event"},{default:(0,t.w5)((()=>[(0,t.Wm)(B,{ref:"dateDialog"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{modelValue:e.purchaseData.date,"onUpdate:modelValue":[l[2]||(l[2]=l=>e.purchaseData.date=l),l[3]||(l[3]=l=>e.$refs.dateDialog.hide())],mask:"DD/MM/YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",s,[(0,t.wy)((0,t.Wm)(D,{label:"Close",color:"primary",flat:""},null,512),[[S]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,t._)("div",m,[(0,t._)("div",c,[(0,t.Wm)(I,{readonly:"",modelValue:e.purchaseData.units,"onUpdate:modelValue":l[5]||(l[5]=l=>e.purchaseData.units=l),label:"Units",type:"number"},null,8,["modelValue"])]),(0,t._)("div",p,[(0,t.Wm)(I,{readonly:"",modelValue:e.purchaseData.amount,"onUpdate:modelValue":l[6]||(l[6]=l=>e.purchaseData.amount=l),label:"Amount",type:"number"},null,8,["modelValue"])])]),(0,t._)("div",null,[(0,t._)("div",w,[(0,t.Wm)(D,{unelevated:"",label:"Add",color:"primary",onClick:e.addUnit},null,8,["onClick"])]),(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Quantity")])),_:1})])),_:1}),(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit")])),_:1})])),_:1}),(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit Price")])),_:1})])),_:1})])),_:1}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.purchaseData.units_details,((l,a)=>((0,t.wg)(),(0,t.j4)(Q,{key:a},{default:(0,t.w5)((()=>[(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t._)("div",f,[(0,t._)("div",null,[(0,t._)("div",b,[(0,t._)("div",_,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.whole_number,"onUpdate:modelValue":e=>l.whole_number=e,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",g,[(0,t._)("div",v,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.numerator,"onUpdate:modelValue":e=>l.numerator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",null,[(0,t.Wm)(k,{class:"bg-grey-8"})]),(0,t._)("div",h,[(0,t.Wm)(I,{dense:"",outlined:"",type:"number",modelValue:l.denomenator,"onUpdate:modelValue":e=>l.denomenator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])])])])),_:2},1024),(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,null,{default:(0,t.w5)((()=>[(0,t.Wm)(H,{outlined:"","map-options":"","emit-value":"","use-input":"","fill-input":"","hide-selected":"",modelValue:l.unit,"onUpdate:modelValue":e=>l.unit=e,loading:e.loadingUnits,options:e.filteredUnitOptions,"input-debounce":"0",onFilter:e.filterUnitsOptions,"option-label":"name","option-value":"name","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredUnitOptions.map((e=>e.name)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","loading","options","onFilter","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{outlined:"",modelValue:l.unit_price,"onUpdate:modelValue":e=>l.unit_price=e,modelModifiers:{number:!0},type:"number","lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(R,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{unelevated:"",round:"",color:"red",icon:"delete",size:"sm",onClick:l=>e.deleteUnit(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,t._)("div",null,[(0,t.Wm)(D,{rounded:"",loading:e.submittedPurchaseData,color:"primary",label:"Submit",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}a(9665);var W=a(9302),q=a(499),D=a(8221),U=a(4019);const k=[{name:"id",label:"#",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.brand_item.name,sortable:!0,align:"left"},{name:"amount",label:"Amount",field:e=>`${(0,D.formatPrice)(e.amount)}`,sortable:!0,align:"left"},{name:"units",label:"Units",field:"units",align:"left"},{name:"units_details",label:"Units Details",align:"left"},{name:"available",label:"Available",align:"left"},{name:"date",label:"Date",field:"date",sortable:!0,align:"left"},{name:"actions",label:"Actions",align:"left"}],V=(0,t.aZ)({name:"BarPurchase",setup(){const e=(0,W.Z)(),l=(0,q.iH)([]),a=(0,q.iH)(!1),n=(0,q.iH)(!1),o=(0,q.iH)(null),u=(0,q.iH)(!1),i=(0,q.iH)(null),r=(0,q.iH)({units_details:[]}),d=(0,q.iH)(!1),s=(0,q.iH)([]),m=(0,q.iH)([]),c=(0,q.iH)(!1),p=(0,q.iH)([]),w=(0,q.iH)([]);function f(){return a.value=!0,(0,U.getBarPurchase)().then((e=>{l.value=e.data})).catch((e=>{})).finally((()=>{a.value=!1}))}function b(){c.value=!0,(0,U.getUnits)().then((e=>{p.value=e.data,w.value=e.data})).finally((()=>{c.value=!1}))}function _(){return d.value=!0,(0,U.getBarBrands)().then((e=>{s.value=e.data,m.value=e.data})).finally((()=>{d.value=!1}))}function g(){i.value=null,r.value={units_details:[]}}return(0,t.bv)((()=>{f().then((()=>{_().then((()=>{b()}))}))})),(0,t.m0)((()=>{r.value.amount=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+l.unit_price*a}),0),r.value.units=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+a}),0)})),{loadingData:a,tableRows:l,tableColumns:k,brandId:i,purchaseData:r,denomenatorList:[null,2,4],loadingBrands:d,filteredBrandOptions:m,loadingUnits:c,filteredUnitOptions:w,createDialog:n,createDialogForm:o,submittedPurchaseData:u,clearPurchaseForm:g,deleteUnit(l){e.dialog({title:"Confirm",message:"Are you sure?",cancel:!0}).onOk((()=>{r.value.units_details.splice(l,1)}))},addUnit(){r.value.units_details.push({unit:null,unit_price:null,quantity:null})},filterBrandOptions(e,l){l((()=>{m.value=s.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,l){l((()=>{w.value=p.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitPurchaseData(){if(o.value.validate()){u.value=!0;let l=[];r.value.units_details.forEach((e=>{let a=0;e.whole_number&&e.whole_number>0&&(a=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?a=`${e.denomenator*a+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(a=`${e.denomenator*a}/${e.denomenator}`),l.push({unit:e.unit,unit_price:e.unit_price,quantity:a})})),(0,U.createBarPurchase)(i.value,{...r.value,units_details:l}).then((l=>{e.notify({type:"positive",message:l.data}),g(),f(),n.value=!1,o.value.resetValidation()})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{u.value=!1}))}},showDeletePurchaseDialog(l){e.dialog({title:"Confirm",message:"Confirm delete of the transaction.",cancel:!0}).onOk((()=>{(0,U.deleteBarPurchase)(l).then((l=>{e.notify({type:"positive",message:l.data}),f()})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{u.value=!1}))}))}}}});var P=a(1639),C=a(9885),Z=a(8879),x=a(7355),Q=a(7220),H=a(926),z=a(2074),B=a(4458),O=a(8326),I=a(1663),R=a(1973),j=a(4581),L=a(490),F=a(3115),A=a(8149),S=a(2765),Y=a(4351),T=a(6611),M=a(3246),$=a(1233),N=a(2146),K=a(9984),E=a.n(K);const G=(0,P.Z)(V,[["render",y]]),J=G;E()(V,"components",{QPage:C.Z,QBtn:Z.Z,QTable:x.Z,QTd:Q.Z,QSeparator:H.Z,QDialog:z.Z,QCard:B.Z,QForm:O.Z,QToolbar:I.Z,QToolbarTitle:R.Z,QSelect:j.Z,QItem:L.Z,QItemLabel:F.Z,QField:A.Z,QPopupProxy:S.Z,QDate:Y.Z,QInput:T.Z,QList:M.Z,QItemSection:$.Z}),E()(V,"directives",{ClosePopup:N.Z})}}]);