"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[1407],{1407:(e,a,t)=>{t.r(a),t.d(a,{default:()=>P});t(6727);var n=t(9835),l=t(6970);const o={class:"q-pa-lg"},i={class:"row justify-between q-mb-md"},c={class:"q-gutter-x-md"},s={class:"q-gutter-x-md"},r={class:"text-no-wrap"},u={key:0,class:"row justify-center no-wrap q-gutter-x-sm"};function d(e,a,t,d,m,p){const g=(0,n.up)("q-breadcrumbs-el"),f=(0,n.up)("q-breadcrumbs"),b=(0,n.up)("q-btn"),y=(0,n.up)("q-btn-toggle"),v=(0,n.up)("q-td"),w=(0,n.up)("q-table"),k=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(k,{class:"q-pa-lg"},{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{to:{name:"AccountsList"}},{default:(0,n.w5)((()=>[(0,n.Uk)("Accounts")])),_:1}),(0,n.Wm)(g,{to:{name:"Ledgers"}},{default:(0,n.w5)((()=>[(0,n.Uk)("Ledgers")])),_:1}),(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(e.accountName),1)])),_:1})])),_:1}),(0,n._)("div",o,[(0,n._)("div",i,[(0,n._)("div",c,["Income Summary"==e.accountDetails.name&&"OPEN"==e.accountDetails.state?((0,n.wg)(),(0,n.j4)(b,{key:0,color:"red",label:"Close Account",loading:e.submittingData,onClick:a[0]||(a[0]=a=>e.confirmChangeIncomeSummaryAccountState("close"))},null,8,["loading"])):(0,n.kq)("",!0),"Income Summary"==e.accountDetails.name&&"CLOSED"==e.accountDetails.state?((0,n.wg)(),(0,n.j4)(b,{key:1,color:"green",label:"Re-Open Account",loading:e.submittingData,onClick:a[1]||(a[1]=a=>e.confirmChangeIncomeSummaryAccountState("open"))},null,8,["loading"])):(0,n.kq)("",!0)]),(0,n._)("div",s,[e.permissionRequired("accounts","add_accountjournals")&&"Income Summary"!=e.accountDetails.name?((0,n.wg)(),(0,n.j4)(b,{key:0,color:"primary",label:"Add Entries",to:{name:"CreateTransaction"}})):(0,n.kq)("",!0),e.showCloseButton?((0,n.wg)(),(0,n.j4)(b,{key:1,color:"red",label:"Close Account",loading:e.submittingData,onClick:e.confirmCloseAccount},null,8,["loading","onClick"])):(0,n.kq)("",!0),e.showOpenButton?((0,n.wg)(),(0,n.j4)(b,{key:2,color:"green",label:"Re-Open Account",loading:e.submittingData,onClick:e.confirmOpenAccount},null,8,["loading","onClick"])):(0,n.kq)("",!0)])]),(0,n.Wm)(y,{modelValue:e.filterOption,"onUpdate:modelValue":[a[2]||(a[2]=a=>e.filterOption=a),e.filterOptionChanged],spread:"",unelevated:"",rounded:"","no-caps":"","text-color":"primary","toggle-color":"primary","toggle-text-color":"white",options:e.filterOptions,style:(0,l.j5)({border:"1px solid var(--q-primary)"}),class:"q-mb-md"},null,8,["modelValue","options","style","onUpdate:modelValue"]),(0,n.Wm)(w,{flat:"","wrap-cells":"",rows:e.tableRows,columns:e.tableColumns,loading:e.loadingData,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",pagination:{rowsPerPage:0}},{"body-cell-balance":(0,n.w5)((a=>[(0,n.Wm)(v,{props:a},{default:(0,n.w5)((()=>[(0,n._)("span",r,(0,l.zw)(e.calculateBalance(a.rowIndex,e.tableRows)),1)])),_:2},1032,["props"])])),"body-cell-actions":(0,n.w5)((a=>[(0,n.Wm)(v,{props:a},{default:(0,n.w5)((()=>[!a.row.transaction||a.row.is_budget_entry||Object.keys(a.row.additional_data).includes("editable")&&!a.row.additional_data.editable?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",u,[e.permissionRequired("accounts","change_accountjournals")?((0,n.wg)(),(0,n.j4)(b,{key:0,flat:"",round:"",dense:"",color:"primary",icon:"edit",to:{name:"TransactionDetails",params:{id:a.row.transaction}}},null,8,["to"])):(0,n.kq)("",!0),e.permissionRequired("accounts","delete_accountjournals")?((0,n.wg)(),(0,n.j4)(b,{key:1,flat:"",round:"",dense:"",color:"red",icon:"delete",loading:e.submittingData,onClick:t=>e.deleteEntry(a.row.transaction)},null,8,["loading","onClick"])):(0,n.kq)("",!0)]))])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading"])])])),_:1})}t(9665),t(6890);var m=t(499),p=t(9302),g=t(4019),f=t(8221),b=t(1809),y=t(1353),v=t(8339);const w=[{name:"date",label:"Date",field:e=>(0,f.parseDate)(e.date),align:"left",sortable:!0},{name:"particulars",label:"Particulars",field:"description",align:"left"}],k=[{name:"debit",label:"Debit",field:e=>"DEBIT"==e.entry_type?(0,f.formatPrice)(e.amount):"",align:"left",classes:"text-no-wrap"},{name:"credit",label:"Credit",field:e=>"CREDIT"==e.entry_type?(0,f.formatPrice)(e.amount):"",align:"left",classes:"text-no-wrap"},{name:"balance",label:"Balance",align:"left"},{name:"actions",label:"Actions",align:"left"}],h=(0,n.aZ)({name:"AccountLedgers",props:["accountId","accountName"],setup(e){const a=(0,p.Z)(),t=(0,v.tv)(),l=(0,y.F)(),o=(0,m.iH)(""),{fiscalYear:i}=(0,b.Jk)(l),c=(0,m.iH)([]),s=(0,m.iH)([...w]),r=(0,m.iH)(!1),u=(0,m.iH)({}),d=(0,m.iH)({}),h=(0,m.iH)(null),C=(0,m.iH)(!1),D=(0,n.Fl)((()=>"TEMPORARY"==o.value&&"OPEN"==d.value.state&&"Income Summary"!=d.value.name)),_=(0,n.Fl)((()=>"TEMPORARY"==o.value&&"CLOSED"==d.value.state&&"Income Summary"!=d.value.name));function A(){return(0,g.getAccountMode)(e.accountId).then((e=>{o.value=e.data}))}function q(){return(0,g.getAccount)(e.accountId).then((e=>{d.value=e.data}))}function I(){r.value=!0,c.value=[],(0,g.getAccountJournalsBy)(e.accountId,h.value?`?filter=${h.value}`:"").then((e=>{c.value=e.data,0!=d.value.opening_balance&&c.value.unshift({date:d.value.date,description:"Balance B/F",amount:d.value.opening_balance,entry_type:d.value.opening_balance>0?"DEBIT"==d.value.accounttype.increase?"DEBIT":"CREDIT":"DEBIT"!=d.value.accounttype.increase?"DEBIT":"CREDIT",comments:"",additional_data:{}})})).finally((()=>{r.value=!1}))}function O(){return(0,g.getFiscalYearFeatureSettings)(i.value.id,"?item=LEDGERS").then((e=>{if(e.data.enabled||a.dialog({title:"Attention!!!",message:"Please enable ledger settings to access this page",noEscDismiss:!0,noBackdropDismiss:!0,persistent:!0}).onOk((()=>{t.push({name:"DocumentSettings"})})),e.data.enabled&&e.data.details.fields){let a=[...e.data.details.fields];a=a.map((e=>({name:e.name,label:e.name,align:"left",classes:"text-capitalize",field:a=>E(a.additional_data,e.name)}))),s.value.push(...a,...k)}}))}function E(e,a){if(e.ledger_additional_fields){let t=e.ledger_additional_fields.find((e=>e.label==a));return t?t.value:""}return""}return(0,n.bv)((()=>{A(),q().then((()=>{["Retained Earnings","Income Summary"].includes(d.value.name)?s.value.push(...k):O(),I()}))})),{tableRows:c,tableColumns:s,loadingData:r,ledgerSettings:u,accountDetails:d,filterOption:h,submittingData:C,fiscalYear:i,accountMode:o,showCloseButton:D,showOpenButton:_,filterOptions:[{label:"Today",value:"day"},{label:"This Week",value:"week"},{label:"This Month",value:"month"},{label:"All",value:null}],deleteEntry(e){a.dialog({title:"Confirm",message:"Please confirm delete",cancel:!0,persistent:!0}).onOk((()=>{C.value=!0,(0,g.deleteTransaction)(e).then((e=>{(0,f.displayNotification)(e.data,"positive"),I()})).catch((e=>{(0,f.displayNotification)(e.response.data,"red")})).finally((()=>{C.value=!1}))}))},confirmChangeIncomeSummaryAccountState(e){a.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0}).onOk((()=>{C.value=!0,new Promise(((a,t)=>{a("open"==e?(0,g.openIncomeSummaryAccount)():(0,g.closeIncomeSummaryAccount)())})).then((e=>{(0,f.displayNotification)(e.data,"positive"),I(),q()})).catch((e=>{(0,f.displayNotification)(e.response.data,"negative")})).finally((()=>{C.value=!1}))}))},confirmCloseAccount(){a.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0}).onOk((()=>{C.value=!0,(0,g.closeAccountEntries)(e.accountId).then((e=>{(0,f.displayNotification)(e.data,"positive"),I(),q()})).catch((e=>{(0,f.displayNotification)(e.response.data,"negative")})).finally((()=>{C.value=!1}))}))},confirmOpenAccount(){a.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0}).onOk((()=>{C.value=!0,(0,g.openAccountEntries)(e.accountId).then((e=>{(0,f.displayNotification)(e.data,"positive"),I(),q()})).catch((e=>{(0,f.displayNotification)(e.response.data,"negative")})).finally((()=>{C.value=!1}))}))},calculateBalance(e,a){let t=a.slice(0,e+1).reduce(((e,a)=>e+a.amount),0);return t<0?`(${(0,f.formatPrice)(t)})`:(0,f.formatPrice)(t)},filterOptionChanged(e){I()}}}});var C=t(1639),D=t(9885),_=t(2605),A=t(8052),q=t(8879),I=t(1389),O=t(7355),E=t(7220),T=t(9984),B=t.n(T);const S=(0,C.Z)(h,[["render",d]]),P=S;B()(h,"components",{QPage:D.Z,QBreadcrumbs:_.Z,QBreadcrumbsEl:A.Z,QBtn:q.Z,QBtnToggle:I.Z,QTable:O.Z,QTd:E.Z})}}]);