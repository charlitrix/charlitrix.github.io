"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[5721],{5721:(e,l,a)=>{a.r(l),a.d(l,{default:()=>J});var t=a(9835),n=a(6970);const o={class:"row justify-end"},i={class:"column"},u={class:"column"},r={class:"row q-gutter-x-md"},d={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},s={class:"row items-center justify-end"},m={class:"row q-col-gutter-x-lg"},c={class:"col-md-6"},p={class:"col-md-6"},f={class:"row justify-end"},w={class:"row no-wrap items-center q-col-gutter-x-sm"},_={class:"row items-center justify-center q-col-gutter-x-md"},g={class:"col-6"},b={class:"col-6 column q-col-gutter-y-sm"},v={class:"row justify-center"},h={class:"row justify-center"};function y(e,l,a,y,W,D){const q=(0,t.up)("q-btn"),U=(0,t.up)("q-td"),k=(0,t.up)("q-separator"),V=(0,t.up)("q-table"),O=(0,t.up)("q-page"),P=(0,t.up)("q-toolbar-title"),C=(0,t.up)("q-toolbar"),I=(0,t.up)("q-item-label"),Z=(0,t.up)("q-item"),x=(0,t.up)("q-select"),Q=(0,t.up)("q-item-section"),H=(0,t.up)("q-date"),z=(0,t.up)("q-popup-proxy"),R=(0,t.up)("q-field"),F=(0,t.up)("q-input"),S=(0,t.up)("q-list"),j=(0,t.up)("q-form"),L=(0,t.up)("q-card"),N=(0,t.up)("q-dialog"),A=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(O,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t._)("div",o,[e.permissionRequired("store","add_incomingstock")?((0,t.wg)(),(0,t.j4)(q,{key:0,"no-caps":"",rounded:"",color:"primary",label:"Add Purchase",onClick:l[0]||(l[0]=l=>e.createDialog=!e.createDialog)})):(0,t.kq)("",!0)]),(0,t.Wm)(V,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Purchase","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No purchase available","loading-label":"Loading items..."},{"body-cell-purchase_order":(0,t.w5)((l=>[(0,t.Wm)(U,{props:l},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{unelevated:"",flat:"",color:"primary",class:"cursor-pointer",label:"PO # "+l.row.purchase_order_id,to:{name:"PurchaseOrdersDetails",params:{id:l.row.purchase_order_id}},disable:!e.permissionRequired("procurement","view_purchaseorder")},null,8,["label","to","disable"])])),_:2},1032,["props"])])),"body-cell-units_details":(0,t.w5)((l=>[(0,t.Wm)(U,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",i,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.row.units_details,((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"column",key:o},[(0,t._)("div",null,(0,n.zw)(a.quantity)+" "+(0,n.zw)(a.unit)+" @ "+(0,n.zw)(e.formatPrice(a.unit_price)),1),o!=l.row.units_details.length-1?((0,t.wg)(),(0,t.j4)(k,{key:0,class:"q-my-xs"})):(0,t.kq)("",!0)])))),128))])])),_:2},1032,["props"])])),"body-cell-available":(0,t.w5)((e=>[(0,t.Wm)(U,{props:e},{default:(0,t.w5)((()=>[(0,t._)("div",u,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.units_details,((l,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"column",key:a},[(0,t._)("div",null,(0,n.zw)(l.available)+" "+(0,n.zw)(l.unit),1),a!=e.row.units_details.length-1?((0,t.wg)(),(0,t.j4)(k,{key:0,class:"q-my-xs"})):(0,t.kq)("",!0)])))),128))])])),_:2},1032,["props"])])),"body-cell-actions":(0,t.w5)((l=>[(0,t.Wm)(U,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",r,[e.permissionRequired("store","view_incomingstock")?((0,t.wg)(),(0,t.j4)(q,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"keyboard_arrow_right",to:{name:"StoreIncomingsDetails",params:{id:l.row.id}}},null,8,["to"])):(0,t.kq)("",!0),e.permissionRequired("store","delete_incomingstock")?((0,t.wg)(),(0,t.j4)(q,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittingData,onClick:a=>e.showDeletePurchaseDialog(l.row.id)},null,8,["loading","onClick"])):(0,t.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,t.Wm)(N,{modelValue:e.createDialog,"onUpdate:modelValue":l[8]||(l[8]=l=>e.createDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{style:{width:"650px",maxWidth:"650px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{ref:"createDialogForm",onSubmit:e.submitPurchaseData},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.purchaseData.id?"Edit Purchase":"Add New Purchase"),1)])),_:1}),(0,t.wy)((0,t.Wm)(q,{flat:"",round:"",size:"md",icon:"close",onClick:e.clearPurchaseForm},null,8,["onClick"]),[[A]])])),_:1}),(0,t.Wm)(k),(0,t._)("div",d,[(0,t.Wm)(x,{"emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingBrands,options:e.filteredBrandOptions,"input-debounce":"0",onFilter:e.filterBrandOptions,"option-label":"name","option-value":"id",modelValue:e.brandId,"onUpdate:modelValue":l[1]||(l[1]=l=>e.brandId=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredBrandOptions.map((e=>e.id)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,t.Wm)(x,{"emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",label:"Purchase",loading:e.loadingPurchaseOrders,options:e.filteredPurchaseOrderOptions,onFilter:e.filterPurchaseOrderOptions,"input-debounce":"0","option-label":e=>e.id?"PO # "+e.id:"","option-value":"id",modelValue:e.purchaseData.purchase_order_id,"onUpdate:modelValue":l[2]||(l[2]=l=>e.purchaseData.purchase_order_id=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredPurchaseOrderOptions.map((e=>e.id)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),option:(0,t.w5)((e=>[(0,t.Wm)(Z,(0,n.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Uk)("PO # "+(0,n.zw)(e.opt.id),1)])),_:2},1024)])),_:2},1040)])),_:1},8,["loading","options","onFilter","option-label","modelValue","rules"]),(0,t.Wm)(R,{outlined:"",modelValue:e.purchaseData.date,"onUpdate:modelValue":l[5]||(l[5]=l=>e.purchaseData.date=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},{control:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.purchaseData.date),1)])),append:(0,t.w5)((()=>[(0,t.Wm)(q,{round:"",color:"primary",icon:"event"},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{ref:"dateDialog"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:e.purchaseData.date,"onUpdate:modelValue":[l[3]||(l[3]=l=>e.purchaseData.date=l),l[4]||(l[4]=l=>e.$refs.dateDialog.hide())],mask:"DD/MM/YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",s,[(0,t.wy)((0,t.Wm)(q,{label:"Close",color:"primary",flat:""},null,512),[[A]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,t._)("div",m,[(0,t._)("div",c,[(0,t.Wm)(F,{readonly:"",modelValue:e.purchaseData.units,"onUpdate:modelValue":l[6]||(l[6]=l=>e.purchaseData.units=l),label:"Units",type:"number"},null,8,["modelValue"])]),(0,t._)("div",p,[(0,t.Wm)(F,{readonly:"",modelValue:e.purchaseData.amount,"onUpdate:modelValue":l[7]||(l[7]=l=>e.purchaseData.amount=l),label:"Amount",type:"number"},null,8,["modelValue"])])]),(0,t._)("div",null,[(0,t._)("div",f,[(0,t.Wm)(q,{unelevated:"",label:"Add",color:"primary",onClick:e.addUnit},null,8,["onClick"])]),(0,t.Wm)(S,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Quantity")])),_:1})])),_:1}),(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit")])),_:1})])),_:1}),(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Unit Price")])),_:1})])),_:1})])),_:1}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.purchaseData.units_details,((l,a)=>((0,t.wg)(),(0,t.j4)(Z,{key:a},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t._)("div",w,[(0,t._)("div",null,[(0,t._)("div",_,[(0,t._)("div",g,[(0,t.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:l.whole_number,"onUpdate:modelValue":e=>l.whole_number=e,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",b,[(0,t._)("div",v,[(0,t.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:l.numerator,"onUpdate:modelValue":e=>l.numerator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,t._)("div",null,[(0,t.Wm)(k,{class:"bg-grey-8"})]),(0,t._)("div",h,[(0,t.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:l.denomenator,"onUpdate:modelValue":e=>l.denomenator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])])])])),_:2},1024),(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{outlined:"","map-options":"","emit-value":"","use-input":"","fill-input":"","hide-selected":"",modelValue:l.unit,"onUpdate:modelValue":e=>l.unit=e,loading:e.loadingUnits,options:e.filteredUnitOptions,"input-debounce":"0",onFilter:e.filterUnitsOptions,"option-label":"name","option-value":"name","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.filteredUnitOptions.map((e=>e.name)))},{"no-option":(0,t.w5)((()=>[(0,t.Wm)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{class:"text-grey"},{default:(0,t.w5)((()=>[(0,t.Uk)("No results")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","loading","options","onFilter","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,null,{default:(0,t.w5)((()=>[(0,t.Wm)(F,{outlined:"",modelValue:l.unit_price,"onUpdate:modelValue":e=>l.unit_price=e,modelModifiers:{number:!0},type:"number","lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)])),_:2},1024),(0,t.Wm)(Q,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{unelevated:"",round:"",color:"red",icon:"delete",size:"sm",onClick:l=>e.deleteUnit(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,t._)("div",null,[(0,t.Wm)(q,{rounded:"",loading:e.submittingData,color:"primary",label:e.purchaseData.id?"Update":"Create",class:"full-width",type:"submit"},null,8,["loading","label"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}a(9665);var W=a(9302),D=a(499),q=a(8221),U=a(4019);const k=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.item.name,sortable:!0,align:"left"},{name:"purchase_order",label:"Purchase Order",sortable:!0,align:"left"},{name:"amount",label:"Amount",field:e=>`${(0,q.formatPrice)(e.amount)}`,sortable:!0,align:"left"},{name:"units",label:"Units",field:"units",align:"left"},{name:"units_details",label:"Units Details",align:"left"},{name:"available",label:"Available",align:"left"},{name:"date",label:"Date",field:"date",sortable:!0,align:"left"},{name:"actions",label:"Actions",align:"left"}],V=(0,t.aZ)({name:"StoreIncoming",setup(){const e=(0,W.Z)(),l=(0,D.iH)([]),a=(0,D.iH)(!1),n=(0,D.iH)(!1),o=(0,D.iH)(null),i=(0,D.iH)(!1),u=(0,D.iH)(null),r=(0,D.iH)({units_details:[],purchase_order_id:""}),d=(0,D.iH)(!1),s=(0,D.iH)([]),m=(0,D.iH)([]),c=(0,D.iH)(!1),p=(0,D.iH)([]),f=(0,D.iH)([]),w=(0,D.iH)([]),_=(0,D.iH)([]),g=(0,D.iH)(!1);function b(){g.value=!0,(0,U.getPurchaseOrder)().then((e=>{w.value=e.data,_.value=e.data})).finally((()=>{g.value=!1}))}function v(){return a.value=!0,(0,U.getStoreIncoming)().then((e=>{l.value=e.data})).catch((e=>{})).finally((()=>{a.value=!1}))}function h(){return c.value=!0,(0,U.getUnits)().then((e=>{p.value=e.data,f.value=e.data})).finally((()=>{c.value=!1}))}function y(){return d.value=!0,(0,U.getStoreItems)().then((e=>{s.value=e.data,m.value=e.data})).finally((()=>{d.value=!1}))}function V(e){if(r.value.id){let l=e.id;return delete e.id,(0,U.editStoreIncoming)(l,e)}return(0,U.createStoreIncoming)(u.value,e)}function O(){u.value=null,r.value={units_details:[]}}return(0,t.bv)((()=>{v().then((()=>{y().then((()=>{h(),b()}))}))})),(0,t.m0)((()=>{r.value.amount=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+l.unit_price*a}),0),r.value.units=r.value.units_details.reduce(((e,l)=>{let a=0;return l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=(l.denomenator*a+l.numerator)/l.denomenator:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=l.denomenator*a/l.denomenator),e+a}),0)})),{loadingData:a,tableRows:l,tableColumns:k,brandId:u,purchaseData:r,denomenatorList:[null,2,4],loadingBrands:d,filteredBrandOptions:m,loadingUnits:c,filteredUnitOptions:f,createDialog:n,createDialogForm:o,submittingData:i,clearPurchaseForm:O,loadingPurchaseOrders:g,filteredPurchaseOrderOptions:_,purchaseOrderOptions:w,showEditPurchaseDialog(e){let a=l.value.find((l=>l.id==e));u.value=a.brand_item.id,r.value={id:a.id,date:a.date,units_details:a.units_details.map((e=>{let l={unit:e.unit,unit_price:e.unit_price},a=e.quantity.split("(");if(a.length>=1&&(l["whole_number"]=""==a[0]?null:parseInt(a[0])),2==a.length){let e=a[1].split("/");l["numerator"]=parseInt(e[0]),l["denomenator"]=parseInt(e[1].split(")")[0])}return l}))},n.value=!0},deleteUnit(l){e.dialog({title:"Confirm",message:"Are you sure?",cancel:!0}).onOk((()=>{r.value.units_details.splice(l,1)}))},addUnit(){r.value.units_details.push({unit:null,unit_price:null,quantity:null})},filterBrandOptions(e,l){l((()=>{m.value=s.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,l){l((()=>{f.value=p.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterPurchaseOrderOptions(e,l){l((()=>{_.value=""==e||null==e?w.value:w.value.filter((l=>String(l.id).indexOf(e)>-1))}))},submitPurchaseData(){if(o.value.validate()){i.value=!0;let e=[];r.value.units_details.forEach((l=>{let a=0;l.whole_number&&l.whole_number>0&&(a=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?a=`${l.denomenator*a+l.numerator}/${l.denomenator}`:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(a=`${l.denomenator*a}/${l.denomenator}`),e.push({unit:l.unit,unit_price:l.unit_price,quantity:a})})),V({...r.value,units_details:e}).then((e=>{(0,q.displayNotification)(e.data,"positive"),O(),v(),n.value=!1,o.value.resetValidation()})).catch((e=>{(0,q.displayNotification)(e.response.data,"negative")})).finally((()=>{i.value=!1}))}},showDeletePurchaseDialog(l){e.dialog({title:"Confirm",message:"Confirm delete of the transaction.",cancel:!0}).onOk((()=>{(0,U.deleteStoreIncoming)(l).then((e=>{(0,q.displayNotification)(e.data,"positive"),v()})).catch((e=>{(0,q.displayNotification)(e.response.data,"negative")})).finally((()=>{i.value=!1}))}))}}}});var O=a(1639),P=a(9885),C=a(8879),I=a(7355),Z=a(7220),x=a(926),Q=a(2074),H=a(4458),z=a(8326),R=a(1663),F=a(1973),S=a(4581),j=a(490),L=a(3115),N=a(1233),A=a(8149),B=a(2765),Y=a(4351),T=a(6611),M=a(3246),$=a(2146),E=a(9984),K=a.n(E);const G=(0,O.Z)(V,[["render",y]]),J=G;K()(V,"components",{QPage:P.Z,QBtn:C.Z,QTable:I.Z,QTd:Z.Z,QSeparator:x.Z,QDialog:Q.Z,QCard:H.Z,QForm:z.Z,QToolbar:R.Z,QToolbarTitle:F.Z,QSelect:S.Z,QItem:j.Z,QItemLabel:L.Z,QItemSection:N.Z,QField:A.Z,QPopupProxy:B.Z,QDate:Y.Z,QInput:T.Z,QList:M.Z}),K()(V,"directives",{ClosePopup:$.Z})}}]);