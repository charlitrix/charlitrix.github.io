"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[1978],{1978:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Ce});var t=a(9835),o=a(6970),s=a(1957);const n=(0,t._)("div",{class:"q-my-sm"},null,-1),i=(0,t._)("div",{class:"text-h5"},"Services Sales",-1),u={class:"relative-position"},d={class:"shadow-21 q-ma-sm"},m={style:{border:"1px solid grey"}},r={class:"column q-ma-sm q-gutter-y-md"},c={class:"row q-col-gutter-x-lg"},p={class:"col-6"},y={class:"col-6"},v={class:"row q-col-gutter-x-lg"},b={class:"col-6"},f={class:"col-6"},_={class:"row q-col-gutter-x-lg"},g={class:"col-6"},w={class:"col-6"},q={class:"row q-mb-sm q-col-gutter-x-lg"},h={class:"col-6"},V={class:"col-6"},D={class:"full-width"},W=(0,t._)("thead",{class:"bg-blue-7 text-white"},[(0,t._)("tr",null,[(0,t._)("th",{class:"text-left"},"Name"),(0,t._)("th",{class:"text-left"},"Rate"),(0,t._)("th",{class:"text-left"},"Qty"),(0,t._)("th")])],-1),k={class:"text-subtitle2"},x={class:"text-center full-width"},Z={class:"bg-blue-1"},Q={key:0,class:"text-h6"},S=(0,t._)("td",null,"Total",-1),C={colspan:"3"},P={class:"row justify-between q-mx-md"},U=(0,t._)("div",{class:"text-subtitle1"},"Payments",-1),H={class:"text-subtitle2"},I={class:"text-subtitle2"},T={class:"q-px-md q-my-sm"},z={class:"row bg-grey-3 q-pb-xl justify-center"},O={class:"text-h6"},j={key:0,class:"col-12 q-pa-xl flex flex-center"},K=(0,t._)("div",{class:"text-h3 text-grey-7"}," No Services available ",-1),M=[K],A={class:"column q-col-gutter-y-sm q-mt-sm q-mx-lg q-mb-xl"},Y={class:"q-mb-md"},F={class:"q-px-lg q-pt-lg"};function N(e,l,a,K,N,$){const E=(0,t.up)("q-separator"),L=(0,t.up)("q-input"),R=(0,t.up)("q-popup-edit"),B=(0,t.up)("q-btn"),G=(0,t.up)("q-field"),J=(0,t.up)("q-markup-table"),X=(0,t.up)("q-form"),ee=(0,t.up)("q-scroll-area"),le=(0,t.up)("q-card-section"),ae=(0,t.up)("q-card-actions"),te=(0,t.up)("q-card"),oe=(0,t.up)("q-tab-panel"),se=(0,t.up)("q-tab-panels"),ne=(0,t.up)("q-splitter"),ie=(0,t.up)("q-tab"),ue=(0,t.up)("q-tabs"),de=(0,t.up)("q-item"),me=(0,t.up)("q-list"),re=(0,t.up)("q-spinner-ios"),ce=(0,t.up)("q-inner-loading"),pe=(0,t.up)("q-page"),ye=(0,t.up)("q-toolbar-title"),ve=(0,t.up)("q-toolbar"),be=(0,t.up)("balance-calculator-component"),fe=(0,t.up)("q-expansion-item"),_e=(0,t.up)("money-input-component"),ge=(0,t.up)("q-select"),we=(0,t.up)("q-dialog"),qe=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(pe,{class:"q-mx-lg q-mt-lg",style:{minHeight:"400px !important"}},{default:(0,t.w5)((()=>[n,i,(0,t.Wm)(E,{class:"q-my-sm bg-dark"}),(0,t._)("div",u,[(0,t.Wm)(ne,{modelValue:e.layoutSplitter,"onUpdate:modelValue":l[13]||(l[13]=l=>e.layoutSplitter=l),style:{height:"75vh"},class:"overflow-hidden"},{before:(0,t.w5)((()=>[(0,t.Wm)(ne,{modelValue:e.innerLayoutSplitter,"onUpdate:modelValue":l[11]||(l[11]=l=>e.innerLayoutSplitter=l),style:{"{\n                height":"'100%'"},class:"overflow-hidden"},{before:(0,t.w5)((()=>[(0,t.Wm)(ee,{class:"fit"},{default:(0,t.w5)((()=>[(0,t._)("div",d,[(0,t._)("div",m,[(0,t.Wm)(X,{ref:"saleForm",onSubmit:e.submitOrder},{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t._)("div",c,[(0,t._)("div",p,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Name",modelValue:e.saleData.customer.name,"onUpdate:modelValue":l[0]||(l[0]=l=>e.saleData.customer.name=l)},null,8,["modelValue"])]),(0,t._)("div",y,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Contact",mask:"### ### ######","unmasked-value":"",modelValue:e.saleData.customer.contact,"onUpdate:modelValue":l[1]||(l[1]=l=>e.saleData.customer.contact=l)},null,8,["modelValue"])])]),(0,t._)("div",v,[(0,t._)("div",b,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Address",modelValue:e.saleData.customer.address,"onUpdate:modelValue":l[2]||(l[2]=l=>e.saleData.customer.address=l)},null,8,["modelValue"])]),(0,t._)("div",f,[(0,t.Wm)(L,{dense:"",outlined:"",label:"ID No",modelValue:e.saleData.customer.identification_number,"onUpdate:modelValue":l[3]||(l[3]=l=>e.saleData.customer.identification_number=l)},null,8,["modelValue"])])]),(0,t._)("div",_,[(0,t._)("div",g,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Nationality",modelValue:e.saleData.customer.nationality,"onUpdate:modelValue":l[4]||(l[4]=l=>e.saleData.customer.nationality=l)},null,8,["modelValue"])]),(0,t._)("div",w,[(0,t.Wm)(L,{dense:"",outlined:"",label:"District",modelValue:e.saleData.customer.district,"onUpdate:modelValue":l[5]||(l[5]=l=>e.saleData.customer.district=l)},null,8,["modelValue"])])]),(0,t._)("div",q,[(0,t._)("div",h,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Occupation",modelValue:e.saleData.customer.occupation,"onUpdate:modelValue":l[6]||(l[6]=l=>e.saleData.customer.occupation=l)},null,8,["modelValue"])]),(0,t._)("div",V,[(0,t.Wm)(L,{dense:"",outlined:"",label:"Organization",modelValue:e.saleData.customer.organisation,"onUpdate:modelValue":l[7]||(l[7]=l=>e.saleData.customer.organisation=l)},null,8,["modelValue"])])]),(0,t._)("div",null,[(0,t.Wm)(G,{ref:"saleItemsTable",outlined:e.$refs.saleItemsTable&&e.$refs.saleItemsTable.hasError,borderless:e.$refs.saleItemsTable&&!e.$refs.saleItemsTable.hasError,"no-error-icon":"",modelValue:e.saleData.items,"onUpdate:modelValue":l[8]||(l[8]=l=>e.saleData.items=l),"lazy-rules":"ondemand",rules:e.nonEmptyRequiredRules()},{control:(0,t.w5)((()=>[(0,t._)("div",D,[(0,t.Wm)(J,{flat:"",dense:"",square:"",bordered:""},{default:(0,t.w5)((()=>[W,(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.saleData.items,((l,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:l.key},[(0,t._)("td",null,(0,o.zw)(l.item.name),1),(0,t._)("td",null,[(0,t._)("div",null,(0,o.zw)(l.sale_rate.specification),1),(0,t._)("div",k,(0,o.zw)(e.formatPrice(l.sale_rate.amount)),1)]),(0,t._)("td",null,[(0,t.Wm)(G,{outlined:"",dense:""},{control:(0,t.w5)((()=>[(0,t._)("div",x,(0,o.zw)(l.quantity),1),(0,t.Wm)(R,{modelValue:l.quantity,"onUpdate:modelValue":e=>l.quantity=e,modelModifiers:{number:!0},"auto-save":""},{default:(0,t.w5)((e=>[(0,t.Wm)(L,{type:"number",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,modelModifiers:{number:!0},dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"]),min:"1"},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),prepend:(0,t.w5)((()=>[(0,t.Wm)(B,{outline:"",round:"",dense:"",size:"sm",color:"primary",icon:"remove",onClick:e=>1!=l.quantity?l.quantity=l.quantity-1:l.quantity=l.quantity},null,8,["onClick"])])),append:(0,t.w5)((()=>[(0,t.Wm)(B,{outline:"",round:"",dense:"",size:"sm",color:"primary",icon:"add",onClick:e=>l.quantity=l.quantity+1},null,8,["onClick"])])),_:2},1024)]),(0,t._)("td",null,[(0,t.Wm)(B,{round:"",size:"sm",color:"red",icon:"delete",onClick:l=>e.removeItem(a)},null,8,["onClick"])])])))),128))]),(0,t._)("tfoot",Z,[e.saleData.items.length>0?((0,t.wg)(),(0,t.iD)("tr",Q,[S,(0,t._)("td",C,(0,o.zw)(e.formatPrice(e.orderTotal)),1)])):(0,t.kq)("",!0)])])),_:1})])])),_:1},8,["outlined","borderless","modelValue","rules"])]),(0,t._)("div",P,[U,(0,t.Wm)(B,{unelevated:"","no-caps":"",rounded:"",label:"Add Payment",color:"primary","icon-right":"add",onClick:l[9]||(l[9]=l=>e.addPaymentDialog=!e.addPaymentDialog)})]),(0,t.Wm)(J,{flat:"",dense:""},{default:(0,t.w5)((()=>[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.saleData.payments,((l,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a},[(0,t._)("td",H,(0,o.zw)(l.method.name),1),(0,t._)("td",I,(0,o.zw)(e.formatPrice(l.amount)),1),(0,t._)("td",null,[(0,t.Wm)(B,{round:"",size:"sm",color:"red",icon:"delete",onClick:l=>e.removePayment(a)},null,8,["onClick"])])])))),128))])])),_:1})]),(0,t._)("div",T,[(0,t.Wm)(B,{rounded:"",color:"primary",label:"Save Order",type:"submit",loading:e.submitting,class:"full-width"},null,8,["loading"])])])),_:1},8,["onSubmit"])])])])),_:1})])),after:(0,t.w5)((()=>[(0,t.Wm)(ee,{class:"fit"},{default:(0,t.w5)((()=>[(0,t.Wm)(se,{animated:"",swipeable:"",vertical:"","transition-prev":"slide-down","transition-next":"slide-up",modelValue:e.tab,"onUpdate:modelValue":l[10]||(l[10]=l=>e.tab=l)},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.pageData,(l=>((0,t.wg)(),(0,t.j4)(oe,{key:l.id,name:l.name},{default:(0,t.w5)((()=>[(0,t._)("div",z,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.services,((l,a)=>((0,t.wg)(),(0,t.iD)("div",{key:"item-"+l.id,class:"col-10 q-ma-md"},[(0,t.Wm)(te,{flat:"",class:"fit"},{default:(0,t.w5)((()=>[(0,t.Wm)(le,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t._)("div",O,(0,o.zw)(l.name),1)])),_:2},1024),(0,t.Wm)(ae,{class:"column"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.sale_rates,(a=>((0,t.wg)(),(0,t.j4)(B,{class:"full-width",key:"sale_rate"+a.id,label:e.formatPrice(a.amount)+" - "+a.specification,size:"0.95rem",flat:"","no-caps":"",onClick:t=>e.addItem({item:{id:l.id,name:l.name},sale_rate:{...a},key:`item-${l.id}${a.id}`})},null,8,["label","onClick"])))),128)),a>0&&a!=l.sale_rates.length-1?((0,t.wg)(),(0,t.j4)(E,{key:0,class:"q-my-xs"})):(0,t.kq)("",!0)])),_:2},1024)])),_:2},1024)])))),128)),0==l.services.length?((0,t.wg)(),(0,t.iD)("div",j,M)):(0,t.kq)("",!0)])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"])])),after:(0,t.w5)((()=>[(0,t.Wm)(ee,{class:"fit inset-shadow"},{default:(0,t.w5)((()=>[(0,t.Wm)(me,{class:"q-pb-xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(de,null,{default:(0,t.w5)((()=>[(0,t.Wm)(ue,{vertical:"",modelValue:e.tab,"onUpdate:modelValue":l[12]||(l[12]=l=>e.tab=l),"active-color":"orange-10",class:"full-width"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.pageData,(e=>((0,t.wg)(),(0,t.j4)(ie,{key:e.id,name:e.name,label:e.name},null,8,["name","label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(ce,{showing:e.loadingData,class:"bg-grey-3"},{default:(0,t.w5)((()=>[(0,t.Wm)(re,{color:"primary",size:"5rem"})])),_:1},8,["showing"])])])),_:1}),(0,t.Wm)(we,{modelValue:e.addPaymentDialog,"onUpdate:modelValue":l[16]||(l[16]=l=>e.addPaymentDialog=l)},{default:(0,t.w5)((()=>[(0,t.Wm)(te,{style:{width:"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(X,{ref:"paymentForm",onSubmit:e.addPayment},{default:(0,t.w5)((()=>[(0,t.Wm)(ve,{class:"bg-primary text-white"},{default:(0,t.w5)((()=>[(0,t.Wm)(ye,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Payment")])),_:1}),(0,t.wy)((0,t.Wm)(B,{flat:"",round:"",size:"md",icon:"close"},null,512),[[qe]])])),_:1}),(0,t.Wm)(E),(0,t._)("div",A,[(0,t._)("div",Y,[(0,t.Wm)(fe,{dense:"","dense-toggle":"",label:"Balance Calculator","header-class":"text-primary",class:"rounded-borders",style:(0,o.j5)({border:"1px solid var(--q-primary)"})},{default:(0,t.w5)((()=>[(0,t.Wm)(be,{defaultAmount:e.orderTotal-e.itemsSum(e.saleData.payments)},null,8,["defaultAmount"])])),_:1},8,["style"])]),(0,t.Wm)(_e,{modelValue:e.paymentData.amount,"onUpdate:modelValue":l[14]||(l[14]=l=>e.paymentData.amount=l),"input-class":"text-h6",label:"Amount"},null,8,["modelValue"]),(0,t.Wm)(ge,{outlined:"",modelValue:e.paymentData.method,"onUpdate:modelValue":l[15]||(l[15]=l=>e.paymentData.method=l),label:"Mode of payment",options:e.paymentMethodOptions,"option-label":"name","lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.paymentMethodOptions)},null,8,["modelValue","options","rules"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(Object.keys(e.fields),((l,a)=>((0,t.wg)(),(0,t.j4)(L,{outlined:"",key:a,"model-value":e.fields[l],"onUpdate:modelValue":a=>e.fields[l]=a,label:l},null,8,["model-value","onUpdate:modelValue","label"])))),128)),(0,t._)("div",F,[(0,t.Wm)(B,{rounded:"","no-caps":"",color:"primary",label:"Add Payment",class:"full-width",type:"submit"})])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}a(9665);var $=a(9302),E=(a(4170),a(499)),L=a(2580),R=a(9258),B=a(4019),G=a(8339),J=a(8221);const X=(0,t.aZ)({name:"createOtherServicesSales",components:{MoneyInputComponent:L.Z,BalanceCalculatorComponent:R.Z},setup(){const e=(0,$.Z)(),l=(0,G.tv)(),a=(0,E.iH)(null),o=(0,E.iH)(!1),s=(0,E.iH)([]),n=(0,E.iH)(80),i=(0,E.iH)(50),u=(0,E.iH)(!1),d=(0,E.iH)({}),m=(0,E.iH)([]),r=(0,E.iH)(null),c=(0,E.iH)(null),p=(0,E.iH)({customer:{},items:[],payments:[]}),y=(0,E.iH)({}),v=(0,E.iH)(!1),b=(0,t.Fl)((()=>p.value.items.reduce(((e,l)=>e+l.quantity*l.sale_rate.amount),0)));function f(){return(0,B.getOtherServicesCategoriesWithServices)().then((e=>{s.value=e.data;let l=s.value.find((e=>e.services.length>0));a.value=l?l.name:null}))}function _(){return(0,B.getPaymentMethods)().then((e=>{m.value=e.data}))}return(0,t.m0)((()=>{d.value&&d.value.method&&d.value.method.other_details&&d.value.method.other_details.fields?y.value=d.value.method.other_details.fields.reduce(((e,l)=>({...e,[l]:null})),{}):y.value={}})),(0,t.bv)((()=>{o.value=!0,f().finally((()=>{_().finally((()=>{o.value=!1}))}))})),{loadingData:o,layoutSplitter:n,innerLayoutSplitter:i,pageData:s,tab:a,saleForm:c,saleData:p,addPaymentDialog:u,paymentData:d,paymentMethodOptions:m,paymentForm:r,fields:y,submitting:v,orderTotal:b,addPayment(){r.value.validate()&&(p.value.payments.push({...d.value,other_details:{...y.value}}),d.value={},u.value=!1,r.value.resetValidation())},addItem(e){let l=p.value.items.find((l=>l.key==e.key));null!=l?l.quantity=l.quantity+1:p.value.items.push({...e,quantity:1}),c.value.resetValidation()},removeItem(l){e.dialog({message:"Confirm?",cancel:!0}).onOk((()=>{p.value.items.splice(l,1)}))},removePayment(l){e.dialog({message:"Confirm?",cancel:!0}).onOk((()=>{p.value.payments.splice(l,1)}))},submitOrder(){e.dialog({message:"Please confirm order?",cancel:!0}).onOk((()=>{if(c.value.validate()){v.value=!0;let e=p.value.payments.map((e=>({id:e.method.id,amount:e.amount,other_details:e.other_details}))),a=p.value.items.map((e=>({sale_rate:e.sale_rate.id,quantity:e.quantity})));(0,B.createOtherServicesSales)({...p.value,items:a,payments:e}).then((e=>{(0,J.displayNotification)(e.data.message,"positive"),p.value={customer:{},items:[],payments:[]},c.value.resetValidation(),l.push({name:"OtherServicesOrderDetails",params:{Id:parseInt(e.data.sale)}})})).catch((e=>{(0,J.displayNotification)(e,"negative",{error:!0})})).finally((()=>{v.value=!1}))}}))}}}});var ee=a(1639),le=a(9885),ae=a(926),te=a(7498),oe=a(6663),se=a(8326),ne=a(6611),ie=a(8149),ue=a(6933),de=a(5863),me=a(8879),re=a(9800),ce=a(4106),pe=a(4458),ye=a(3190),ve=a(1821),be=a(3246),fe=a(490),_e=a(7817),ge=a(900),we=a(854),qe=a(8359),he=a(2074),Ve=a(1663),De=a(1973),We=a(651),ke=a(4581),xe=a(2146),Ze=a(9984),Qe=a.n(Ze);const Se=(0,ee.Z)(X,[["render",N]]),Ce=Se;Qe()(X,"components",{QPage:le.Z,QSeparator:ae.Z,QSplitter:te.Z,QScrollArea:oe.Z,QForm:se.Z,QInput:ne.Z,QField:ie.Z,QMarkupTable:ue.Z,QPopupEdit:de.Z,QBtn:me.Z,QTabPanels:re.Z,QTabPanel:ce.Z,QCard:pe.Z,QCardSection:ye.Z,QCardActions:ve.Z,QList:be.Z,QItem:fe.Z,QTabs:_e.Z,QTab:ge.Z,QInnerLoading:we.Z,QSpinnerIos:qe.Z,QDialog:he.Z,QToolbar:Ve.Z,QToolbarTitle:De.Z,QExpansionItem:We.Z,QSelect:ke.Z}),Qe()(X,"directives",{ClosePopup:xe.Z})}}]);