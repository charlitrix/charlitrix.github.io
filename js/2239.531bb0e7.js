"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[2239],{2239:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var a=l(9835),o=l(6970);const i={class:"row justify-end"},u={class:"row q-col-gutter-md"},d={class:"column justify-center"},s=(0,a._)("div",null,null,-1),m={class:"row q-gutter-x-md"},r={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},c={class:"row no-wrap items-center q-col-gutter-x-sm"},g={class:"row items-center justify-center q-col-gutter-x-md"},p={class:"col-6"},w={class:"col-6 column q-col-gutter-y-sm"},f={class:"row justify-center"},b={class:"row justify-center"},v={class:"q-pa-lg"},_={class:"row items-center justify-center q-col-gutter-x-md"},y={class:"col-6"},h={class:"col-6 column q-col-gutter-y-sm"},k={class:"row justify-center"},W={class:"row justify-center"};function q(e,t,l,n,q,D){const O=(0,a.up)("q-btn"),V=(0,a.up)("q-td"),I=(0,a.up)("q-table"),x=(0,a.up)("q-page"),U=(0,a.up)("q-toolbar-title"),S=(0,a.up)("q-toolbar"),Z=(0,a.up)("q-separator"),C=(0,a.up)("q-item-label"),H=(0,a.up)("q-item"),Q=(0,a.up)("q-select"),j=(0,a.up)("q-item-section"),F=(0,a.up)("q-input"),L=(0,a.up)("q-list"),$=(0,a.up)("q-form"),z=(0,a.up)("q-card"),R=(0,a.up)("q-dialog"),N=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(x,{class:"q-ma-xl"},{default:(0,a.w5)((()=>[(0,a._)("div",i,[e.permissionRequired("store","add_outgoingstock")?((0,a.wg)(),(0,a.j4)(O,{key:0,rounded:"","no-caps":"",color:"primary",label:"Record Used Items",onClick:t[0]||(t[0]=t=>e.createDialog=!e.createDialog)})):(0,a.kq)("",!0)]),(0,a.Wm)(I,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Stock Outgoing","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No usage available","loading-label":"Loading items..."},{"body-cell-units_available":(0,a.w5)((e=>[(0,a.Wm)(V,{props:e},{default:(0,a.w5)((()=>[(0,a._)("div",u,[(0,a._)("div",d,[(0,a._)("div",null,(0,o.zw)(e.value),1)]),s])])),_:2},1032,["props"])])),"body-cell-actions":(0,a.w5)((t=>[(0,a.Wm)(V,{props:t},{default:(0,a.w5)((()=>[(0,a._)("div",m,[e.permissionRequired("store","change_outgoingstock")?((0,a.wg)(),(0,a.j4)(O,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"edit",onClick:l=>e.showEditStockOutgoingDialog(t.rowIndex),loading:e.submittingData},null,8,["onClick","loading"])):(0,a.kq)("",!0),e.permissionRequired("store","delete_outgoingstock")?((0,a.wg)(),(0,a.j4)(O,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittingData,onClick:l=>e.showDeleteStockOutgoingDialog(t.row.id)},null,8,["loading","onClick"])):(0,a.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,a.Wm)(R,{modelValue:e.createDialog,"onUpdate:modelValue":t[2]||(t[2]=t=>e.createDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{ref:"createDialogForm",onSubmit:e.submitUsageData},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Record Used Items")])),_:1}),(0,a.wy)((0,a.Wm)(O,{flat:"",round:"",size:"md",icon:"close"},null,512),[[N]])])),_:1}),(0,a.Wm)(Z),(0,a._)("div",r,[(0,a.Wm)(Q,{"use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingStock,options:e.stockFilterOptions,"input-debounce":"0",onFilter:e.filterStockOptions,"option-label":"name",modelValue:e.stockItem,"onUpdate:modelValue":t[1]||(t[1]=t=>e.stockItem=t),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.stockFilterOptions)},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-grey"},{default:(0,a.w5)((()=>[(0,a.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,a._)("div",null,[(0,a.Wm)(L,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Available")])),_:1})])),_:1}),(0,a.Wm)(Z,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Used")])),_:1})])),_:1})])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.stockItemDetails,(e=>((0,a.wg)(),(0,a.j4)(H,{key:e.id},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.quantity)+" "+(0,o.zw)(e.unit),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a._)("div",null,[(0,a._)("div",g,[(0,a._)("div",p,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.whole_number,"onUpdate:modelValue":t=>e.whole_number=t,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",w,[(0,a._)("div",f,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.numerator,"onUpdate:modelValue":t=>e.numerator=t,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(Z,{class:"bg-grey-8"})]),(0,a._)("div",b,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.denomenator,"onUpdate:modelValue":t=>e.denomenator=t,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])]),(0,a._)("div",null,(0,o.zw)(e.unit),1)])])),_:2},1024)])),_:2},1024)))),128)),0==e.stockItemDetails.length?((0,a.wg)(),(0,a.j4)(H,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"q-py-xl text-center bg-grey-4 text-grey-8 text-h5"},{default:(0,a.w5)((()=>[(0,a.Uk)("Select Item to view units")])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})]),(0,a._)("div",null,[(0,a.Wm)(O,{rounded:"",loading:e.submittingData,color:"primary",label:"Create",class:"full-width",type:"submit",disabled:0==e.stockItemDetails.length},null,8,["loading","disabled"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(R,{modelValue:e.editDialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.editDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{ref:"editDialogForm",onSubmit:e.submitEditOutgoingData},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Edit "+(0,o.zw)(e.editOutgoingItem.item.name),1)])),_:1}),(0,a.wy)((0,a.Wm)(O,{flat:"",round:"",size:"md",icon:"close"},null,512),[[N]])])),_:1}),(0,a.Wm)(Z),(0,a._)("div",v,[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a._)("div",y,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.editOutgoingItem.unit.whole_number,"onUpdate:modelValue":t[3]||(t[3]=t=>e.editOutgoingItem.unit.whole_number=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,a._)("div",h,[(0,a._)("div",k,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.editOutgoingItem.unit.numerator,"onUpdate:modelValue":t[4]||(t[4]=t=>e.editOutgoingItem.unit.numerator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(Z,{class:"bg-grey-8"})]),(0,a._)("div",W,[(0,a.Wm)(F,{dense:"",outlined:"",type:"number",modelValue:e.editOutgoingItem.unit.denomenator,"onUpdate:modelValue":t[5]||(t[5]=t=>e.editOutgoingItem.unit.denomenator=t),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])])])])])),_:1}),(0,a.Wm)(j,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.editOutgoingItem.unit.units),1)])),_:1})])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(O,{rounded:"",loading:e.submittingData,color:"primary",label:"Update",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}l(9665);var D=l(9302),O=l(499),V=l(4019),I=l(8221);const x=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.item.name,sortable:!0,align:"left"},{name:"units",label:"Units",field:e=>`${e.quantity} ${e.unit}`,sortable:!0,align:"left"},{name:"remaining",label:"Remaining",field:e=>`${e.available} ${e.unit}`,align:"left"},{name:"date",label:"Date",align:"left",field:"date_time"},{name:"actions",label:"Actions",align:"left"}],U=(0,a.aZ)({name:"StoreOutgoingIndex",setup(){const e=(0,D.Z)(),t=(0,O.iH)([]),l=(0,O.iH)(!1),o=(0,O.iH)(!1),i=(0,O.iH)(null),u=(0,O.iH)(!1),d=(0,O.iH)(null),s=(0,a.Fl)((()=>d.value?[...d.value.units_available_details]:[])),m=(0,O.iH)(!1),r=(0,O.iH)([]),c=(0,O.iH)([]),g=(0,O.iH)(!1),p=(0,O.iH)([]),w=(0,O.iH)([]),f=(0,O.iH)(!1),b=(0,O.iH)(!1),v=(0,O.iH)({item:{},unit:{}});function _(){return l.value=!0,(0,V.getStoreOutgoing)().then((e=>{t.value=e.data})).catch((e=>{})).finally((()=>{l.value=!1}))}function y(){return m.value=!0,(0,V.getStoreItems)("?available=True").then((e=>{r.value=e.data,c.value=e.data})).finally((()=>{m.value=!1}))}return(0,a.bv)((()=>{_().then((()=>{y()}))})),{loadingData:l,tableRows:t,tableColumns:x,denomenatorList:[null,2,4],stockItem:d,stockItemDetails:s,loadingStock:m,stockFilterOptions:c,loadingUnits:g,unitsFilterOptions:w,createDialog:o,createDialogForm:i,submittingData:u,editOutgoingItem:v,editDialog:f,editDialogForm:b,filterStockOptions(e,t){t((()=>{c.value=r.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,t){t((()=>{w.value=p.value.filter((t=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitOutgoingData(){if(i.value.validate()){u.value=!0;let e=[];s.value.forEach((t=>{let l=0;t.whole_number&&t.whole_number>0&&(l=t.whole_number),t.denomenator&&t.denomenator>0&&t.numerator&&t.numerator>0?l=`${t.denomenator*l+t.numerator}/${t.denomenator}`:t.denomenator&&t.denomenator>0&&(null==t.numerator||0==t.numerator)&&(l=`${t.denomenator*l}/${t.denomenator}`),e.push({id:t.id,quantity:l})})),(0,V.createStoreOutgoing)(d.value.id,{usage:e}).then((e=>{(0,I.displayNotification)(e.data,"positive"),d.value=null,_(),o.value=!1,i.value.resetValidation()})).catch((e=>{(0,I.displayNotification)(e.response.data,"negative")})).finally((()=>{u.value=!1}))}},showEditStockOutgoingDialog(e){let l={...t.value[e]};v.value.item=l.item;let a={id:l.id,units:l.unit},o=l.quantity.split("(");if(o.length>=1&&(a["whole_number"]=""==o[0]?null:parseInt(o[0])),2==o.length){let e=o[1].split("/");a["numerator"]=parseInt(e[0]),a["denomenator"]=parseInt(e[1].split(")")[0])}v.value.unit=a,f.value=!0},submitEditOutgoingData(){if(b.value.validate()){u.value=!0;let e=v.value.unit,t=0;e.whole_number&&e.whole_number>0&&(t=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?t=`${e.denomenator*t+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(t=`${e.denomenator*t}/${e.denomenator}`),(0,V.editStoreOutgoing)(v.value.item.id,{usage:{id:e.id,quantity:t}}).then((e=>{(0,I.displayNotification)(e.data,"positive"),v.value={item:{},unit:{}},_(),f.value=!1,b.value.resetValidation()})).catch((e=>{(0,I.displayNotification)(e.response.data,"negative")})).finally((()=>{u.value=!1}))}},showDeleteStockOutgoingDialog(t){e.dialog({title:"Confirm",message:"Confirm deleting of this transaction?",cancel:!0}).onOk((()=>{u.value=!0,(0,V.deleteStoreOutgoing)(t).then((e=>{(0,I.displayNotification)(e.data),_()})).catch((e=>{(0,I.displayNotification)(e.response.data,"negative")})).finally((()=>{u.value=!1}))})),n}}}});var S=l(1639),Z=l(9885),C=l(8879),H=l(7355),Q=l(7220),j=l(2074),F=l(4458),L=l(8326),$=l(1663),z=l(1973),R=l(926),N=l(4581),T=l(490),E=l(3115),M=l(3246),P=l(1233),A=l(6611),Y=l(2146),B=l(9984),K=l.n(B);const G=(0,S.Z)(U,[["render",q]]),J=G;K()(U,"components",{QPage:Z.Z,QBtn:C.Z,QTable:H.Z,QTd:Q.Z,QDialog:j.Z,QCard:F.Z,QForm:L.Z,QToolbar:$.Z,QToolbarTitle:z.Z,QSeparator:R.Z,QSelect:N.Z,QItem:T.Z,QItemLabel:E.Z,QList:M.Z,QItemSection:P.Z,QInput:A.Z}),K()(U,"directives",{ClosePopup:Y.Z})}}]);