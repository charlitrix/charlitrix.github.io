"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[8672],{8672:(e,l,t)=>{t.r(l),t.d(l,{default:()=>ce});var i=t(9835),a=t(6970),u=t(1957);const s={class:"q-pa-lg"},n=(0,i._)("th",null,null,-1),d={colspan:"2"},o={class:"column"},r={class:"text-weight-regular"},p={class:"text-weight-regular"},m={colspan:"2"},c={class:"column"},_={key:0,class:"text-weight-regular"},q=(0,i._)("thead",null,[(0,i._)("tr",null,[(0,i._)("th"),(0,i._)("th",{class:"text-left"},"#"),(0,i._)("th",{class:"text-left"},"Name"),(0,i._)("th",{class:"text-left"},"Quantity"),(0,i._)("th",{class:"text-left"},"Rate"),(0,i._)("th",{class:"text-left"},"Total (Ugx)")])],-1),w={style:{width:"50px !important"}},v={class:"text-weight-bold"},f=(0,i._)("td",{colspan:"4",class:"text-right"},"Total",-1),g={class:"row justify-end q-gutter-x-lg"},h={class:"q-ma-lg q-column q-col-gutter-y-lg q-mb-xl"},y=(0,i._)("div",{class:"row justify-center text-h4"},"Purchase Order Form",-1),b={class:"row"},D={class:"col-md-4"},W=(0,i._)("div",{class:"text-h5 q-mb-md"},"Supplier",-1),x=(0,i._)("thead",null,[(0,i._)("tr",null,[(0,i._)("th",null,"#"),(0,i._)("th",null,"Name"),(0,i._)("th",null,"Specifications"),(0,i._)("th",null,"Quantity"),(0,i._)("th",null,"Units"),(0,i._)("th",null,"Payment Terms"),(0,i._)("th",null,"Rate"),(0,i._)("th",null,"Total (Ugx)")])],-1),S={style:{paddingLeft:"0px !important",paddingRight:"0px !important"}},k={class:"row q-mx-sm"},V={class:"row items-center"},R={class:"text-weight-bold"},I=(0,i._)("td",{colspan:"7",class:"text-right"},"Total",-1),z={class:"q-py-xl"},U={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg q-mt-sm"},C={class:"row q-gutter-x-lg"},H={class:"q-mx-lg q-mb-lg q-mt-sm"},Q={class:"row q-my-lg q-gutter-x-lg items-center"},Z={class:"q-column q-col-gutter-y-md q-mx-lg q-mb-lg"},P=(0,i._)("div",{class:"text-h5"},"Add Supplier",-1);function F(e,l,t,F,T,A){const N=(0,i.up)("q-separator"),L=(0,i.up)("q-checkbox"),O=(0,i.up)("q-markup-table"),j=(0,i.up)("q-btn"),B=(0,i.up)("q-stepper-navigation"),E=(0,i.up)("q-step"),Y=(0,i.up)("q-item-section"),K=(0,i.up)("q-item"),M=(0,i.up)("q-list"),G=(0,i.up)("q-select"),J=(0,i.up)("q-form"),X=(0,i.up)("q-stepper"),$=(0,i.up)("q-page"),ee=(0,i.up)("q-toolbar-title"),le=(0,i.up)("q-toolbar"),te=(0,i.up)("q-input"),ie=(0,i.up)("q-card"),ae=(0,i.up)("q-dialog"),ue=(0,i.up)("q-slide-transition"),se=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)($,{class:"q-pa-xl"},{default:(0,i.w5)((()=>[(0,i.Wm)(X,{modelValue:e.step,"onUpdate:modelValue":l[4]||(l[4]=l=>e.step=l),animated:"",vertical:"",color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(E,{name:1,title:"Requisition Items",icon:"edit",done:e.step>1},{default:(0,i.w5)((()=>[(0,i._)("div",s,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.approvedRequisitions,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"q-mb-lg",key:t.id},[(0,i.Wm)(O,{dense:"",bordered:"",flat:"",square:"",separator:"cell"},{default:(0,i.w5)((()=>[(0,i._)("thead",null,[(0,i._)("tr",null,[n,(0,i._)("th",null,"Requisition # "+(0,a.zw)(t.id),1),(0,i._)("th",d,[(0,i._)("div",o,[(0,i._)("div",null,[(0,i.Uk)(" Requested By: "),(0,i._)("span",r,(0,a.zw)(t.requester),1)]),(0,i.Wm)(N),(0,i._)("div",null,[(0,i.Uk)(" Approved By: "),(0,i._)("span",p,(0,a.zw)(t.approver),1)])])]),(0,i._)("th",m,[(0,i._)("div",c,[(0,i._)("div",null,[(0,i.Uk)(" Supplier: "),t.supplier.id?((0,i.wg)(),(0,i.iD)("span",_," # "+(0,a.zw)(t.supplier.id)+" "+(0,a.zw)(t.supplier.name),1)):(0,i.kq)("",!0)])])])])]),q,(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.items,(u=>((0,i.wg)(),(0,i.iD)("tr",{key:u.id},[(0,i._)("td",w,[(0,i.Wm)(L,{dense:"",modelValue:e.selectedRequisitions,"onUpdate:modelValue":l[0]||(l[0]=l=>e.selectedRequisitions=l),val:t.id+"-"+u.id},null,8,["modelValue","val"])]),(0,i._)("td",null,(0,a.zw)(u.code),1),(0,i._)("td",null,(0,a.zw)(u.name),1),(0,i._)("td",null,(0,a.zw)(u.quantity),1),(0,i._)("td",null,(0,a.zw)(e.formatPrice(u.unit_price)),1),(0,i._)("td",null,(0,a.zw)(e.formatPrice(u.quantity*u.unit_price)),1)])))),128))]),(0,i._)("tfoot",null,[(0,i._)("tr",v,[f,(0,i._)("td",null,(0,a.zw)(e.formatPrice(e.itemsProductSum(t.items,"quantity","unit_price"))),1)])])])),_:2},1024)])))),128))]),(0,i.Wm)(B,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,{onClick:l[1]||(l[1]=l=>e.step=2),color:"primary",label:"continue",class:"q-px-xl",disable:0==e.selectedRequisitionsDetails.length},null,8,["disable"])])),_:1})])),_:1},8,["done"]),(0,i.Wm)(E,{name:2,title:"Purchase Order",icon:"assignment"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(j,{"no-caps":"",rounded:"",label:"Add Supplier",color:"primary",onClick:l[2]||(l[2]=l=>e.addSupplierDialog=!e.addSupplierDialog)})]),(0,i.Wm)(J,{ref:"requisitionForm",onSubmit:e.submitNewRequisition},{default:(0,i.w5)((()=>[(0,i._)("div",h,[y,(0,i._)("div",null,[(0,i._)("div",b,[(0,i._)("div",D,[W,(0,i.Wm)(M,{dense:""},{default:(0,i.w5)((()=>[(0,i.Wm)(K,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Code:")])),_:1}),e.requisitionSupplierData.id?((0,i.wg)(),(0,i.j4)(Y,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.requisitionSupplierData.id),1)])),_:1})):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(K,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Name:")])),_:1}),(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.requisitionSupplierData.name),1)])),_:1})])),_:1}),(0,i.Wm)(K,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Contact:")])),_:1}),(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.requisitionSupplierData.contact),1)])),_:1})])),_:1}),(0,i.Wm)(K,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Address:")])),_:1}),(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.requisitionSupplierData.address),1)])),_:1})])),_:1})])),_:1})])])]),(0,i._)("div",null,[(0,i.Wm)(O,{bordered:"",flat:"",square:"",separator:"cell"},{default:(0,i.w5)((()=>[x,(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.selectedRequisitionsDetails,((l,t)=>((0,i.wg)(),(0,i.iD)("tr",{key:t},[(0,i._)("td",S,[(0,i._)("div",k,[(0,i.Wm)(j,{flat:"",round:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:l=>e.showEditRequisitionItemDialog(t)},null,8,["onClick"]),(0,i.Wm)(j,{flat:"",round:"",dense:"",size:"sm",icon:"delete",color:"red",onClick:l=>e.showDeleteRequistionItemDialog(t)},null,8,["onClick"]),(0,i._)("div",null,(0,a.zw)(l.code),1)])]),(0,i._)("td",null,(0,a.zw)(l.name),1),(0,i._)("td",null,(0,a.zw)(l.specifications),1),(0,i._)("td",null,(0,a.zw)(l.quantity),1),(0,i._)("td",null,(0,a.zw)(l.unit),1),(0,i._)("td",null,[(0,i._)("div",V,[(0,i.Wm)(G,{dense:"",outlined:"",options:e.paymentTermsDataList,style:{minWidth:"80px"},modelValue:l.payment_terms,"onUpdate:modelValue":e=>l.payment_terms=e,"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.paymentTermsDataList),class:"q-pb-none"},null,8,["options","modelValue","onUpdate:modelValue","rules"])])]),(0,i._)("td",null,(0,a.zw)(e.formatPrice(l.unit_price)),1),(0,i._)("td",null,(0,a.zw)(e.formatPrice(l.unit_price*l.quantity)),1)])))),128))]),(0,i._)("tfoot",null,[(0,i._)("tr",R,[I,(0,i._)("td",null,(0,a.zw)(e.formatPrice(e.itemsProductSum(e.selectedRequisitionsDetails,"unit_price","quantity"))),1)])])])),_:1}),(0,i._)("div",z,[e.permissionRequired("procurement","add_purchaseorder")?((0,i.wg)(),(0,i.j4)(j,{key:0,"no-caps":"",rounded:"",class:"full-width",color:"primary",label:"Create Purchase Order",type:"submit",loading:e.submittingData},null,8,["loading"])):(0,i.kq)("",!0)])])])])),_:1},8,["onSubmit"]),(0,i.Wm)(B,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,{onClick:l[3]||(l[3]=l=>e.step=1),color:"primary",label:"Back",class:"q-px-xl q-ml-md"})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(ae,{modelValue:e.newItemDialog,"onUpdate:modelValue":l[9]||(l[9]=l=>e.newItemDialog=l)},{default:(0,i.w5)((()=>[(0,i.Wm)(ie,{style:{width:"650px",maxWidth:"650px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{ref:"newItemForm",onSubmit:e.editRequisitionItem},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{class:"bg-primary text-white"},{default:(0,i.w5)((()=>[(0,i.Wm)(ee,{textContent:(0,a.zw)(e.requisitionItemData.id?"Update Item":"New Item")},null,8,["textContent"]),(0,i.wy)((0,i.Wm)(j,{flat:"",round:"",size:"md",icon:"close"},null,512),[[se]])])),_:1}),(0,i._)("div",U,[(0,i.Wm)(te,{label:"Specifications",modelValue:e.requisitionItemData.specifications,"onUpdate:modelValue":l[5]||(l[5]=l=>e.requisitionItemData.specifications=l),type:"textarea",rows:"3","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"]),(0,i._)("div",C,[(0,i.Wm)(te,{label:"Quantity",type:"number",modelValue:e.requisitionItemData.quantity,"onUpdate:modelValue":l[6]||(l[6]=l=>e.requisitionItemData.quantity=l),"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,i.Wm)(te,{label:"Price",type:"number",modelValue:e.requisitionItemData.unit_price,"onUpdate:modelValue":l[7]||(l[7]=l=>e.requisitionItemData.unit_price=l),"lazy-rules":"ondemand",rules:e.numberInputRequiredRules()},null,8,["modelValue","rules"]),(0,i.Wm)(te,{label:"Unit",modelValue:e.requisitionItemData.unit,"onUpdate:modelValue":l[8]||(l[8]=l=>e.requisitionItemData.unit=l),"lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"])]),(0,i._)("div",null,[(0,i.Wm)(j,{rounded:"","no-caps":"",type:"submit",class:"full-width",label:e.requisitionItemData.id?"Update":"Add",color:"primary"},null,8,["label"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(ae,{modelValue:e.addSupplierDialog,"onUpdate:modelValue":l[15]||(l[15]=l=>e.addSupplierDialog=l)},{default:(0,i.w5)((()=>[(0,i.Wm)(ie,{style:{width:"650px",maxWidth:"650px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{class:"bg-primary text-white"},{default:(0,i.w5)((()=>[(0,i.Wm)(ee,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Suppliers")])),_:1}),(0,i.wy)((0,i.Wm)(j,{flat:"",round:"",size:"md",icon:"close"},null,512),[[se]])])),_:1}),(0,i._)("div",H,[(0,i._)("div",Q,[(0,i._)("div",null,[(0,i.Wm)(G,{clearable:"",label:"Suppliers","option-label":"name",options:e.suppliersDataList,style:{minWidth:"250px"},modelValue:e.selectedSupplier,"onUpdate:modelValue":l[10]||(l[10]=l=>e.selectedSupplier=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.suppliersDataList),loading:e.loadingSuppliersData,ref:"supplierSelected"},{option:(0,i.w5)((e=>[(0,i.Wm)(K,(0,a.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(Y,{side:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.opt.id),1)])),_:2},1024),(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.opt.name),1)])),_:2},1024)])),_:2},1040)])),_:1},8,["options","modelValue","rules","loading"])]),(0,i._)("div",null,[e.permissionRequired("procurement","add_supplier")?((0,i.wg)(),(0,i.j4)(j,{key:0,round:"",color:e.showSupplierForm?"red":"primary",icon:"add",class:(0,a.C_)([e.showSupplierForm?"rotate-45":""]),onClick:l[11]||(l[11]=l=>e.showSupplierForm=!e.showSupplierForm)},null,8,["color","class"])):(0,i.kq)("",!0)])]),(0,i.Wm)(ue,null,{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("div",null,[(0,i._)("div",Z,[P,(0,i.Wm)(te,{modelValue:e.supplierData.name,"onUpdate:modelValue":l[12]||(l[12]=l=>e.supplierData.name=l),label:"Name","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierName"},null,8,["modelValue","rules"]),(0,i.Wm)(te,{modelValue:e.supplierData.contact,"onUpdate:modelValue":l[13]||(l[13]=l=>e.supplierData.contact=l),label:"Contact","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierContact",mask:"phone","unmasked-value":""},null,8,["modelValue","rules"]),(0,i.Wm)(te,{modelValue:e.supplierData.address,"onUpdate:modelValue":l[14]||(l[14]=l=>e.supplierData.address=l),label:"Address","lazy-rules":!0,rules:e.textInputRequiredRules(),ref:"supplierAddress"},null,8,["modelValue","rules"])])],512),[[u.F8,e.showSupplierForm]])])),_:1}),(0,i._)("div",null,[(0,i.Wm)(j,{rounded:"","no-caps":"",type:"submit",class:"full-width",label:"Add",color:"primary",onClick:e.setSupplier},null,8,["onClick"])])])])),_:1})])),_:1},8,["modelValue"])],64)}t(9665);var T=t(4019),A=t(9302),N=t(499);const L=(0,i.aZ)({name:"CreatePurchaseOrder",setup(){const e=(0,A.Z)(),l=(0,N.iH)(1),t=(0,N.iH)([]),a=(0,N.iH)(!1),u=(0,N.iH)([]),s=(0,N.iH)([]),n=(0,N.iH)([]),d=(0,N.iH)(null),o=(0,N.iH)({}),r=(0,N.iH)([]),p=(0,N.iH)(!1),m=(0,N.iH)({name:"",contact:"",address:""}),c=(0,N.iH)(null),_=(0,N.iH)(null),q=(0,N.iH)(!1),w=(0,N.iH)(!1),v=(0,N.iH)([]),f=(0,N.iH)(null),g=(0,N.iH)(null),h=(0,N.iH)(null),y=(0,N.iH)(null),b=(0,N.iH)(null),D=(0,N.iH)(!1),W=(0,N.iH)({}),x=(0,N.iH)(!1);function S(){s.value=[],u.value.length>0&&u.value.forEach((e=>{let l=e.split("-"),i=t.value.find((e=>e.id==parseInt(l[0]))),a={...i.items.find((e=>e.id==parseInt(l[1])))},u=a.id;delete a.id,s.value.push({...a,requisition_id:i.id,payment_terms:"",item_id:u}),n.value.push({...a,requisition_id:i.id,payment_terms:"",item_id:u})}))}function k(){w.value=!0,(0,T.getSuppliers)().then((e=>{v.value=e.data})).finally((()=>{w.value=!1}))}function V(){return a.value=!0,(0,T.getRequisition)("?status=APPROVED").then((e=>{t.value=e.data,t.value=t.value.map((e=>({...e,items:e.requisition_items.map((e=>({...e,selected:!1})))})))})).finally((()=>{a.value=!1}))}return(0,i.m0)((()=>{S()})),(0,i.bv)((()=>{V().then((()=>{k()}))})),{step:l,approvedRequisitions:t,selectedRequisitions:u,selectedRequisitionsDetails:s,newItemForm:d,requisitionSupplierData:o,itemsList:r,showSupplierForm:p,supplierData:m,selectedSupplier:c,addSupplierDialog:q,addSupplierForm:_,loadingSuppliersData:w,suppliersDataList:v,supplierName:f,supplierContact:g,supplierAddress:h,supplierSelected:y,requisitionForm:b,submittingData:D,requisitionItemData:W,newItemDialog:x,paymentTermsDataList:["Cash","Credit"],showEditRequisitionItemDialog(e){W.value={...s.value[e]},x.value=!0},showDeleteRequistionItemDialog(l){e.dialog({title:"Confirm",message:"Please confirm?",cancel:!0}).onOk((()=>{}))},setSupplier(){p.value&&f.value.validate()&&g.value.validate()&&h.value.validate()?(o.value={...m.value},m.value={name:"",contact:"",address:""},f.value.resetValidation(),g.value.resetValidation(),h.value.resetValidation(),q.value=!1):y.value.validate()&&(o.value={...c.value},y.value.resetValidation(),q.value=!1)},editRequisitionItem(){if(d.value.validate()){let e=s.value.findIndex((e=>e.item_id==W.value.item_id&&e.requisition_id==W.value.requisition_id));s.value[e]={...W.value},x.value=!1,W.value={},d.value.resetValidation()}},submitNewRequisition(){b.value.validate()&&e.dialog({title:"Confirm",message:"Please confirm new requisition",cancel:!0}).onOk((()=>{D.value=!0;let l={...o.value};(0,T.createPurchaseOrder)({supplier:l,items:s.value}).then((l=>{o.value={},u.value=[],s.value=[],e.notify({type:"positive",message:l.data})})).catch((l=>{e.notify({type:"negative",message:l.response.data.length<1e3?l.response.data:"Server error please contact system administrator"})})).finally((()=>{D.value=!1}))}))}}}});var O=t(1639),j=t(9885),B=t(8225),E=t(6017),Y=t(6933),K=t(1221),M=t(926),G=t(1992),J=t(8879),X=t(8326),$=t(3246),ee=t(490),le=t(1233),te=t(4581),ie=t(2074),ae=t(4458),ue=t(1663),se=t(1973),ne=t(6611),de=t(9003),oe=t(2146),re=t(9984),pe=t.n(re);const me=(0,O.Z)(L,[["render",F]]),ce=me;pe()(L,"components",{QPage:j.Z,QStepper:B.Z,QStep:E.Z,QMarkupTable:Y.Z,QCheckbox:K.Z,QSeparator:M.Z,QStepperNavigation:G.Z,QBtn:J.Z,QForm:X.Z,QList:$.Z,QItem:ee.Z,QItemSection:le.Z,QSelect:te.Z,QDialog:ie.Z,QCard:ae.Z,QToolbar:ue.Z,QToolbarTitle:se.Z,QInput:ne.Z,QSlideTransition:de.Z}),pe()(L,"directives",{ClosePopup:oe.Z})}}]);