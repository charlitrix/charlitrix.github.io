"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[8379],{8379:(e,l,t)=>{t.r(l),t.d(l,{default:()=>G});var a=t(9835),o=t(6970);const i={class:"row justify-end"},n={class:"row q-col-gutter-md"},d={class:"column justify-center"},u=(0,a._)("div",null,null,-1),s={class:"row q-gutter-x-md"},m={class:"column q-col-gutter-y-lg q-mx-lg q-mb-lg"},r={class:"row no-wrap items-center q-col-gutter-x-sm"},c={class:"row items-center justify-center q-col-gutter-x-md"},p={class:"col-6"},g={class:"col-6 column q-col-gutter-y-sm"},w={class:"row justify-center"},f={class:"row justify-center"},b={class:"q-pa-lg"},_={class:"row items-center justify-center q-col-gutter-x-md"},v={class:"col-6"},y={class:"col-6 column q-col-gutter-y-sm"},k={class:"row justify-center"},W={class:"row justify-center"};function h(e,l,t,h,D,q){const U=(0,a.up)("q-btn"),V=(0,a.up)("q-td"),S=(0,a.up)("q-table"),x=(0,a.up)("q-page"),I=(0,a.up)("q-toolbar-title"),Z=(0,a.up)("q-toolbar"),C=(0,a.up)("q-separator"),Q=(0,a.up)("q-item-label"),H=(0,a.up)("q-item"),R=(0,a.up)("q-select"),j=(0,a.up)("q-item-section"),z=(0,a.up)("q-input"),F=(0,a.up)("q-list"),L=(0,a.up)("q-form"),O=(0,a.up)("q-card"),$=(0,a.up)("q-dialog"),N=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(x,{class:"q-ma-xl"},{default:(0,a.w5)((()=>[(0,a._)("div",i,[e.permissionRequired("store","add_deadstock")?((0,a.wg)(),(0,a.j4)(U,{key:0,rounded:"","no-caps":"",color:"primary",label:"Record Dead Stock",onClick:l[0]||(l[0]=l=>e.createDialog=!e.createDialog)})):(0,a.kq)("",!0)]),(0,a.Wm)(S,{flat:"",loading:e.loadingData,columns:e.tableColumns,rows:e.tableRows,pagination:{rowsPerPage:0},title:"Dead Stock","row-key":"id","table-header-class":"bg-primary text-white","no-data-label":"No stock available","loading-label":"Loading items..."},{"body-cell-units_available":(0,a.w5)((e=>[(0,a.Wm)(V,{props:e},{default:(0,a.w5)((()=>[(0,a._)("div",n,[(0,a._)("div",d,[(0,a._)("div",null,(0,o.zw)(e.value),1)]),u])])),_:2},1032,["props"])])),"body-cell-actions":(0,a.w5)((l=>[(0,a.Wm)(V,{props:l},{default:(0,a.w5)((()=>[(0,a._)("div",s,[e.permissionRequired("store","change_deadstock")?((0,a.wg)(),(0,a.j4)(U,{key:0,round:"",unelevated:"",size:"sm",color:"primary",icon:"edit",onClick:t=>e.showEditDeadStockDialog(l.row.id),loading:e.submittedUsageData},null,8,["onClick","loading"])):(0,a.kq)("",!0),e.permissionRequired("store","delete_deadstock")?((0,a.wg)(),(0,a.j4)(U,{key:1,round:"",unelevated:"",size:"sm",color:"red",icon:"delete",loading:e.submittedUsageData,onClick:t=>e.showDeleteStockDeadDialog(l.row.id)},null,8,["loading","onClick"])):(0,a.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["loading","columns","rows"])])),_:1}),(0,a.Wm)($,{modelValue:e.createDialog,"onUpdate:modelValue":l[2]||(l[2]=l=>e.createDialog=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"70vw",maxWidth:"70vw"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{ref:"createDialogForm",onSubmit:e.submitDeadStockData},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Record Dead Stock")])),_:1}),(0,a.wy)((0,a.Wm)(U,{flat:"",round:"",size:"md",icon:"close"},null,512),[[N]])])),_:1}),(0,a.Wm)(C),(0,a._)("div",m,[(0,a.Wm)(R,{"use-input":"","fill-input":"","hide-selected":"",label:"Item",loading:e.loadingStock,options:e.stockFilterOptions,"input-debounce":"0",onFilter:e.filterStockOptions,"option-label":"name",modelValue:e.stockItem,"onUpdate:modelValue":l[1]||(l[1]=l=>e.stockItem=l),"lazy-rules":"ondemand",rules:e.selectInputRequiredRules(e.stockFilterOptions)},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"text-grey"},{default:(0,a.w5)((()=>[(0,a.Uk)("No results")])),_:1})])),_:1})])),_:1},8,["loading","options","onFilter","modelValue","rules"]),(0,a._)("div",null,[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Available")])),_:1})])),_:1}),(0,a.Wm)(C,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Dead")])),_:1})])),_:1}),(0,a.Wm)(C,{vertical:"",class:"q-mx-md bg-grey"}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"text-weight-bold text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)("Reason")])),_:1})])),_:1})])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.stockItemDetails,(l=>((0,a.wg)(),(0,a.j4)(H,{key:l.id},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"text-center"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(l.quantity)+" "+(0,o.zw)(l.unit),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",r,[(0,a._)("div",null,[(0,a._)("div",c,[(0,a._)("div",p,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:l.whole_number,"onUpdate:modelValue":e=>l.whole_number=e,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",g,[(0,a._)("div",w,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:l.numerator,"onUpdate:modelValue":e=>l.numerator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(C,{class:"bg-grey-8"})]),(0,a._)("div",f,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:l.denomenator,"onUpdate:modelValue":e=>l.denomenator=e,modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue","onUpdate:modelValue"])])])])]),(0,a._)("div",null,(0,o.zw)(l.unit),1)])])),_:2},1024),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{outlined:"",modelValue:l.description,"onUpdate:modelValue":e=>l.description=e,type:"textarea","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0==e.stockItemDetails.length?((0,a.wg)(),(0,a.j4)(H,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"q-py-xl text-center bg-grey-4 text-grey-8 text-h5"},{default:(0,a.w5)((()=>[(0,a.Uk)("Select Item to view units")])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})]),(0,a._)("div",null,[(0,a.Wm)(U,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Create",class:"full-width",type:"submit",disabled:0==e.stockItemDetails.length},null,8,["loading","disabled"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)($,{modelValue:e.editDialog,"onUpdate:modelValue":l[7]||(l[7]=l=>e.editDialog=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,{style:{width:"600px",maxWidth:"600px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{ref:"editDialogForm",onSubmit:e.submitEditDeadStockData},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Edit "+(0,o.zw)(e.editUsageItem.item.name),1)])),_:1}),(0,a.wy)((0,a.Wm)(U,{flat:"",round:"",size:"md",icon:"close"},null,512),[[N]])])),_:1}),(0,a.Wm)(C),(0,a._)("div",b,[(0,a.Wm)(H,{header:""},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Reason")])),_:1})])),_:1}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Quantity")])),_:1})])),_:1})])),_:1}),(0,a.Wm)(C),(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{outlined:"",modelValue:e.editUsageItem.unit.description,"onUpdate:modelValue":l[3]||(l[3]=l=>e.editUsageItem.unit.description=l),type:"textarea","lazy-rules":"ondemand",rules:e.textInputRequiredRules()},null,8,["modelValue","rules"])])),_:1}),(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a._)("div",_,[(0,a._)("div",v,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.whole_number,"onUpdate:modelValue":l[4]||(l[4]=l=>e.editUsageItem.unit.whole_number=l),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,a._)("div",y,[(0,a._)("div",k,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.numerator,"onUpdate:modelValue":l[5]||(l[5]=l=>e.editUsageItem.unit.numerator=l),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])]),(0,a._)("div",null,[(0,a.Wm)(C,{class:"bg-grey-8"})]),(0,a._)("div",W,[(0,a.Wm)(z,{dense:"",outlined:"",type:"number",modelValue:e.editUsageItem.unit.denomenator,"onUpdate:modelValue":l[6]||(l[6]=l=>e.editUsageItem.unit.denomenator=l),modelModifiers:{number:!0},class:"col-9"},null,8,["modelValue"])])])])])),_:1}),(0,a.Wm)(j,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.editUsageItem.unit.units),1)])),_:1})])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(U,{rounded:"",loading:e.submittedUsageData,color:"primary",label:"Update",class:"full-width",type:"submit"},null,8,["loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}t(9665);var D=t(9302),q=t(499),U=t(4019),V=t(8221);const S=[{name:"id",label:"#",field:"id",sortable:!0,align:"left"},{name:"name",label:"Name",field:e=>e.item.name,sortable:!0,align:"left"},{name:"units",label:"Units",field:e=>`${e.quantity} ${e.unit}`,sortable:!0,align:"left"},{name:"reason",label:"Reason",field:"description",align:"left"},{name:"date",label:"Date",align:"left",field:"date_time"},{name:"actions",label:"Actions",align:"left"}],x=(0,a.aZ)({name:"StoreDeadStock",setup(){const e=(0,D.Z)(),l=(0,q.iH)([]),t=(0,q.iH)(!1),o=(0,q.iH)(!1),i=(0,q.iH)(null),n=(0,q.iH)(!1),d=(0,q.iH)(null),u=(0,a.Fl)((()=>d.value?d.value.units_available_details:[])),s=(0,q.iH)(!1),m=(0,q.iH)([]),r=(0,q.iH)([]),c=(0,q.iH)(!1),p=(0,q.iH)([]),g=(0,q.iH)([]),w=(0,q.iH)({item:{},unit:{}}),f=(0,q.iH)(!1),b=(0,q.iH)(null);function _(){return t.value=!0,(0,U.getStoreDeadStock)().then((e=>{l.value=e.data})).catch((e=>{})).finally((()=>{t.value=!1}))}function v(){return s.value=!0,(0,U.getStoreItems)("?available=True").then((e=>{m.value=e.data,r.value=e.data})).finally((()=>{s.value=!1}))}return(0,a.bv)((()=>{_().then((()=>{v()}))})),{loadingData:t,tableRows:l,tableColumns:S,denomenatorList:[null,2,4],stockItem:d,stockItemDetails:u,loadingStock:s,stockFilterOptions:r,loadingUnits:c,unitsFilterOptions:g,createDialog:o,createDialogForm:i,submittedUsageData:n,editDialog:f,editDialogForm:b,editUsageItem:w,filterStockOptions(e,l){l((()=>{r.value=m.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},filterUnitsOptions(e,l){l((()=>{g.value=p.value.filter((l=>l.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1))}))},submitDeadStockData(){if(i.value.validate()){let e=[];u.value.forEach((l=>{let t=0;l.whole_number&&l.whole_number>0&&(t=l.whole_number),l.denomenator&&l.denomenator>0&&l.numerator&&l.numerator>0?t=`${l.denomenator*t+l.numerator}/${l.denomenator}`:l.denomenator&&l.denomenator>0&&(null==l.numerator||0==l.numerator)&&(t=`${l.denomenator*t}/${l.denomenator}`),e.push({id:l.id,quantity:t,description:l.description})})),(0,U.createStoreDeadStock)(d.value.id,{unsalable:e}).then((e=>{(0,V.displayNotification)(e.data,"positive"),d.value=null,_(),o.value=!1,i.value.resetValidation()})).catch((e=>{(0,V.displayNotification)(e.response.data,"negative")})).finally((()=>{n.value=!1}))}},showEditDeadStockDialog(e){let t=l.value.find((l=>l.id==e));w.value.item=t.item;let a={id:e,units:t.unit,description:t.description},o=t.quantity.split("(");if(o.length>=1&&(a["whole_number"]=""==o[0]?null:parseInt(o[0])),2==o.length){let e=o[1].split("/");a["numerator"]=parseInt(e[0]),a["denomenator"]=parseInt(e[1].split(")")[0])}w.value.unit=a,f.value=!0},submitEditDeadStockData(){if(b.value.validate()){n.value=!0;let e=w.value.unit,l=0;e.whole_number&&e.whole_number>0&&(l=e.whole_number),e.denomenator&&e.denomenator>0&&e.numerator&&e.numerator>0?l=`${e.denomenator*l+e.numerator}/${e.denomenator}`:e.denomenator&&e.denomenator>0&&(null==e.numerator||0==e.numerator)&&(l=`${e.denomenator*l}/${e.denomenator}`),(0,U.editStoreDeadStock)(w.value.item.id,{id:e.id,quantity:l,description:e.description}).then((e=>{(0,V.displayNotification)(e.data,"positive"),w.value={item:{},unit:{}},_(),f.value=!1,b.value.resetValidation()})).catch((e=>{(0,V.displayNotification)(e.response.data,"negative")})).finally((()=>{n.value=!1}))}},showDeleteStockDeadDialog(l){e.dialog({title:"Confirm",message:"Confirm deleting of this transaction?",cancel:!0}).onOk((()=>{n.value=!0,(0,U.deleteStoreDeadStock)(l).then((e=>{(0,V.displayNotification)(e.data,"positive"),_()})).catch((e=>{(0,V.displayNotification)(e.response.data,"negative")})).finally((()=>{n.value=!1}))}))}}}});var I=t(1639),Z=t(9885),C=t(8879),Q=t(7355),H=t(7220),R=t(2074),j=t(4458),z=t(8326),F=t(1663),L=t(1973),O=t(926),$=t(4581),N=t(490),T=t(3115),E=t(3246),M=t(1233),P=t(6611),A=t(2146),Y=t(9984),B=t.n(Y);const K=(0,I.Z)(x,[["render",h]]),G=K;B()(x,"components",{QPage:Z.Z,QBtn:C.Z,QTable:Q.Z,QTd:H.Z,QDialog:R.Z,QCard:j.Z,QForm:z.Z,QToolbar:F.Z,QToolbarTitle:L.Z,QSeparator:O.Z,QSelect:$.Z,QItem:N.Z,QItemLabel:T.Z,QList:E.Z,QItemSection:M.Z,QInput:P.Z}),B()(x,"directives",{ClosePopup:A.Z})}}]);