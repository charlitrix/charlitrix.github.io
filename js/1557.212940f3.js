"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[1557],{1557:(t,e,a)=>{a.r(e),a.d(e,{default:()=>M});var s=a(9835),i=a(6970);const n={class:"q-mt-md"},l={class:"row justify-between q-mx-lg items-center"},o={class:"row text-weight-medium"},d=(0,s._)("div",null,"Total:",-1),r={class:"q-pl-sm"},c={class:"row justify-center items-center no-wrap q-gutter-x-sm"},u={class:"row justify-center items-center no-wrap q-gutter-x-sm"};function m(t,e,a,m,h,p){const g=(0,s.up)("q-breadcrumbs-el"),f=(0,s.up)("q-breadcrumbs"),b=(0,s.up)("q-btn"),D=(0,s.up)("q-td"),y=(0,s.up)("q-table"),w=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(w,{class:"q-pa-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{to:{name:"CashReceipts"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Cash Receipts ")])),_:1}),(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(t.account.name),1)])),_:1})])),_:1}),(0,s._)("div",n,[(0,s._)("div",l,[(0,s._)("div",o,[d,(0,s._)("div",r,(0,i.zw)(t.formatPrice(t.amountTotal)),1)]),t.permissionRequired("accounts","add_accountjournals")?((0,s.wg)(),(0,s.j4)(b,{key:0,label:"Add Entries",color:"primary",to:{name:"CreateTransaction"},class:"q-my-md"})):(0,s.kq)("",!0)]),(0,s.Wm)(y,{flat:"",bordered:"",separator:"vertical",rows:t.tableRows,columns:t.tableColumns,loading:t.loadingData,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",pagination:{rowsPerPage:0}},{"body-cell-id":(0,s.w5)((t=>[(0,s.Wm)(D,{props:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(t.rowIndex+1),1)])),_:2},1032,["props"])])),"body-cell-actions":(0,s.w5)((e=>[(0,s.Wm)(D,{props:e},{default:(0,s.w5)((()=>[(0,s._)("div",c,[(0,s._)("div",u,[t.permissionRequired("accounts","change_accountjournals")?((0,s.wg)(),(0,s.j4)(b,{key:0,flat:"",round:"",dense:"",color:"primary",icon:"edit",to:{name:"TransactionDetails",params:{id:e.row.transaction}}},null,8,["to"])):(0,s.kq)("",!0),t.permissionRequired("accounts","delete_accountjournals")?((0,s.wg)(),(0,s.j4)(b,{key:1,flat:"",round:"",dense:"",color:"red",icon:"delete",loading:t.deletingJournal,onClick:a=>t.deleteEntry(e.row.transaction)},null,8,["loading","onClick"])):(0,s.kq)("",!0)])])])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading"])])])),_:1})}a(9665);var h=a(9302),p=a(4170),g=a(1353),f=a(1809),b=a(8221),D=a(4019);const y=[{name:"id",label:"#",field:"id",align:"left",sortable:!0},{name:"date",label:"Date",field:t=>(0,b.parseDate)(t.date),align:"left",sortable:!0},{name:"amount",label:"Amount Received",field:t=>(0,b.formatPrice)(t.amount),align:"left",sortable:!0},{name:"description",label:"Description",field:"description",align:"left",sortable:!0},{name:"comments",label:"Comments",field:"comments",align:"left",sortable:!0}],w=(0,s.aZ)({name:"CashReceiptsDetails",props:["accountId"],data(){const t=new Date;return{deletingJournal:!1,addEntryDialog:!1,tableColumns:[...y],tableRows:[],loadingData:!1,submittingEntry:!1,tnDate:p.ZP.formatDate(t,"YYYY-MM-DD"),ledgerEntry:{date:p.ZP.formatDate(t,"DD/MM/YYYY"),description:"",comments:""},additionalColumns:[],account:{},budgetItems:[],budgetItemsOptions:[],additionalFields:[]}},computed:{formatDate(){return p.ZP.formatDate(p.ZP.extractDate(this.tnDate,"YYYY-MM-DD"),"DD/MM/YYYY")},amountTotal(){return this.tableRows.reduce(((t,e)=>t+e.amount),0)}},methods:{deleteEntry(t){this.$q.dialog({title:"Confirm",message:"Please confirm delete",cancel:!0,persistent:!0}).onOk((()=>{this.deletingJournal=!0,(0,D.deleteTransaction)(t).then((t=>{this.displayNotification(t.data,"positive"),this.loadJournals()})).catch((t=>{this.displayNotification(t.response.data,"red")})).finally((()=>{this.deletingJournal=!1}))}))},filterFunction(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.budgetItemsOptions=this.budgetItems.filter((t=>t.name.toLowerCase().indexOf(e)>-1))}:()=>{this.budgetItemsOptions=this.budgetItems})},tnDateChanged(t){const e=p.ZP.extractDate(t,"YYYY-MM-DD");this.toDate=p.ZP.formatDate(p.ZP.addToDate(e,{months:12,days:-1}),"YYYY-MM-DD"),this.$refs.tnDateProxy.hide()},confirmCreate(){this.$q.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0,persistent:!0}).onOk((()=>{let t={...this.ledgerEntry,entry_type:"DEBIT",additional_data:{}},e=this.additionalFields.map((t=>({label:t.label,value:t.value})));t.additional_data["cash_analysis_additional_fields"]=e,this.submittingEntry=!0,(0,D.createAccountsJournals)(this.account.id,t).then((t=>{this.displayNotification("Added entry successfully","positive"),this.ledgerEntry={date:p.ZP.formatDate(new Date,"DD/MM/YYYY"),description:"",comments:""},this.addEntryDialog=!1,this.loadJournals()})).catch((t=>{this.displayNotification(t.response.data,"red")})).finally((()=>{this.submittingEntry=!1}))})).onCancel((()=>{}))},findFieldValue(t,e){if(t.cash_analysis_additional_fields){let a=t.cash_analysis_additional_fields.find((t=>t.label==e));return a?a.value:""}return""},loadJournals(){return(0,D.getAccountJournalsBy)(this.accountId,"?entry_type=DEBIT").then((t=>{this.tableRows=t.data,t.data.length>0&&(this.tableColumns=[...y],this.additionalColumns.forEach((t=>{this.tableColumns.push({name:t,label:t,classes:"text-capitalize",field:e=>this.findFieldValue(e.additional_data,t),align:"left"})})),this.tableColumns.push({name:"actions",label:"Actions",align:"left"}))}))}},mounted(){(0,D.getAccount)(`${this.fiscalYear.id}?id=${this.accountId}`).then((t=>{this.account=t.data})).then((()=>{(0,D.getFiscalYearFeatureSettings)(this.fiscalYear.id,"?item=CASH_ANALYSIS").then((t=>{t.data&&t.data.enabled||this.$q.dialog({title:"Attention!!!",message:"Please enable ledger settings to access this page",noEscDismiss:!0,noBackdropDismiss:!0,persistent:!0}).onOk((()=>{this.$router.push({name:"DocumentSettings"})})),t.data.enabled&&t.data.details.fields&&(this.additionalColumns=t.data.details.fields.map((t=>t.name)),this.additionalFields=t.data.details.fields.map((t=>({label:t.name,value:""}))))})).then((()=>{this.loadJournals().then((()=>{(0,D.getBudget)(`/${this.fiscalYear.id}?items_only=True`).then((t=>{this.budgetItems=t.data,this.budgetItemsOptions=t.data}))}))}))}))},setup(){(0,h.Z)();const t=(0,g.F)(),{fiscalYear:e}=(0,f.Jk)(t);return{fiscalYear:e}}});var Y=a(1639),_=a(9885),C=a(2605),q=a(8052),k=a(8879),v=a(7355),P=a(7220),Z=a(9984),E=a.n(Z);const I=(0,Y.Z)(w,[["render",m]]),M=I;E()(w,"components",{QPage:_.Z,QBreadcrumbs:C.Z,QBreadcrumbsEl:q.Z,QBtn:k.Z,QTable:v.Z,QTd:P.Z})}}]);