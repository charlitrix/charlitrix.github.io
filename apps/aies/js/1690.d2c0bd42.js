"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[1690],{1690:(e,a,t)=>{t.r(a),t.d(a,{default:()=>le});var l=t(9835),o=t(6970);const i={class:"q-mt-md"},n={class:"row justify-end q-mx-lg"},s={class:"q-pa-lg"},d={class:"row justify-end text-weight-medium q-mb-sm"},m=(0,l._)("div",null,"Total:",-1),u={class:"q-pl-sm"},r=(0,l._)("div",{class:"text-h5"},"Cash Receipts",-1),c={class:"q-pa-lg"},p={class:"row justify-end text-weight-medium q-mb-sm"},b=(0,l._)("div",null,"Total:",-1),h={class:"q-pl-sm"},f=(0,l._)("div",{class:"text-h5"},"Cash Payments",-1),g={class:"q-px-md q-pb-xl column q-col-gutter-md"},w=(0,l._)("div",{class:"full-width q-my-md"},[(0,l._)("input",{class:"full-width"})],-1),y={class:"row items-center justify-end"},_={class:"q-mt-lg"};function v(e,a,t,v,D,C){const q=(0,l.up)("q-breadcrumbs-el"),V=(0,l.up)("q-breadcrumbs"),W=(0,l.up)("q-btn"),Z=(0,l.up)("q-space"),Y=(0,l.up)("q-select"),E=(0,l.up)("q-td"),P=(0,l.up)("q-table"),k=(0,l.up)("q-splitter"),x=(0,l.up)("q-toolbar-title"),Q=(0,l.up)("q-toolbar"),U=(0,l.up)("q-separator"),T=(0,l.up)("q-input"),A=(0,l.up)("q-item-label"),M=(0,l.up)("q-item-section"),R=(0,l.up)("q-item"),I=(0,l.up)("q-date"),B=(0,l.up)("q-popup-proxy"),H=(0,l.up)("q-card-section"),S=(0,l.up)("q-card"),z=(0,l.up)("q-dialog"),F=(0,l.up)("q-page"),j=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)(F,{class:"q-pa-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,null,{default:(0,l.w5)((()=>[(0,l.Wm)(q,{to:{name:"CashAnalysis"}},{default:(0,l.w5)((()=>[(0,l.Uk)("Cash Analysis ")])),_:1}),(0,l.Wm)(q,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.account.name),1)])),_:1})])),_:1}),(0,l._)("div",i,[(0,l._)("div",n,[e.permissionRequired("accounts","add_accountjournals")?((0,l.wg)(),(0,l.j4)(W,{key:0,color:"primary",label:"Add Entries",to:{name:"CreateTransaction"}})):(0,l.kq)("",!0)]),(0,l.Wm)(k,{modelValue:e.splitterModel,"onUpdate:modelValue":a[2]||(a[2]=a=>e.splitterModel=a),height:"80vh"},{before:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l._)("div",d,[m,(0,l._)("div",u,(0,o.zw)(e.formatPrice(e.amountTotal1)),1)]),(0,l.Wm)(P,{flat:"",dense:"",bordered:"",square:"","wrap-cells":"",separator:"vertical",rows:e.tableRows1,columns:e.tableColumns1,loading:e.loadingData1,"visible-columns":e.visibleColumns1,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",pagination:{rowsPerPage:0}},{top:(0,l.w5)((()=>[r,(0,l.Wm)(Z),(0,l.Wm)(Y,{multiple:"",outlined:"","emit-value":"","map-options":"","options-cover":"","display-value":"Columns",modelValue:e.visibleColumns1,"onUpdate:modelValue":a[0]||(a[0]=a=>e.visibleColumns1=a),options:e.tableColumns1,"option-value":e=>e.name,style:{"min-width":"150px"}},null,8,["modelValue","options","option-value"])])),"body-cell-amount":(0,l.w5)((a=>[(0,l.Wm)(E,{props:a},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.formatPrice(a.value)),1)])),_:2},1032,["props"])])),"body-cell-date":(0,l.w5)((a=>[(0,l.Wm)(E,{props:a},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.parseDate(a.value)),1)])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading","visible-columns"])])])),after:(0,l.w5)((()=>[(0,l._)("div",c,[(0,l._)("div",p,[b,(0,l._)("div",h,(0,o.zw)(e.formatPrice(e.amountTotal2)),1)]),(0,l.Wm)(P,{flat:"",bordered:"",dense:"",square:"","wrap-cells":"",rows:e.tableRows2,columns:e.tableColumns2,loading:e.loadingData2,"visible-columns":e.visibleColumns2,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",separator:"vertical",pagination:{rowsPerPage:0}},{top:(0,l.w5)((()=>[f,(0,l.Wm)(Z),(0,l.Wm)(Y,{multiple:"",outlined:"","emit-value":"","map-options":"","options-cover":"","display-value":"Columns",modelValue:e.visibleColumns2,"onUpdate:modelValue":a[1]||(a[1]=a=>e.visibleColumns2=a),options:e.tableColumns2,"option-value":e=>e.name,style:{"min-width":"150px"}},null,8,["modelValue","options","option-value"])])),"body-cell-amount":(0,l.w5)((a=>[(0,l.Wm)(E,{props:a},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.formatPrice(a.value)),1)])),_:2},1032,["props"])])),"body-cell-date":(0,l.w5)((a=>[(0,l.Wm)(E,{props:a},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.parseDate(a.value)),1)])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading","visible-columns"])])])),_:1},8,["modelValue"])]),(0,l.Wm)(z,{modelValue:e.addEntry,"onUpdate:modelValue":a[8]||(a[8]=a=>e.addEntry=a),seamless:""},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{style:{width:"700px","max-width":"80vw"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(x,{class:"text-h6 q-ml-lg"},{default:(0,l.w5)((()=>[(0,l.Uk)("Add Entry")])),_:1}),(0,l.wy)((0,l.Wm)(W,{flat:"",round:"",dense:"",icon:"close"},null,512),[[j]])])),_:1}),(0,l.Wm)(U,{inset:""}),(0,l.Wm)(H,null,{default:(0,l.w5)((()=>[(0,l._)("div",g,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.additionalColumns,((e,a)=>((0,l.wg)(),(0,l.j4)(T,{key:a,label:e.label,modelValue:e.value,"onUpdate:modelValue":a=>e.value=a},null,8,["label","modelValue","onUpdate:modelValue"])))),128)),(0,l.Wm)(Y,{modelValue:e.ledgerEntry.item,"onUpdate:modelValue":a[3]||(a[3]=a=>e.ledgerEntry.item=a),clearable:"",label:"Details","options-selected-class":"text-primary",options:e.budgetItems,"option-label":e=>e.name},{"before-options":(0,l.w5)((()=>[w])),option:(0,l.w5)((e=>[(0,l.Wm)(R,(0,o.vs)((0,l.F4)(e.itemProps)),{default:(0,l.w5)((()=>[(0,l.Wm)(M,null,{default:(0,l.w5)((()=>[(0,l.Wm)(A,{overline:""},{default:(0,l.w5)((()=>[(0,l.Uk)("#"+(0,o.zw)(e.opt.identifier),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(M,null,{default:(0,l.w5)((()=>[(0,l.Wm)(A,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.opt.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","options","option-label"]),(0,l.Wm)(T,{modelValue:e.ledgerEntry.comments,"onUpdate:modelValue":a[4]||(a[4]=a=>e.ledgerEntry.comments=a),label:"Comments",type:"textarea"},null,8,["modelValue"]),(0,l.Wm)(T,{readonly:"",modelValue:e.formatDate,"onUpdate:modelValue":a[6]||(a[6]=a=>e.formatDate=a),label:"Date"},{after:(0,l.w5)((()=>[(0,l.Wm)(W,{round:"",icon:"event",color:"primary",class:"cursor-pointer"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"tnDateProxy"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{modelValue:e.tnDate,"onUpdate:modelValue":[a[5]||(a[5]=a=>e.tnDate=a),e.tnDateChanged],mask:"YYYY-MM-DD"},{default:(0,l.w5)((()=>[(0,l._)("div",y,[(0,l.wy)((0,l.Wm)(W,{label:"Close",color:"primary",flat:""},null,512),[[j]])])])),_:1},8,["modelValue","onUpdate:modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(T,{label:"Amount",modelValue:e.ledgerEntry.amount,"onUpdate:modelValue":a[7]||(a[7]=a=>e.ledgerEntry.amount=a),modelModifiers:{number:!0}},null,8,["modelValue"]),(0,l._)("div",_,[(0,l.Wm)(W,{color:"primary",class:"full-width",label:"submit",onClick:e.confirmCreate,loading:e.submittingEntry},null,8,["onClick","loading"])])])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}t(6890),t(9665);var D=t(499),C=t(9302),q=t(4170),V=t(1353),W=t(1809),Z=(t(8221),t(4019));const Y=[{name:"id",label:"#",field:"id",align:"left",sortable:!0},{name:"description",label:"Description",field:"description",align:"left",sortable:!0},{name:"comments",label:"Comments",field:"comments",align:"left",sortable:!0},{name:"amount",label:"Amount Paid",field:"amount",align:"left",sortable:!0},{name:"date",label:"Date",field:"date",align:"left",sortable:!0}],E=[{name:"id",label:"#",field:"id",align:"left",sortable:!0},{name:"description",label:"Description",field:"description",align:"left",sortable:!0},{name:"comments",label:"Comments",field:"comments",align:"left",sortable:!0},{name:"amount",label:"Amount Received",field:e=>e.amount<0?0-e.amount:e.amount,align:"left",sortable:!0},{name:"date",label:"Date",field:"date",align:"left",sortable:!0}],P=(0,l.aZ)({name:"CashAnalysisDetails",props:["accountId"],data(){const e=new Date;return{addEntry:(0,D.iH)(!1),tableColumns1:[...E],tableColumns2:[...Y],tableRows1:(0,D.iH)([]),tableRows2:(0,D.iH)([]),loadingData1:(0,D.iH)(!0),loadingData2:(0,D.iH)(!0),visibleColumns1:(0,D.iH)(["date","description","amount"]),visibleColumns2:(0,D.iH)(["date","description","amount"]),submittingEntry:(0,D.iH)(!1),tnDate:(0,D.iH)(q.ZP.formatDate(e,"YYYY-MM-DD")),ledgerEntry:{},additionalColumns:[],account:{},budgetItems:(0,D.iH)([]),splitterModel:(0,D.iH)(50),additional_fields:[]}},computed:{formatDate(){return q.ZP.formatDate(q.ZP.extractDate(this.tnDate,"YYYY-MM-DD"),"DD/MM/YYYY")},amountTotal1(){return this.tableRows1.reduce(((e,a)=>e+a.amount),0)},amountTotal2(){return this.tableRows2.reduce(((e,a)=>e+Math.abs(a.amount)),0)}},methods:{tnDateChanged(e){const a=q.ZP.extractDate(e,"YYYY-MM-DD");this.toDate=q.ZP.formatDate(q.ZP.addToDate(a,{months:12,days:-1}),"YYYY-MM-DD"),this.$refs.tnDateProxy.hide()},findFieldValue(e,a){if(e.cash_analysis_additional_fields){let t=e.cash_analysis_additional_fields.find((e=>e.label==a));return t?t.value:""}return""},confirmCreate(){this.$q.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0,persistent:!0}).onOk((()=>{const e={};e.date=this.tnDate,e.budgetitem=this.ledgerEntry.item.id,e.additional_data={comments:this.ledgerEntry.comments},e.entry_type="CREDIT",e.amount=this.ledgerEntry.amount,this.additionalColumns.forEach((a=>{e.additional_data[a.label]=a.value})),this.submittingEntry=!0,(0,Z.createAccountsJournals)(this.account.id,e).then((e=>{this.displayNotification("Added entry successfully","blue"),this.ledgerEntry={},this.addEntry=!1,this.loadJournals()})).catch((e=>{this.displayNotification("Server error, Please contact system administrator","red")})).finally((()=>{this.submittingEntry=!1}))})).onCancel((()=>{}))},loadJournals(){(0,Z.getAccountJournalsBy)(this.accountId,"?entry_type=DEBIT").then((e=>{this.tableRows1=e.data,this.account.opening_balance>0&&this.tableRows1.unshift({date:this.account.date,description:"Balance B/F",amount:this.account.opening_balance,comments:"",additional_data:{}}),e.data.length>0&&this.additional_fields.forEach((e=>{this.tableColumns1.push({name:e,label:e,classes:"text-capitalize",field:a=>this.findFieldValue(a.additional_data,e),align:"left"})}))})).finally((()=>{this.loadingData1=!1})).then((()=>{(0,Z.getAccountJournalsBy)(this.accountId,"?entry_type=CREDIT").then((e=>{this.tableRows2=e.data,this.account.opening_balance<0&&this.tableRows2.unshift({date:this.account.date,description:"Balance B/F",amount:this.account.opening_balance,comments:"",additional_data:{}});let a=this.amountTotal1-this.amountTotal2;a>=0?this.tableRows2.push({date:this.parseDate(this.formatDate),description:"Balance C/D",amount:a,comments:"",additional_data:{}}):this.tableRows1.push({date:this.parseDate(this.formatDate),description:"Balance C/D",amount:a,comments:"",additional_data:{}}),e.data.length>0&&this.additional_fields.forEach((e=>{this.tableColumns2.push({name:e,label:e,classes:"text-capitalize",field:a=>this.findFieldValue(a.additional_data,e),align:"left"})}))})).finally((()=>{this.loadingData2=!1}))}))}},mounted(){(0,Z.getAccount)(this.accountId).then((e=>{this.account=e.data})).then((()=>{(0,Z.getFiscalYearFeatureSettings)(this.fiscalYear.id,"?item=CASH_ANALYSIS").then((e=>{e.data&&e.data.enabled||this.$q.dialog({title:"Attention!!!",message:"Please enable ledger settings to access this page",noEscDismiss:!0,noBackdropDismiss:!0,persistent:!0}).onOk((()=>{this.$router.push({name:"DocumentSettings"})})),e.data.enabled&&e.data.details.fields&&(this.additional_fields=e.data.details.fields.map((e=>e.name)))})).then((()=>{this.loadJournals()}))}))},setup(){(0,C.Z)();const e=(0,V.F)(),{fiscalYear:a}=(0,W.Jk)(e);return{fiscalYear:a}}});var k=t(1639),x=t(9885),Q=t(2605),U=t(8052),T=t(8879),A=t(7498),M=t(7355),R=t(136),I=t(4581),B=t(7220),H=t(2074),S=t(4458),z=t(1663),F=t(1973),j=t(926),J=t(3190),N=t(6611),L=t(490),$=t(1233),O=t(3115),K=t(2765),G=t(4351),X=t(2146),ee=t(9984),ae=t.n(ee);const te=(0,k.Z)(P,[["render",v]]),le=te;ae()(P,"components",{QPage:x.Z,QBreadcrumbs:Q.Z,QBreadcrumbsEl:U.Z,QBtn:T.Z,QSplitter:A.Z,QTable:M.Z,QSpace:R.Z,QSelect:I.Z,QTd:B.Z,QDialog:H.Z,QCard:S.Z,QToolbar:z.Z,QToolbarTitle:F.Z,QSeparator:j.Z,QCardSection:J.Z,QInput:N.Z,QItem:L.Z,QItemSection:$.Z,QItemLabel:O.Z,QPopupProxy:K.Z,QDate:G.Z}),ae()(P,"directives",{ClosePopup:X.Z})}}]);