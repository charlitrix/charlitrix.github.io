"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[3980],{3980:(a,e,l)=>{l.r(e),l.d(e,{default:()=>B});var i=l(9835),t=l(6970);const s=(0,i._)("div",{class:"text-h5 q-mb-sm"},"Current Fiscal Year",-1),n={key:0,class:"row items-center q-gutter-x-lg"},o={class:"text-h6"},r=(0,i._)("div",null,"-",-1),c={key:1},d=(0,i._)("div",{class:"text-h5 q-mb-lg"},"Fiscal Year Settings",-1),u={class:"column q-gutter-y-xl q-mx-xl"},m={class:"row items-center justify-end"},f={class:"row items-center justify-end"},p={class:"column justify-center q-pt-lg"},v=(0,i._)("div",{class:"q-py-lg"},null,-1),g=(0,i._)("div",{class:"text-h5 q-mb-sm q-mt-xl text-weight-bold"},"Previous Years",-1),y={class:"row q-gutter-x-xl"},w={class:"text-h6 text-grey-9"},Y={class:"row"},_={class:"col-6"},q=(0,i._)("div",{class:"q-py-xl"},null,-1),b=(0,i._)("div",{class:"q-py-xl"},null,-1);function k(a,e,l,k,h,x){const F=(0,i.up)("q-btn"),D=(0,i.up)("q-separator"),C=(0,i.up)("q-date"),W=(0,i.up)("q-popup-proxy"),Z=(0,i.up)("q-field"),P=(0,i.up)("q-form"),Q=(0,i.up)("q-item-section"),j=(0,i.up)("q-item"),R=(0,i.up)("q-list"),z=(0,i.up)("q-card-section"),N=(0,i.up)("q-card"),U=(0,i.up)("q-expansion-item"),A=(0,i.up)("q-page"),S=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(A,{class:"q-pa-xl"},{default:(0,i.w5)((()=>[(0,i._)("div",null,[s,a.fiscalYearData.id?((0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",o,"Fy "+(0,t.zw)(a.parseFiscalYear(a.fiscalYear.end)),1),r,(0,i.Wm)(F,{outlined:"",color:"red",label:"Close",onClick:a.confirmCloseFiscalYear,loading:a.submitting},null,8,["onClick","loading"])])):((0,i.wg)(),(0,i.iD)("div",c,"-"))]),(0,i.Wm)(D,{class:"q-my-lg"}),d,(0,i.Wm)(P,{ref:"fiscalYearForm",onSubmit:a.submitData},{default:(0,i.w5)((()=>[(0,i._)("div",u,[(0,i.Wm)(Z,{"model-value":a.fiscalYearData.start,label:"From date","lazy-rules":"ondemand",rules:a.textInputRequiredRules()},{control:(0,i.w5)((()=>[(0,i.Uk)((0,t.zw)(a.fiscalYearData.start),1)])),after:(0,i.w5)((()=>[a.permissionRequired("accounts","change_fiscalyear")&&a.permissionRequired("accounts","add_fiscalyear")?((0,i.wg)(),(0,i.j4)(F,{key:0,round:"",color:"primary",icon:"event",class:"cursor-pointer",loading:a.submitting},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"fromDateProxy"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{modelValue:a.fiscalYearData.start,"onUpdate:modelValue":[e[0]||(e[0]=e=>a.fiscalYearData.start=e),e[1]||(e[1]=e=>a.$refs.fromDateProxy.hide())],mask:"DD/MM/YYYY"},{default:(0,i.w5)((()=>[(0,i._)("div",m,[(0,i.wy)((0,i.Wm)(F,{label:"Close",color:"primary",flat:""},null,512),[[S]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1},8,["loading"])):(0,i.kq)("",!0)])),_:1},8,["model-value","rules"]),(0,i.Wm)(Z,{"model-value":a.fiscalYearData.end,label:"To date","lazy-rules":"ondemand",rules:a.textInputRequiredRules()},{control:(0,i.w5)((()=>[(0,i.Uk)((0,t.zw)(a.fiscalYearData.end),1)])),after:(0,i.w5)((()=>[a.permissionRequired("accounts","change_fiscalyear")&&a.permissionRequired("accounts","add_fiscalyear")?((0,i.wg)(),(0,i.j4)(F,{key:0,round:"",color:"primary",icon:"event",class:"cursor-pointer",loading:a.submitting},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"toDateProxy"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{modelValue:a.fiscalYearData.end,"onUpdate:modelValue":[e[2]||(e[2]=e=>a.fiscalYearData.end=e),e[3]||(e[3]=e=>a.$refs.toDateProxy.hide())],mask:"DD/MM/YYYY"},{default:(0,i.w5)((()=>[(0,i._)("div",f,[(0,i.wy)((0,i.Wm)(F,{label:"Close",color:"primary",flat:""},null,512),[[S]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1},8,["loading"])):(0,i.kq)("",!0)])),_:1},8,["model-value","rules"]),(0,i._)("div",p,[a.permissionRequired("accounts","change_fiscalyear")&&a.permissionRequired("accounts","add_fiscalyear")?((0,i.wg)(),(0,i.j4)(F,{key:0,rounded:"",color:"primary",loading:a.submitting,label:a.fiscalYearData.id?"Update":"Submit",type:"submit"},null,8,["loading","label"])):(0,i.kq)("",!0)])])])),_:1},8,["onSubmit"]),v,g,(0,i.Wm)(D,{class:"bg-dark"}),(0,i.Wm)(R,{class:"column q-mt-md"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.closedFiscalYearsList,((e,l)=>((0,i.wg)(),(0,i.j4)(j,{key:e.id,class:"column"},{default:(0,i.w5)((()=>[(0,i._)("div",y,[(0,i._)("div",w,"Fy - "+(0,t.zw)(a.parseFiscalYear(e.end)),1),0==l?((0,i.wg)(),(0,i.j4)(F,{key:0,outlined:"",unelevated:"","no-caps":"",label:"Re-open",color:"green",onClick:l=>a.confirmOpenFiscalYear(e.id)},null,8,["onClick"])):(0,i.kq)("",!0)]),(0,i._)("div",Y,[(0,i._)("div",_,[(0,i.Wm)(U,{"expand-separator":"","header-class":"text-primary text-weight-bold",label:"Accounts"},{default:(0,i.w5)((()=>[(0,i.Wm)(N,null,{default:(0,i.w5)((()=>[(0,i.Wm)(z,{class:"q-py-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{separator:"",bordered:""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.accounts,(e=>((0,i.wg)(),(0,i.j4)(j,{key:e.id},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,t.zw)(e.name),1)])),_:2},1024),e.closing_balance>0?((0,i.wg)(),(0,i.j4)(Q,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,t.zw)(a.formatPrice(e.closing_balance)),1)])),_:2},1024)):((0,i.wg)(),(0,i.j4)(Q,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)("("+(0,t.zw)(a.formatPrice(e.closing_balance))+")",1)])),_:2},1024)),(0,i.Wm)(Q,{side:""},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{"no-caps":"",color:"primary",label:"Add account",onClick:l=>a.confirmAddAccountToFiscalYear(e.id),loading:a.submitting,disabled:!(a.fiscalYearData.value&&a.fiscalYearData.value.id)},null,8,["onClick","loading","disabled"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])])])),_:2},1024)))),128))])),_:1}),q,b])),_:1})}var h=l(499),x=l(4019),F=l(1809),D=l(1353),C=l(9302),W=(l(4170),l(8221));const Z=(0,i.aZ)({name:"FiscalYear",setup(){const a=(0,D.F)(),e=(0,C.Z)(),{fiscalYear:l}=(0,F.Jk)(a),{saveFiscalYear:t}=a,s=(0,h.iH)({}),n=(0,h.iH)(!1),o=(0,h.iH)(null),r=(0,h.iH)([]);function c(){s.value={},l.value&&l.value.id&&(s.value=l.value)}function d(){return(0,x.getFiscalYear)("?current=True").then((a=>{a.data&&a.data.id?t(a.data):t({})})).catch((a=>{}))}function u(){return(0,x.createFiscalYear)({...s.value})}function m(){return(0,x.editFiscalYear)(s.value.id,{start:s.value.start,end:s.value.end})}function f(){(0,x.getFiscalYear)("?accounts=True").then((a=>{r.value=a.data}))}return(0,i.m0)((()=>{c()})),(0,i.bv)((()=>{d().then((()=>{f()}))})),{fiscalYear:l,fiscalYearData:s,submitting:n,fiscalYearForm:o,closedFiscalYearsList:r,parseFiscalYear(a){return""!=a&&null!==a?a.split("/").splice(-1,1)[0]:"-"},submitData(){o.value.validate()&&e.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{n.value=!0,new Promise(((a,e)=>{a(s.value.id?m():u())})).then((a=>{(0,W.displayNotification)(a.data,"positive"),o.value.resetValidation(),d()})).catch((a=>{(0,W.displayNotification)(a.response.data,"negative")})).finally((()=>{n.value=!1}))}))},confirmCloseFiscalYear(){e.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{n.value=!0,(0,x.closeFiscalYear)(s.value.id).then((a=>{(0,W.displayNotification)(a.data,"positive"),d()})).catch((a=>{(0,W.displayNotification)(a.response.data,"negative")})).finally((()=>{n.value=!1}))}))},confirmOpenFiscalYear(a){e.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{n.value=!0,(0,x.openFiscalYear)(a).then((a=>{(0,W.displayNotification)(a.data,"positive"),d(),f()})).catch((a=>{(0,W.displayNotification)(a.response.data,"negative")})).finally((()=>{n.value=!1}))}))},confirmAddAccountToFiscalYear(a){e.dialog({title:"Confirm",message:"Please confirm",cancel:!0}).onOk((()=>{n.value=!0,(0,x.previousFiscalYearAccountCreate)(l.value.id,a).then((a=>{(0,W.displayNotification)(a.data,"positive")})).catch((a=>{(0,W.displayNotification)(a.response.data,"negative")})).finally((()=>{n.value=!1}))}))}}}});var P=l(1639),Q=l(9885),j=l(8879),R=l(926),z=l(8326),N=l(8149),U=l(2765),A=l(4351),S=l(3246),T=l(490),V=l(651),H=l(4458),O=l(3190),I=l(1233),M=l(2146),L=l(9984),K=l.n(L);const $=(0,P.Z)(Z,[["render",k]]),B=$;K()(Z,"components",{QPage:Q.Z,QBtn:j.Z,QSeparator:R.Z,QForm:z.Z,QField:N.Z,QPopupProxy:U.Z,QDate:A.Z,QList:S.Z,QItem:T.Z,QExpansionItem:V.Z,QCard:H.Z,QCardSection:O.Z,QItemSection:I.Z}),K()(Z,"directives",{ClosePopup:M.Z})}}]);