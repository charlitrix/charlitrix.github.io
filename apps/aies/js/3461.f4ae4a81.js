"use strict";(globalThis["webpackChunkaies"]=globalThis["webpackChunkaies"]||[]).push([[3461],{3461:(t,e,a)=>{a.r(e),a.d(e,{default:()=>I});var s=a(9835),i=a(6970);const n={class:"q-mt-md"},l={class:"row justify-between q-mx-lg items-center"},o={class:"row text-weight-medium"},d=(0,s._)("div",null,"Total:",-1),r={class:"q-pl-sm"},c={class:"row justify-center items-center no-wrap q-gutter-x-sm"};function u(t,e,a,u,m,h){const g=(0,s.up)("q-breadcrumbs-el"),p=(0,s.up)("q-breadcrumbs"),f=(0,s.up)("q-btn"),b=(0,s.up)("q-td"),D=(0,s.up)("q-table"),y=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(y,{class:"q-pa-md"},{default:(0,s.w5)((()=>[(0,s.Wm)(p,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{to:{name:"CashPayments"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Cash Payments ")])),_:1}),(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(t.account.name),1)])),_:1})])),_:1}),(0,s._)("div",n,[(0,s._)("div",l,[(0,s._)("div",o,[d,(0,s._)("div",r,(0,i.zw)(t.formatPrice(t.amountTotal)),1)]),t.permissionRequired("accounts","add_accountjournals")?((0,s.wg)(),(0,s.j4)(f,{key:0,label:"Add Entries",color:"primary",to:{name:"CreateTransaction"},class:"q-my-md"})):(0,s.kq)("",!0)]),(0,s.Wm)(D,{flat:"",bordered:"","wrap-cells":"",separator:"vertical",rows:t.tableRows,columns:t.tableColumns,loading:t.loadingData,"no-data-label":"No data available","loading-label":"Loading data...","row-key":"id",pagination:{rowsPerPage:0}},{"body-cell-id":(0,s.w5)((t=>[(0,s.Wm)(b,{props:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(t.rowIndex+1),1)])),_:2},1032,["props"])])),"body-cell-actions":(0,s.w5)((e=>[(0,s.Wm)(b,{props:e},{default:(0,s.w5)((()=>[(0,s._)("div",c,[t.permissionRequired("accounts","change_accountjournals")?((0,s.wg)(),(0,s.j4)(f,{key:0,flat:"",round:"",dense:"",color:"primary",icon:"edit",to:{name:"TransactionDetails",params:{id:e.row.transaction}}},null,8,["to"])):(0,s.kq)("",!0),t.permissionRequired("accounts","delete_accountjournals")?((0,s.wg)(),(0,s.j4)(f,{key:1,flat:"",round:"",dense:"",color:"red",icon:"delete",loading:t.deletingJournal,onClick:a=>t.deleteEntry(e.row.transaction)},null,8,["loading","onClick"])):(0,s.kq)("",!0)])])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading"])])])),_:1})}a(9665);var m=a(9302),h=a(4170),g=a(1353),p=a(1809),f=a(8221),b=a(4019);const D=[{name:"id",label:"#",field:"id",align:"left",sortable:!0},{name:"date",label:"Date",field:t=>(0,f.parseDate)(t.date),align:"left",sortable:!0},{name:"amount",label:"Amount Paid",field:t=>(0,f.formatPrice)(t.amount),align:"left",sortable:!0},{name:"description",label:"Description",field:"description",align:"left",sortable:!0},{name:"comments",label:"Comments",field:"comments",align:"left",sortable:!0}],y=(0,s.aZ)({name:"CashPaymentsDetails",props:["accountId"],data(){const t=new Date;return{deletingJournal:!1,addEntryDialog:!1,tableColumns:[...D],tableRows:[],loadingData:!1,submittingEntry:!1,tnDate:h.ZP.formatDate(t,"YYYY-MM-DD"),ledgerEntry:{date:h.ZP.formatDate(t,"DD/MM/YYYY"),description:"",comments:""},additionalColumns:[],account:{},budgetItems:[],budgetItemsOptions:[],additionalFields:[]}},computed:{formatDate(){return h.ZP.formatDate(h.ZP.extractDate(this.tnDate,"YYYY-MM-DD"),"DD/MM/YYYY")},amountTotal(){return this.tableRows.reduce(((t,e)=>t+e.amount),0)}},methods:{deleteEntry(t){this.$q.dialog({title:"Confirm",message:"Please confirm delete",cancel:!0,persistent:!0}).onOk((()=>{this.deletingJournal=!0,(0,b.deleteTransaction)(t).then((t=>{this.displayNotification(t.data,"positive"),this.loadJournals()})).catch((t=>{this.displayNotification(t.response.data,"red")})).finally((()=>{this.deletingJournal=!1}))}))},filterFunction(t,e){e(""!==t?()=>{const e=t.toLowerCase();this.budgetItemsOptions=this.budgetItems.filter((t=>t.name.toLowerCase().indexOf(e)>-1))}:()=>{this.budgetItemsOptions=this.budgetItems})},tnDateChanged(t){const e=h.ZP.extractDate(t,"YYYY-MM-DD");this.toDate=h.ZP.formatDate(h.ZP.addToDate(e,{months:12,days:-1}),"YYYY-MM-DD"),this.$refs.tnDateProxy.hide()},confirmCreate(){this.$q.dialog({title:"Confirm ?",message:"Please confirm",cancel:!0,persistent:!0}).onOk((()=>{let t={...this.ledgerEntry,entry_type:"CREDIT",additional_data:{}},e=this.additionalFields.map((t=>({label:t.label,value:t.value})));t.additional_data["cash_analysis_additional_fields"]=e,this.submittingEntry=!0,(0,b.createAccountsJournals)(this.account.id,t).then((t=>{this.displayNotification("Added entry successfully","positive"),this.ledgerEntry={date:h.ZP.formatDate(new Date,"DD/MM/YYYY"),description:"",comments:""},this.addEntryDialog=!1,this.loadJournals()})).catch((t=>{this.displayNotification(t.response.data,"red")})).finally((()=>{this.submittingEntry=!1}))})).onCancel((()=>{}))},findFieldValue(t,e){if(t.cash_analysis_additional_fields){let a=t.cash_analysis_additional_fields.find((t=>t.label==e));return a?a.value:""}return""},loadJournals(){return(0,b.getAccountJournalsBy)(this.accountId,"?entry_type=CREDIT").then((t=>{this.tableRows=t.data,t.data.length>0&&(this.tableColumns=[...D],this.additionalColumns.forEach((t=>{this.tableColumns.push({name:t,label:t,classes:"text-capitalize",field:e=>this.findFieldValue(e.additional_data,t),align:"left"})})),this.tableColumns.push({name:"actions",label:"Actions",align:"left"}))}))}},mounted(){(0,b.getAccount)(`${this.fiscalYear.id}?id=${this.accountId}`).then((t=>{this.account=t.data})).then((()=>{(0,b.getFiscalYearFeatureSettings)(this.fiscalYear.id,"?item=CASH_ANALYSIS").then((t=>{t.data&&t.data.enabled||this.$q.dialog({title:"Attention!!!",message:"Please enable ledger settings to access this page",noEscDismiss:!0,noBackdropDismiss:!0,persistent:!0}).onOk((()=>{this.$router.push({name:"DocumentSettings"})})),t.data.enabled&&t.data.details.fields&&(this.additionalColumns=t.data.details.fields.map((t=>t.name)),this.additionalFields=t.data.details.fields.map((t=>({label:t.name,value:""}))))})).then((()=>{this.loadJournals().then((()=>{(0,b.getBudget)(`/${this.fiscalYear.id}?items_only=True`).then((t=>{this.budgetItems=t.data,this.budgetItemsOptions=t.data}))}))}))}))},setup(){(0,m.Z)();const t=(0,g.F)(),{fiscalYear:e}=(0,p.Jk)(t);return{fiscalYear:e}}});var w=a(1639),Y=a(9885),_=a(2605),C=a(8052),k=a(8879),q=a(7355),P=a(7220),v=a(9984),Z=a.n(v);const E=(0,w.Z)(y,[["render",u]]),I=E;Z()(y,"components",{QPage:Y.Z,QBreadcrumbs:_.Z,QBreadcrumbsEl:C.Z,QBtn:k.Z,QTable:q.Z,QTd:P.Z})}}]);